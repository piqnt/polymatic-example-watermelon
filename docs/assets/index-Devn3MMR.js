(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();/**
 * Polymatic v0.0.10
 * @copyright Copyright 2025 Ali Shakiba
 * @license Licensed under the MIT (https://github.com/piqnt/polymatic/blob/main/LICENSE.md)
 */function Wr(i){try{const t=localStorage.getItem(i);if(t)return t}catch{}try{const t=sessionStorage.getItem(i);if(t)return t}catch{}}function ar(i,t){let e=Wr(i+"_exclude"),r=Wr(i+"_include");try{if(e&&t.match(e))return!1}catch(s){console.log(s)}try{if(r&&t.match(r))return!0}catch(s){console.log(s)}return!1}function eo(i,t){const e=ar("debug",i),r=ar("trace",i);return e?(...s)=>{t&&!t(...s)||(console.log(i,...s),r&&console.trace())}:()=>{}}function Bo(i,t){const e=ar("watch",i),r=ar("trace",i);return e?new Proxy(t,{set(s,o,n,h){return console.debug(i,".",o.toString(),s[o],"↬",n),r&&console.trace(),Reflect.set(s,o,n,h)}}):t}const Ur=eo("middleware.event",i=>!(i!=null&&i.endsWith("-move")||i==="hotsyncWorld")),Hr=eo("middleware.lifecycle");class pi{constructor(){this.__handlers={},this.__children=[],this.__parent=null}get activated(){return this.__parent&&this.__parent.activated}use(t){this.__children.indexOf(t)===-1&&(this.activated&&t.__attach(this),this.__children.push(t))}unuse(t){const e=this.__children.indexOf(t);e!==-1&&(this.__children.splice(e,1),t==null||t.__detach())}__attach(t){if(!this.__parent){this.__parent=t,Hr("activate","+",this.constructor.name),this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}__detach(){if(this.__parent){Hr("deactivate","-",this.constructor.name),this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach();this.__parent=null}}get context(){return this.__parent?this.__parent.context:null}setContext(t){this.__parent?this.__parent.setContext(t):console.error("Middleware is not activated")}on(t,e){if(this.__handlers[t])throw Error(`Handler for ${t} already exists`);this.__handlers[t]=e}_consume(t,e){if(this._handle(t,e))return!0;for(let s=0;s<this.__children.length;s++)if(this.__children[s]._consume(t,e))return!0;return!1}_handle(t,e){if(!this.activated)return;const r=this.__handlers&&this.__handlers[t];return!!(r&&typeof r=="function"&&(Ur(t,"→",this.constructor.name,e),r.call(this,e)===!0))}emit(t,e){this.activated&&(Ur(t,"↑",this.constructor.name,e),this.__parent?this.__parent.emit(t,e):console.error(Error("Not active!")))}static activate(t,e){return cr.activate(t,e)}}class cr extends pi{constructor(){super(...arguments),this.__handlers={},this.__children=[],this._activated=!1,this.contextUpdateEmit=()=>{this.emit("context-change")}}get activated(){return this._activated}_activate(t){if(!this._activated){t=Bo("middleware.context",t),this._context=t,this._activated=!0,this._handle("activate");for(let e=0;e<this.__children.length;e++)this.__children[e].__attach(this)}}_deactivate(){if(this._activated){this._activated=!1,this._handle("deactivate");for(let t=0;t<this.__children.length;t++)this.__children[t].__detach()}}get context(){return this._context}setContext(t){if(typeof t!="function"){console.error("Setter is not a function: ",t);return}t(this.context),clearTimeout(this.contextUpdateEmitTimeout),this.contextUpdateEmitTimeout=setTimeout(this.contextUpdateEmit)}emit(t,e){setTimeout(()=>{this._consume(t,e)})}static activate(t,e){const r=new cr;r.use(t),r._activate(e)}static deactivate(t){if("_deactivate"in t&&typeof t._deactivate=="function")return t._deactivate(),!0;const e=t.__parent;return e&&"_deactivate"in e&&typeof e._deactivate=="function"?(e._deactivate(),!0):!1}}class Oe{constructor(){this._componentsById={}}static create(t){return new class extends Oe{constructor(){super(...arguments),this.filter=t.filter,this.enter=t.enter,this.exit=t.exit,this.update=t.update}}}ref(t){return this._componentsById[t]}}class lr{constructor(){this._drivers=[],this._map={},this._mapBuffer={},this._updateBuffer=[],this._enterBuffer=[],this._exitBuffer=[]}static create(t){return new class extends lr{constructor(){super(...arguments),this.key=t.key,this._drivers=t.drivers?[...t.drivers]:[]}}}addDriver(t){if(!(t&&t.filter&&t.enter&&t.exit&&t.update))throw"Invalid driver: "+t;return this._drivers.push(t),this}data(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=t.length;for(let r=0;r<t.length;r++){const s=t[r];if(typeof s!="object"||s===null)continue;const o=this.key(s);this._map[o]?delete this._map[o]:this._enterBuffer.push(s),this._updateBuffer[r]=s,this._mapBuffer[o]=s}for(const r in this._map)this._exitBuffer.push(this._map[r]),delete this._map[r];const e=this._map;this._map=this._mapBuffer,this._mapBuffer=e;for(let r=0;r<this._exitBuffer.length;r++){const s=this._exitBuffer[r],o=this.key(s);for(const n of this._drivers){if(n.filter(s)){const h=n._componentsById[o];n.exit(s,h)}delete n._componentsById[o]}}for(let r=0;r<this._enterBuffer.length;r++){const s=this._enterBuffer[r],o=this.key(s);for(const n of this._drivers)if(n.filter(s)){const h=n.enter(s);h&&(n._componentsById[o]=h)}}for(let r=0;r<this._updateBuffer.length;r++){if(typeof t[r]!="object"||t[r]===null)continue;const s=this._updateBuffer[r],o=this.key(s);for(const n of this._drivers)if(n.filter(s)){const h=n._componentsById[o];n.update(s,h)}}this._enterBuffer.length=0,this._exitBuffer.length=0,this._updateBuffer.length=0}}class bo{constructor(){this.key="scorecard-"+Math.random(),this.type="scorecard",this.score=0}}class jr{constructor(t,e={x:0,y:0}){this.key="fruit-"+Math.random(),this.type="fruit",this.collected=!1,this.level=t,this.position=e}get radius(){return this.level/6+.2}}class wo{constructor(t,e){this.key="bucket-"+Math.random(),this.type="bucket",this.width=t,this.height=e}}const Vo=11;class Co extends pi{constructor(){super(),this.on("activate",this.handleActivate),this.on("main-start",this.handleStart),this.on("drop-next-fruit",this.handleDropFruit),this.on("move-next-fruit",this.handleMoveFruit),this.on("collide-fruits",this.handleCollideFruits),this.on("collide-top",this.handleCollideTop)}handleStart(){this.context.scorecard=new bo,this.context.scorecard.gameState="game-play",this.createNextFruit(),this.emit("game-update")}handleActivate(){}createNextFruit(t={x:0,y:0}){var r;if(((r=this.context.scorecard)==null?void 0:r.gameState)!=="game-play")return;const e=Math.floor(Math.random()*6)+1;this.context.next=new jr(e),this.setInitFruitPosition(this.context.next,t)}handleMoveFruit(t){this.context.next&&this.setInitFruitPosition(this.context.next,t)}handleDropFruit(t){if(this.context.next){const e=this.context.next;this.setInitFruitPosition(e,t),this.context.fruits.push(e),this.context.next=null}this.createNextFruit(t),this.emit("game-update")}handleCollideTop({fruit:t}){var e;((e=this.context.scorecard)==null?void 0:e.gameState)==="game-play"&&(t.collected||(this.context.next=null,this.context.scorecard.gameState="game-over",this.context.fruits=[]))}handleCollideFruits({fruitA:t,fruitB:e}){var o;if(((o=this.context.scorecard)==null?void 0:o.gameState)!=="game-play"||t.collected||e.collected)return;t.collected=!0,e.collected=!0;const r=t.level;if(this.context.fruits=this.context.fruits.filter(n=>n!==t&&n!==e),this.context.scorecard.score+=r,r>=Vo)return;const s=new jr(r+1);s.position.x=(t.position.x+e.position.x)/2,s.position.y=(t.position.y+e.position.y)/2,this.context.fruits.push(s),this.emit("game-update")}setInitFruitPosition(t,e){const r=this.context.bucket.width/2,s=this.context.bucket.height/2,o=r-t.radius,n=-o,h=Math.min(o,Math.max(n,e.x)),m=-(s-2);t.position.x=h,t.position.y=m}}const Ke="http://www.w3.org/2000/svg";class Mo extends pi{constructor(){super(),this.getSvgPoint=t=>{if(!this.svg)return;const e=new DOMPoint(t.clientX,t.clientY),r=this.svg.getScreenCTM();return r?e.matrixTransform(r.inverse()):void 0},this.pointerDown=!1,this.handlePointerDown=t=>{this.pointerDown=!0;const e=this.getSvgPoint(t);this.emit("move-next-fruit",e)},this.handlePointerMove=t=>{if(!this.context.next||!this.pointerDown)return;t.preventDefault();const e=this.getSvgPoint(t);this.emit("move-next-fruit",e)},this.handlePointerUp=t=>{this.pointerDown=!1;const e=this.getSvgPoint(t);this.emit("drop-next-fruit",e)},this.handleFrameRender=()=>{this.dataset.data([this.context.scorecard,...this.context.fruits,this.context.next,this.context.bucket])},this.fruitsDriver=Oe.create({filter:t=>t.type=="fruit",enter:t=>{const e=document.createElementNS(Ke,"circle");return e.classList.add("fruit"),e.classList.add("level-"+t.level),e.setAttribute("r",String(t.radius-.06)),this.fruitsGroup.appendChild(e),e},update:(t,e)=>{e.setAttribute("cx",String(t.position.x)),e.setAttribute("cy",String(t.position.y))},exit:(t,e)=>{e.remove()}}),this.bucketDriver=Oe.create({filter:t=>t.type=="bucket",enter:t=>{const e=t.width/2+.06,r=t.height/2+.06,s=document.createElementNS(Ke,"rect");return s.classList.add("bucket"),s.setAttribute("x",String(-e)),s.setAttribute("y",String(-r)),s.setAttribute("width",String(e*2)),s.setAttribute("height",String(r*2)),s.setAttribute("rx",String(t.height/50)),s.setAttribute("ry",String(t.height/50)),this.bucketGroup.prepend(s),s},update:(t,e)=>{},exit:(t,e)=>{e.remove()}}),this.scorecardDriver=Oe.create({filter:t=>t.type==="scorecard",enter:t=>{const e=document.createElementNS(Ke,"text");return e.classList.add("score"),this.scorecardGroup.appendChild(e),e},update:(t,e)=>{e.setAttribute("x",String(-this.context.bucket.width/2+.5)),e.setAttribute("y",String(-this.context.bucket.height/2-1)),e.textContent!==String(t.score)&&(e.textContent=String(t.score))},exit:(t,e)=>{e.remove()}}),this.dataset=lr.create({key:t=>t.key,drivers:[this.fruitsDriver,this.bucketDriver,this.scorecardDriver]}),this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate),this.on("frame-render",this.handleFrameRender),this.on("main-start",this.handleStart),this.scorecardGroup=document.createElementNS(Ke,"g"),this.fruitsGroup=document.createElementNS(Ke,"g"),this.bucketGroup=document.createElementNS(Ke,"g")}handleActivate(){const t=document.getElementById("polymatic-watermelon");t&&t instanceof SVGSVGElement?(this.svg=t,this.svg.addEventListener("pointerdown",this.handlePointerDown),this.svg.addEventListener("pointermove",this.handlePointerMove),this.svg.addEventListener("pointerup",this.handlePointerUp),this.svg.appendChild(this.bucketGroup),this.svg.appendChild(this.fruitsGroup),this.svg.appendChild(this.scorecardGroup)):(this.svg=null,console.error("Container SVG element not found"))}handleDeactivate(){this.svg&&(this.svg.removeEventListener("pointerdown",this.handlePointerDown),this.svg.removeEventListener("pointermove",this.handlePointerMove),this.svg.removeEventListener("pointerup",this.handlePointerUp),this.svg=null)}handleStart(){}}/**
 * Planck.js v1.3.0
 * @license The MIT license
 * @copyright Copyright (c) 2024 Erin Catto, Ali Shakiba
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Fr=function(i,t){return Fr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])},Fr(i,t)};function dt(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Fr(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ft=function(){return ft=Object.assign||function(t){for(var e,r=1,s=arguments.length;r<s;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},ft.apply(this,arguments)},Ft=function(i,t){(i===null||typeof i>"u")&&(i={});var e=ft({},i);for(var r in t)t.hasOwnProperty(r)&&typeof i[r]>"u"&&(e[r]=t[r]);if(typeof Object.getOwnPropertySymbols=="function")for(var s=Object.getOwnPropertySymbols(t),o=0;o<s.length;o++){var n=s[o];t.propertyIsEnumerable(n)&&typeof i[n]>"u"&&(e[n]=t[n])}return e},Io=Math.random,Vt=1e-9,Po=Number.isFinite;function So(i){return i|=i>>1,i|=i>>2,i|=i>>4,i|=i>>8,i|=i>>16,i+1}function zo(i){return i>0&&(i&i-1)===0}function io(i,t,e){return typeof t>"u"?(e=1,t=0):typeof e>"u"&&(e=t,t=0),e>t?(i=(i-t)%(e-t),i+(i<0?e:t)):(i=(i-e)%(t-e),i+(i<=0?t:e))}function pt(i,t,e){return i<t?t:i>e?e:i}function Fo(i,t){return typeof i>"u"?(t=1,i=0):typeof t>"u"&&(t=i,i=0),i===t?i:Io()*(t-i)+i}var Ue=Object.create(Math);Ue.EPSILON=Vt;Ue.isFinite=Po;Ue.nextPowerOfTwo=So;Ue.isPowerOfTwo=zo;Ue.mod=io;Ue.clamp=pt;Ue.random=Fo;var Zr=Math.abs,ur=Math.sqrt,Xr=Math.max,Kr=Math.min,a=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);typeof t>"u"?(this.x=0,this.y=0):typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}return i.prototype._serialize=function(){return{x:this.x,y:this.y}},i._deserialize=function(t){var e=Object.create(i.prototype);return e.x=t.x,e.y=t.y,e},i.zero=function(){var t=Object.create(i.prototype);return t.x=0,t.y=0,t},i.neo=function(t,e){var r=Object.create(i.prototype);return r.x=t,r.y=e,r},i.clone=function(t){return i.neo(t.x,t.y)},i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:Number.isFinite(t.x)&&Number.isFinite(t.y)},i.assert=function(t){},i.prototype.clone=function(){return i.clone(this)},i.prototype.setZero=function(){return this.x=0,this.y=0,this},i.prototype.set=function(t,e){return typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},i.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},i.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.wSet=function(t,e,r,s){return typeof r<"u"||typeof s<"u"?this.setCombine(t,e,r,s):this.setMul(t,e)},i.prototype.setCombine=function(t,e,r,s){var o=t*e.x+r*s.x,n=t*e.y+r*s.y;return this.x=o,this.y=n,this},i.prototype.setMul=function(t,e){var r=t*e.x,s=t*e.y;return this.x=r,this.y=s,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.wAdd=function(t,e,r,s){return typeof r<"u"||typeof s<"u"?this.addCombine(t,e,r,s):this.addMul(t,e)},i.prototype.addCombine=function(t,e,r,s){var o=t*e.x+r*s.x,n=t*e.y+r*s.y;return this.x+=o,this.y+=n,this},i.prototype.addMul=function(t,e){var r=t*e.x,s=t*e.y;return this.x+=r,this.y+=s,this},i.prototype.wSub=function(t,e,r,s){return typeof r<"u"||typeof s<"u"?this.subCombine(t,e,r,s):this.subMul(t,e)},i.prototype.subCombine=function(t,e,r,s){var o=t*e.x+r*s.x,n=t*e.y+r*s.y;return this.x-=o,this.y-=n,this},i.prototype.subMul=function(t,e){var r=t*e.x,s=t*e.y;return this.x-=r,this.y-=s,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.mul=function(t){return this.x*=t,this.y*=t,this},i.prototype.length=function(){return i.lengthOf(this)},i.prototype.lengthSquared=function(){return i.lengthSquared(this)},i.prototype.normalize=function(){var t=this.length();if(t<Vt)return 0;var e=1/t;return this.x*=e,this.y*=e,t},i.normalize=function(t){var e=i.lengthOf(t);if(e<Vt)return i.zero();var r=1/e;return i.neo(t.x*r,t.y*r)},i.lengthOf=function(t){return ur(t.x*t.x+t.y*t.y)},i.lengthSquared=function(t){return t.x*t.x+t.y*t.y},i.distance=function(t,e){var r=t.x-e.x,s=t.y-e.y;return ur(r*r+s*s)},i.distanceSquared=function(t,e){var r=t.x-e.x,s=t.y-e.y;return r*r+s*s},i.areEqual=function(t,e){return t===e||typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y},i.skew=function(t){return i.neo(-t.y,t.x)},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return typeof e=="number"?i.neo(e*t.y,-e*t.x):typeof t=="number"?i.neo(-t*e.y,t*e.x):t.x*e.y-t.y*e.x},i.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},i.crossVec2Num=function(t,e){return i.neo(e*t.y,-e*t.x)},i.crossNumVec2=function(t,e){return i.neo(-t*e.y,t*e.x)},i.addCross=function(t,e,r){if(typeof r=="number")return i.neo(r*e.y+t.x,-r*e.x+t.y);if(typeof e=="number")return i.neo(-e*r.y+t.x,e*r.x+t.y)},i.addCrossVec2Num=function(t,e,r){return i.neo(r*e.y+t.x,-r*e.x+t.y)},i.addCrossNumVec2=function(t,e,r){return i.neo(-e*r.y+t.x,e*r.x+t.y)},i.add=function(t,e){return i.neo(t.x+e.x,t.y+e.y)},i.wAdd=function(t,e,r,s){return typeof r<"u"||typeof s<"u"?i.combine(t,e,r,s):i.mulNumVec2(t,e)},i.combine=function(t,e,r,s){return i.zero().setCombine(t,e,r,s)},i.sub=function(t,e){return i.neo(t.x-e.x,t.y-e.y)},i.mul=function(t,e){if(typeof t=="object")return i.neo(t.x*e,t.y*e);if(typeof e=="object")return i.neo(t*e.x,t*e.y)},i.mulVec2Num=function(t,e){return i.neo(t.x*e,t.y*e)},i.mulNumVec2=function(t,e){return i.neo(t*e.x,t*e.y)},i.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},i.neg=function(t){return i.neo(-t.x,-t.y)},i.abs=function(t){return i.neo(Zr(t.x),Zr(t.y))},i.mid=function(t,e){return i.neo((t.x+e.x)*.5,(t.y+e.y)*.5)},i.upper=function(t,e){return i.neo(Xr(t.x,e.x),Xr(t.y,e.y))},i.lower=function(t,e){return i.neo(Kr(t.x,e.x),Kr(t.y,e.y))},i.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var r=t/ur(e);this.x*=r,this.y*=r}return this},i.clamp=function(t,e){var r=i.neo(t.x,t.y);return r.clamp(e),r},i.clampVec2=function(t,e,r){return{x:pt(t.x,e==null?void 0:e.x,r==null?void 0:r.x),y:pt(t.y,e==null?void 0:e.y,r==null?void 0:r.y)}},i.scaleFn=function(t,e){return function(r){return i.neo(r.x*t,r.y*e)}},i.translateFn=function(t,e){return function(r){return i.neo(r.x+t,r.y+e)}},i}(),Tt=Math.max,$t=Math.min,_t=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);this.lowerBound=a.zero(),this.upperBound=a.zero(),typeof t=="object"&&this.lowerBound.setVec2(t),typeof e=="object"?this.upperBound.setVec2(e):typeof t=="object"&&this.upperBound.setVec2(t)}return i.prototype.isValid=function(){return i.isValid(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:a.isValid(t.lowerBound)&&a.isValid(t.upperBound)&&a.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},i.assert=function(t){},i.prototype.getCenter=function(){return a.neo((this.lowerBound.x+this.upperBound.x)*.5,(this.lowerBound.y+this.upperBound.y)*.5)},i.prototype.getExtents=function(){return a.neo((this.upperBound.x-this.lowerBound.x)*.5,(this.upperBound.y-this.lowerBound.y)*.5)},i.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},i.prototype.combine=function(t,e){e=e||this;var r=t.lowerBound,s=t.upperBound,o=e.lowerBound,n=e.upperBound,h=$t(r.x,o.x),m=$t(r.y,o.y),u=Tt(n.x,s.x),l=Tt(n.y,s.y);this.lowerBound.setNum(h,m),this.upperBound.setNum(u,l)},i.prototype.combinePoints=function(t,e){this.lowerBound.setNum($t(t.x,e.x),$t(t.y,e.y)),this.upperBound.setNum(Tt(t.x,e.x),Tt(t.y,e.y))},i.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},i.prototype.contains=function(t){var e=!0;return e=e&&this.lowerBound.x<=t.lowerBound.x,e=e&&this.lowerBound.y<=t.lowerBound.y,e=e&&t.upperBound.x<=this.upperBound.x,e=e&&t.upperBound.y<=this.upperBound.y,e},i.prototype.extend=function(t){return i.extend(this,t),this},i.extend=function(t,e){return t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e,t},i.testOverlap=function(t,e){var r=e.lowerBound.x-t.upperBound.x,s=t.lowerBound.x-e.upperBound.x,o=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(r>0||o>0||s>0||n>0)},i.areEqual=function(t,e){return a.areEqual(t.lowerBound,e.lowerBound)&&a.areEqual(t.upperBound,e.upperBound)},i.diff=function(t,e){var r=Tt(0,$t(t.upperBound.x,e.upperBound.x)-Tt(e.lowerBound.x,t.lowerBound.x)),s=Tt(0,$t(t.upperBound.y,e.upperBound.y)-Tt(e.lowerBound.y,t.lowerBound.y)),o=t.upperBound.x-t.lowerBound.x,n=t.upperBound.y-t.lowerBound.y,h=e.upperBound.x-e.lowerBound.x,m=e.upperBound.y-e.lowerBound.y;return o*n+h*m-r*s},i.prototype.rayCast=function(t,e){for(var r=-1/0,s=1/0,o=e.p1,n=a.sub(e.p2,e.p1),h=a.abs(n),m=a.zero(),u="x";u!==null;u=u==="x"?"y":null)if(h.x<Vt){if(o[u]<this.lowerBound[u]||this.upperBound[u]<o[u])return!1}else{var l=1/n[u],p=(this.lowerBound[u]-o[u])*l,_=(this.upperBound[u]-o[u])*l,c=-1;if(p>_){var y=p;p=_,_=y,c=1}if(p>r&&(m.setZero(),m[u]=c,r=p),s=$t(s,_),r>s)return!1}return r<0||e.maxFraction<r?!1:(t.fraction=r,t.normal=m,!0)},i.prototype.toString=function(){return JSON.stringify(this)},i.combinePoints=function(t,e,r){return t.lowerBound.x=$t(e.x,r.x),t.lowerBound.y=$t(e.y,r.y),t.upperBound.x=Tt(e.x,r.x),t.upperBound.y=Tt(e.y,r.y),t},i.combinedPerimeter=function(t,e){var r=$t(t.lowerBound.x,e.lowerBound.x),s=$t(t.lowerBound.y,e.lowerBound.y),o=Tt(t.upperBound.x,e.upperBound.x),n=Tt(t.upperBound.y,e.upperBound.y);return 2*(o-r+n-s)},i}(),Ti=Math.PI,N=function(){function i(){}return Object.defineProperty(i,"polygonRadius",{get:function(){return 2*i.linearSlop},enumerable:!1,configurable:!0}),i.lengthUnitsPerMeter=1,i.maxManifoldPoints=2,i.maxPolygonVertices=12,i.aabbExtension=.1,i.aabbMultiplier=2,i.linearSlop=.005,i.angularSlop=2/180*Ti,i.maxSubSteps=8,i.maxTOIContacts=32,i.maxTOIIterations=20,i.maxDistanceIterations=20,i.velocityThreshold=1,i.maxLinearCorrection=.2,i.maxAngularCorrection=8/180*Ti,i.maxTranslation=2,i.maxRotation=.5*Ti,i.baumgarte=.2,i.toiBaugarte=.75,i.timeToSleep=.5,i.linearSleepTolerance=.01,i.angularSleepTolerance=2/180*Ti,i}(),S=function(){function i(){}return Object.defineProperty(i,"maxManifoldPoints",{get:function(){return N.maxManifoldPoints},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxPolygonVertices",{get:function(){return N.maxPolygonVertices},enumerable:!1,configurable:!0}),Object.defineProperty(i,"aabbExtension",{get:function(){return N.aabbExtension*N.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"aabbMultiplier",{get:function(){return N.aabbMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSlop",{get:function(){return N.linearSlop*N.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSlopSquared",{get:function(){return N.linearSlop*N.lengthUnitsPerMeter*N.linearSlop*N.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSlop",{get:function(){return N.angularSlop},enumerable:!1,configurable:!0}),Object.defineProperty(i,"polygonRadius",{get:function(){return 2*N.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxSubSteps",{get:function(){return N.maxSubSteps},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTOIContacts",{get:function(){return N.maxTOIContacts},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTOIIterations",{get:function(){return N.maxTOIIterations},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxDistanceIterations",{get:function(){return N.maxDistanceIterations},enumerable:!1,configurable:!0}),Object.defineProperty(i,"velocityThreshold",{get:function(){return N.velocityThreshold*N.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxLinearCorrection",{get:function(){return N.maxLinearCorrection*N.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxAngularCorrection",{get:function(){return N.maxAngularCorrection},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTranslation",{get:function(){return N.maxTranslation*N.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxTranslationSquared",{get:function(){return N.maxTranslation*N.lengthUnitsPerMeter*N.maxTranslation*N.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxRotation",{get:function(){return N.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(i,"maxRotationSquared",{get:function(){return N.maxRotation*N.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(i,"baumgarte",{get:function(){return N.baumgarte},enumerable:!1,configurable:!0}),Object.defineProperty(i,"toiBaugarte",{get:function(){return N.toiBaugarte},enumerable:!1,configurable:!0}),Object.defineProperty(i,"timeToSleep",{get:function(){return N.timeToSleep},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSleepTolerance",{get:function(){return N.linearSleepTolerance*N.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"linearSleepToleranceSqr",{get:function(){return N.linearSleepTolerance*N.lengthUnitsPerMeter*N.linearSleepTolerance*N.lengthUnitsPerMeter},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSleepTolerance",{get:function(){return N.angularSleepTolerance},enumerable:!1,configurable:!0}),Object.defineProperty(i,"angularSleepToleranceSqr",{get:function(){return N.angularSleepTolerance*N.angularSleepTolerance},enumerable:!1,configurable:!0}),i}(),Ii=function(){function i(t){this._list=[],this._max=1/0,this._hasCreateFn=!1,this._createCount=0,this._hasAllocateFn=!1,this._allocateCount=0,this._hasReleaseFn=!1,this._releaseCount=0,this._hasDisposeFn=!1,this._disposeCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._hasCreateFn=typeof this._createFn=="function",this._allocateFn=t.allocate,this._hasAllocateFn=typeof this._allocateFn=="function",this._releaseFn=t.release,this._hasReleaseFn=typeof this._releaseFn=="function",this._disposeFn=t.dispose,this._hasDisposeFn=typeof this._disposeFn=="function"}return i.prototype.max=function(t){return typeof t=="number"?(this._max=t,this):this._max},i.prototype.size=function(){return this._list.length},i.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,this._hasCreateFn?t=this._createFn():t={}),this._allocateCount++,this._hasAllocateFn&&this._allocateFn(t),t},i.prototype.release=function(t){this._list.length<this._max?(this._releaseCount++,this._hasReleaseFn&&this._releaseFn(t),this._list.push(t)):(this._disposeCount++,this._hasDisposeFn&&(t=this._disposeFn(t)))},i.prototype.toString=function(){return" +"+this._createCount+" >"+this._allocateCount+" <"+this._releaseCount+" -"+this._disposeCount+" ="+this._list.length+"/"+this._max},i}(),Gr=Math.abs,Mt=Math.max,Lo=function(){function i(t){this.aabb=new _t,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return i.prototype.toString=function(){return this.id+": "+this.userData},i.prototype.isLeaf=function(){return this.child1==null},i}(),Qr=new Ii({create:function(){return new Lo},release:function(i){i.userData=null,i.parent=null,i.child1=null,i.child2=null,i.height=-1,i.id=void 0}}),To=function(){function i(){this.inputPool=new Ii({create:function(){return{}},release:function(t){}}),this.stackPool=new Ii({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new Ii({create:function(){return new qo},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0}return i.prototype.getUserData=function(t){var e=this.m_nodes[t];return e.userData},i.prototype.getFatAABB=function(t){var e=this.m_nodes[t];return e.aabb},i.prototype.allocateNode=function(){var t=Qr.allocate();return t.id=++this.m_lastProxyId,this.m_nodes[t.id]=t,t},i.prototype.freeNode=function(t){delete this.m_nodes[t.id],Qr.release(t)},i.prototype.createProxy=function(t,e){var r=this.allocateNode();return r.aabb.set(t),_t.extend(r.aabb,S.aabbExtension),r.userData=e,r.height=0,this.insertLeaf(r),r.id},i.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},i.prototype.moveProxy=function(t,e,r){var s=this.m_nodes[t];return s.aabb.contains(e)?!1:(this.removeLeaf(s),s.aabb.set(e),e=s.aabb,_t.extend(e,S.aabbExtension),r.x<0?e.lowerBound.x+=r.x*S.aabbMultiplier:e.upperBound.x+=r.x*S.aabbMultiplier,r.y<0?e.lowerBound.y+=r.y*S.aabbMultiplier:e.upperBound.y+=r.y*S.aabbMultiplier,this.insertLeaf(s),!0)},i.prototype.insertLeaf=function(t){if(this.m_root==null){this.m_root=t,this.m_root.parent=null;return}for(var e=t.aabb,r=this.m_root;!r.isLeaf();){var s=r.child1,o=r.child2,n=r.aabb.getPerimeter(),h=_t.combinedPerimeter(r.aabb,e),m=2*h,u=2*(h-n),l=_t.combinedPerimeter(e,s.aabb),p=l+u;if(!s.isLeaf()){var _=s.aabb.getPerimeter();p-=_}var c=_t.combinedPerimeter(e,o.aabb),y=c+u;if(!o.isLeaf()){var _=o.aabb.getPerimeter();y-=_}if(m<p&&m<y)break;p<y?r=s:r=o}var v=r,f=v.parent,d=this.allocateNode();for(d.parent=f,d.userData=null,d.aabb.combine(e,v.aabb),d.height=v.height+1,f!=null?(f.child1===v?f.child1=d:f.child2=d,d.child1=v,d.child2=t,v.parent=d,t.parent=d):(d.child1=v,d.child2=t,v.parent=d,t.parent=d,this.m_root=d),r=t.parent;r!=null;){r=this.balance(r);var s=r.child1,o=r.child2;r.height=1+Mt(s.height,o.height),r.aabb.combine(s.aabb,o.aabb),r=r.parent}},i.prototype.removeLeaf=function(t){if(t===this.m_root){this.m_root=null;return}var e=t.parent,r=e.parent,s;if(e.child1===t?s=e.child2:s=e.child1,r!=null){r.child1===e?r.child1=s:r.child2=s,s.parent=r,this.freeNode(e);for(var o=r;o!=null;){o=this.balance(o);var n=o.child1,h=o.child2;o.aabb.combine(n.aabb,h.aabb),o.height=1+Mt(n.height,h.height),o=o.parent}}else this.m_root=s,s.parent=null,this.freeNode(e)},i.prototype.balance=function(t){var e=t;if(e.isLeaf()||e.height<2)return t;var r=e.child1,s=e.child2,o=s.height-r.height;if(o>1){var n=s.child1,h=s.child2;return s.child1=e,s.parent=e.parent,e.parent=s,s.parent!=null?s.parent.child1===t?s.parent.child1=s:s.parent.child2=s:this.m_root=s,n.height>h.height?(s.child2=n,e.child2=h,h.parent=e,e.aabb.combine(r.aabb,h.aabb),s.aabb.combine(e.aabb,n.aabb),e.height=1+Mt(r.height,h.height),s.height=1+Mt(e.height,n.height)):(s.child2=h,e.child2=n,n.parent=e,e.aabb.combine(r.aabb,n.aabb),s.aabb.combine(e.aabb,h.aabb),e.height=1+Mt(r.height,n.height),s.height=1+Mt(e.height,h.height)),s}if(o<-1){var m=r.child1,u=r.child2;return r.child1=e,r.parent=e.parent,e.parent=r,r.parent!=null?r.parent.child1===e?r.parent.child1=r:r.parent.child2=r:this.m_root=r,m.height>u.height?(r.child2=m,e.child1=u,u.parent=e,e.aabb.combine(s.aabb,u.aabb),r.aabb.combine(e.aabb,m.aabb),e.height=1+Mt(s.height,u.height),r.height=1+Mt(e.height,m.height)):(r.child2=u,e.child1=m,m.parent=e,e.aabb.combine(s.aabb,m.aabb),r.aabb.combine(e.aabb,u.aabb),e.height=1+Mt(s.height,m.height),r.height=1+Mt(e.height,u.height)),r}return e},i.prototype.getHeight=function(){return this.m_root==null?0:this.m_root.height},i.prototype.getAreaRatio=function(){if(this.m_root==null)return 0;for(var t=this.m_root,e=t.aabb.getPerimeter(),r=0,s,o=this.iteratorPool.allocate().preorder(this.m_root);s=o.next();)s.height<0||(r+=s.aabb.getPerimeter());return this.iteratorPool.release(o),r/e},i.prototype.computeHeight=function(t){var e;if(typeof t<"u"?e=this.m_nodes[t]:e=this.m_root,e.isLeaf())return 0;var r=this.computeHeight(e.child1.id),s=this.computeHeight(e.child2.id);return 1+Mt(r,s)},i.prototype.validateStructure=function(t){if(t!=null){this.m_root;var e=t.child1,r=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(r))}},i.prototype.validateMetrics=function(t){if(t!=null){var e=t.child1,r=t.child2;if(!t.isLeaf()){e.height,r.height;var s=new _t;s.combine(e.aabb,r.aabb),this.validateMetrics(e),this.validateMetrics(r)}}},i.prototype.validate=function(){},i.prototype.getMaxBalance=function(){for(var t=0,e,r=this.iteratorPool.allocate().preorder(this.m_root);e=r.next();)if(!(e.height<=1)){var s=Gr(e.child2.height-e.child1.height);t=Mt(t,s)}return this.iteratorPool.release(r),t},i.prototype.rebuildBottomUp=function(){for(var t=[],e=0,r,s=this.iteratorPool.allocate().preorder(this.m_root);r=s.next();)r.height<0||(r.isLeaf()?(r.parent=null,t[e]=r,++e):this.freeNode(r));for(this.iteratorPool.release(s);e>1;){for(var o=1/0,n=-1,h=-1,m=0;m<e;++m)for(var u=t[m].aabb,l=m+1;l<e;++l){var p=t[l].aabb,_=_t.combinedPerimeter(u,p);_<o&&(n=m,h=l,o=_)}var c=t[n],y=t[h],v=this.allocateNode();v.child1=c,v.child2=y,v.height=1+Mt(c.height,y.height),v.aabb.combine(c.aabb,y.aabb),v.parent=null,c.parent=v,y.parent=v,t[h]=t[e-1],t[n]=v,--e}this.m_root=t[0]},i.prototype.shiftOrigin=function(t){for(var e,r=this.iteratorPool.allocate().preorder(this.m_root);e=r.next();){var s=e.aabb;s.lowerBound.x-=t.x,s.lowerBound.y-=t.y,s.upperBound.x-=t.x,s.upperBound.y-=t.y}this.iteratorPool.release(r)},i.prototype.query=function(t,e){var r=this.stackPool.allocate();for(r.push(this.m_root);r.length>0;){var s=r.pop();if(s!=null&&_t.testOverlap(s.aabb,t))if(s.isLeaf()){var o=e(s.id);if(o===!1)return}else r.push(s.child1),r.push(s.child2)}this.stackPool.release(r)},i.prototype.rayCast=function(t,e){var r=t.p1,s=t.p2,o=a.sub(s,r);o.normalize();var n=a.crossNumVec2(1,o),h=a.abs(n),m=t.maxFraction,u=new _t,l=a.combine(1-m,r,m,s);u.combinePoints(r,l);var p=this.stackPool.allocate(),_=this.inputPool.allocate();for(p.push(this.m_root);p.length>0;){var c=p.pop();if(c!=null&&_t.testOverlap(c.aabb,u)!==!1){var y=c.aabb.getCenter(),v=c.aabb.getExtents(),f=Gr(a.dot(n,a.sub(r,y)))-a.dot(h,v);if(!(f>0))if(c.isLeaf()){_.p1=a.clone(t.p1),_.p2=a.clone(t.p2),_.maxFraction=m;var d=e(_,c.id);if(d===0)break;d>0&&(m=d,l=a.combine(1-m,r,m,s),u.combinePoints(r,l))}else p.push(c.child1),p.push(c.child2)}}this.stackPool.release(p),this.inputPool.release(_)},i}(),qo=function(){function i(){this.parents=[],this.states=[]}return i.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},i.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(this.states[t]===0)return this.states[t]=1,e;if(this.states[t]===1&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(this.states[t]===2&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},i.prototype.close=function(){this.parents.length=0},i}(),ko=Math.max,No=Math.min,Do=function(){function i(){var t=this;this.m_tree=new To,this.m_moveBuffer=[],this.query=function(e,r){t.m_tree.query(e,r)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var r=No(e,t.m_queryProxyId),s=ko(e,t.m_queryProxyId),o=t.m_tree.getUserData(r),n=t.m_tree.getUserData(s);return t.m_callback(o,n),!0}}return i.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},i.prototype.testOverlap=function(t,e){var r=this.m_tree.getFatAABB(t),s=this.m_tree.getFatAABB(e);return _t.testOverlap(r,s)},i.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},i.prototype.getProxyCount=function(){return this.m_moveBuffer.length},i.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},i.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},i.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},i.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},i.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},i.prototype.createProxy=function(t,e){var r=this.m_tree.createProxy(t,e);return this.bufferMove(r),r},i.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_tree.destroyProxy(t)},i.prototype.moveProxy=function(t,e,r){var s=this.m_tree.moveProxy(t,e,r);s&&this.bufferMove(t)},i.prototype.touchProxy=function(t){this.bufferMove(t)},i.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},i.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},i.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),this.m_queryProxyId!==null){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},i}(),ro=Math.sin,so=Math.cos,Lr=Math.sqrt;function g(i,t){return{x:i,y:t}}function Ro(i){return{s:ro(i),c:so(i)}}function ut(i,t,e){return i.x=t,i.y=e,i}function x(i,t){return i.x=t.x,i.y=t.y,i}function z(i){return i.x=0,i.y=0,i}function Si(i){return i.x=-i.x,i.y=-i.y,i}function Rt(i,t){return i.x+=t.x,i.y+=t.y,i}function Eo(i,t,e){return i.x=t.x+e.x,i.y=t.x+e.y,i}function ue(i,t){return i.x-=t.x,i.y-=t.y,i}function q(i,t,e){return i.x=t.x-e.x,i.y=t.y-e.y,i}function ts(i,t){return i.x*=t,i.y*=t,i}function F(i,t,e){return i.x=t*e.x,i.y=t*e.y,i}function jt(i,t,e){return i.x+=t*e.x,i.y+=t*e.y,i}function Mi(i,t,e){return i.x-=t*e.x,i.y-=t*e.y,i}function K(i,t,e,r,s){return i.x=t*e.x+r*s.x,i.y=t*e.y+r*s.y,i}function re(i,t,e,r,s,o,n){return i.x=t*e.x+r*s.x+o*n.x,i.y=t*e.y+r*s.y+o*n.y,i}function Oo(i){var t=Lr(i.x*i.x+i.y*i.y);if(t!==0){var e=1/t;i.x*=e,i.y*=e}return t}function Zt(i){var t=Lr(i.x*i.x+i.y*i.y);if(t>0){var e=1/t;i.x*=e,i.y*=e}return i}function Je(i,t,e){var r=e*t.y,s=-1*t.x;return i.x=r,i.y=s,i}function St(i,t,e){var r=-t*e.y,s=t*e.x;return i.x=r,i.y=s,i}function D(i,t){return i.x*t.y-i.y*t.x}function C(i,t){return i.x*t.x+i.y*t.y}function $e(i){return i.x*i.x+i.y*i.y}function oo(i,t){var e=i.x-t.x,r=i.y-t.y;return Lr(e*e+r*r)}function Ye(i,t){var e=i.x-t.x,r=i.y-t.y;return e*e+r*r}function Jo(i,t){return i.c=so(t),i.s=ro(t),i}function Ot(i,t,e){return i.x=t.c*e.x-t.s*e.y,i.y=t.s*e.x+t.c*e.y,i}function _i(i,t,e){var r=t.c*e.x+t.s*e.y,s=-t.s*e.x+t.c*e.y;return i.x=r,i.y=s,i}function $o(i,t,e,r){var s=t.c*r.x+t.s*r.y,o=-t.s*r.x+t.c*r.y,n=e.c*s-e.s*o,h=e.s*s+e.c*o;return i.x=n,i.y=h,i}function He(i,t,e){return{p:g(i,t),q:Ro(e)}}function hr(i,t){return i.p.x=t.p.x,i.p.y=t.p.y,i.q.s=t.q.s,i.q.c=t.q.c,i}function T(i,t,e){var r=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return i.x=r,i.y=s,i}function Tr(i,t,e){var r=e.x-t.p.x,s=e.y-t.p.y,o=t.q.c*r+t.q.s*s,n=-t.q.s*r+t.q.c*s;return i.x=o,i.y=n,i}function no(i,t,e,r){var s=t.q.c*r.x-t.q.s*r.y+t.p.x,o=t.q.s*r.x+t.q.c*r.y+t.p.y,n=s-e.p.x,h=o-e.p.y,m=e.q.c*n+e.q.s*h,u=-e.q.s*n+e.q.c*h;return i.x=m,i.y=u,i}function ao(i,t,e){var r=t.q.c*e.q.c+t.q.s*e.q.s,s=t.q.c*e.q.s-t.q.s*e.q.c,o=t.q.c*(e.p.x-t.p.x)+t.q.s*(e.p.y-t.p.y),n=-t.q.s*(e.p.x-t.p.x)+t.q.c*(e.p.y-t.p.y);return i.q.c=r,i.q.s=s,i.p.x=o,i.p.y=n,i}var es=Math.sin,is=Math.cos,Yo=Math.atan2,B=function(){function i(t){if(!(this instanceof i))return new i(t);typeof t=="number"?this.setAngle(t):typeof t=="object"?this.setRot(t):this.setIdentity()}return i.neo=function(t){var e=Object.create(i.prototype);return e.setAngle(t),e},i.clone=function(t){var e=Object.create(i.prototype);return e.s=t.s,e.c=t.c,e},i.identity=function(){var t=Object.create(i.prototype);return t.s=0,t.c=1,t},i.isValid=function(t){return t===null||typeof t>"u"?!1:Number.isFinite(t.s)&&Number.isFinite(t.c)},i.assert=function(t){},i.prototype.setIdentity=function(){this.s=0,this.c=1},i.prototype.set=function(t){typeof t=="object"?(this.s=t.s,this.c=t.c):(this.s=es(t),this.c=is(t))},i.prototype.setRot=function(t){this.s=t.s,this.c=t.c},i.prototype.setAngle=function(t){this.s=es(t),this.c=is(t)},i.prototype.getAngle=function(){return Yo(this.s,this.c)},i.prototype.getXAxis=function(){return a.neo(this.c,this.s)},i.prototype.getYAxis=function(){return a.neo(-this.s,this.c)},i.mul=function(t,e){if("c"in e&&"s"in e){var r=i.identity();return r.s=t.s*e.c+t.c*e.s,r.c=t.c*e.c-t.s*e.s,r}else if("x"in e&&"y"in e)return a.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},i.mulRot=function(t,e){var r=i.identity();return r.s=t.s*e.c+t.c*e.s,r.c=t.c*e.c-t.s*e.s,r},i.mulVec2=function(t,e){return a.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},i.mulSub=function(t,e,r){var s=t.c*(e.x-r.x)-t.s*(e.y-r.y),o=t.s*(e.x-r.x)+t.c*(e.y-r.y);return a.neo(s,o)},i.mulT=function(t,e){if("c"in e&&"s"in e){var r=i.identity();return r.s=t.c*e.s-t.s*e.c,r.c=t.c*e.c+t.s*e.s,r}else if("x"in e&&"y"in e)return a.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},i.mulTRot=function(t,e){var r=i.identity();return r.s=t.c*e.s-t.s*e.c,r.c=t.c*e.c+t.s*e.s,r},i.mulTVec2=function(t,e){return a.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},i}(),Wo=Math.atan2,rs=Math.PI,Ie=g(0,0),ui=function(){function i(){this.localCenter=a.zero(),this.c=a.zero(),this.a=0,this.alpha0=0,this.c0=a.zero(),this.a0=0}return i.prototype.recycle=function(){z(this.localCenter),z(this.c),this.a=0,this.alpha0=0,z(this.c0),this.a0=0},i.prototype.setTransform=function(t){T(Ie,t,this.localCenter),x(this.c,Ie),x(this.c0,Ie),this.a=this.a0=Wo(t.q.s,t.q.c)},i.prototype.setLocalCenter=function(t,e){x(this.localCenter,t),T(Ie,e,this.localCenter),x(this.c,Ie),x(this.c0,Ie)},i.prototype.getTransform=function(t,e){e===void 0&&(e=0),Jo(t.q,(1-e)*this.a0+e*this.a),K(t.p,1-e,this.c0,e,this.c),ue(t.p,Ot(Ie,t.q,this.localCenter))},i.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);K(this.c0,e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},i.prototype.forward=function(){this.a0=this.a,x(this.c0,this.c)},i.prototype.normalize=function(){var t=io(this.a0,-rs,+rs);this.a-=this.a0-t,this.a0=t},i.prototype.set=function(t){x(this.localCenter,t.localCenter),x(this.c,t.c),this.a=t.a,this.alpha0=t.alpha0,x(this.c0,t.c0),this.a0=t.a0},i}(),Xt=function(){function i(t,e){if(!(this instanceof i))return new i(t,e);this.p=a.zero(),this.q=B.identity(),typeof t<"u"&&this.p.setVec2(t),typeof e<"u"&&this.q.setAngle(e)}return i.clone=function(t){var e=Object.create(i.prototype);return e.p=a.clone(t.p),e.q=B.clone(t.q),e},i.neo=function(t,e){var r=Object.create(i.prototype);return r.p=a.clone(t),r.q=B.clone(e),r},i.identity=function(){var t=Object.create(i.prototype);return t.p=a.zero(),t.q=B.identity(),t},i.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},i.prototype.set=function(t,e){typeof e>"u"?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},i.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},i.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},i.isValid=function(t){return t===null||typeof t>"u"?!1:a.isValid(t.p)&&B.isValid(t.q)},i.assert=function(t){},i.mul=function(t,e){if(Array.isArray(e)){for(var r=[],s=0;s<e.length;s++)r[s]=i.mul(t,e[s]);return r}else{if("x"in e&&"y"in e)return i.mulVec2(t,e);if("p"in e&&"q"in e)return i.mulXf(t,e)}},i.mulAll=function(t,e){for(var r=[],s=0;s<e.length;s++)r[s]=i.mul(t,e[s]);return r},i.mulFn=function(t){return function(e){return i.mul(t,e)}},i.mulVec2=function(t,e){var r=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return a.neo(r,s)},i.mulXf=function(t,e){var r=i.identity();return r.q=B.mulRot(t.q,e.q),r.p=a.add(B.mulVec2(t.q,e.p),t.p),r},i.mulT=function(t,e){if("x"in e&&"y"in e)return i.mulTVec2(t,e);if("p"in e&&"q"in e)return i.mulTXf(t,e)},i.mulTVec2=function(t,e){var r=e.x-t.p.x,s=e.y-t.p.y,o=t.q.c*r+t.q.s*s,n=-t.q.s*r+t.q.c*s;return a.neo(o,n)},i.mulTXf=function(t,e){var r=i.identity();return r.q.setRot(B.mulTRot(t.q,e.q)),r.p.setVec2(B.mulTVec2(t.q,a.sub(e.p,t.p))),r},i}(),Uo=function(){function i(){this.v=a.zero(),this.w=0}return i}(),ho=Math.sin,mo=Math.cos,Ho=function(){function i(){this.c=a.zero(),this.a=0}return i.prototype.getTransform=function(t,e){return t.q.c=mo(this.a),t.q.s=ho(this.a),t.p.x=this.c.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=this.c.y-(t.q.s*e.x+t.q.c*e.y),t},i}();function qi(i,t,e,r){return i.q.c=mo(r),i.q.s=ho(r),i.p.x=e.x-(i.q.c*t.x-i.q.s*t.y),i.p.y=e.y-(i.q.s*t.x+i.q.c*t.y),i}var je=function(){function i(){this.style={},this.appData={}}return i.isValid=function(t){return t===null||typeof t>"u"?!1:typeof t.m_type=="string"&&typeof t.m_radius=="number"},i}(),ss=new _t,os=new _t,ns=g(0,0),jo={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},as=function(){function i(t,e){this.aabb=new _t,this.fixture=t,this.childIndex=e}return i}(),mr=function(){function i(t,e,r){this.style={},this.appData={},e.shape?(r=e,e=e.shape):typeof r=="number"&&(r={density:r}),r=Ft(r,jo),this.m_body=t,this.m_friction=r.friction,this.m_restitution=r.restitution,this.m_density=r.density,this.m_isSensor=r.isSensor,this.m_filterGroupIndex=r.filterGroupIndex,this.m_filterCategoryBits=r.filterCategoryBits,this.m_filterMaskBits=r.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var s=this.m_shape.getChildCount(),o=0;o<s;++o)this.m_proxies[o]=new as(this,o);this.m_userData=r.userData,typeof r.style=="object"&&r.style!==null&&(this.style=r.style)}return i.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var r=this.m_shape.getChildCount(),s=0;s<r;++s)this.m_proxies[s]=new as(this,s);this.createProxies(e,t.m_xf),t.resetMassData()},i.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},i._deserialize=function(t,e,r){var s=r(je,t.shape),o=s&&new i(e,s,t);return o},i.prototype.getType=function(){return this.m_shape.m_type},i.prototype.getShape=function(){return this.m_shape},i.prototype.isSensor=function(){return this.m_isSensor},i.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},i.prototype.getUserData=function(){return this.m_userData},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getBody=function(){return this.m_body},i.prototype.getNext=function(){return this.m_next},i.prototype.getDensity=function(){return this.m_density},i.prototype.setDensity=function(t){this.m_density=t},i.prototype.getFriction=function(){return this.m_friction},i.prototype.setFriction=function(t){this.m_friction=t},i.prototype.getRestitution=function(){return this.m_restitution},i.prototype.setRestitution=function(t){this.m_restitution=t},i.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},i.prototype.rayCast=function(t,e,r){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),r)},i.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},i.prototype.getAABB=function(t){return this.m_proxies[t].aabb},i.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var r=0;r<this.m_proxyCount;++r){var s=this.m_proxies[r];this.m_shape.computeAABB(s.aabb,e,r),s.proxyId=t.createProxy(s.aabb,s)}},i.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var r=this.m_proxies[e];t.destroyProxy(r.proxyId),r.proxyId=null}this.m_proxyCount=0},i.prototype.synchronize=function(t,e,r){for(var s=0;s<this.m_proxyCount;++s){var o=this.m_proxies[s];this.m_shape.computeAABB(ss,e,o.childIndex),this.m_shape.computeAABB(os,r,o.childIndex),o.aabb.combine(ss,os),q(ns,r.p,e.p),t.moveProxy(o.proxyId,o.aabb,ns)}},i.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},i.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},i.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t,this.refilter()},i.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},i.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t,this.refilter()},i.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},i.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t,this.refilter()},i.prototype.refilter=function(){if(this.m_body!=null){for(var t=this.m_body.getContactList();t;){var e=t.contact,r=e.getFixtureA(),s=e.getFixtureB();(r==this||s==this)&&e.flagForFiltering(),t=t.next}var o=this.m_body.getWorld();if(o!=null)for(var n=o.m_broadPhase,h=0;h<this.m_proxyCount;++h)n.touchProxy(this.m_proxies[h].proxyId)}},i.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&t.m_filterGroupIndex!==0)return t.m_filterGroupIndex>0;var e=(t.m_filterMaskBits&this.m_filterCategoryBits)!==0,r=(t.m_filterCategoryBits&this.m_filterMaskBits)!==0,s=e&&r;return s},i}(),li="static",hs="kinematic",Yt="dynamic",ki=g(0,0),Pe=g(0,0),Ni=g(0,0),Di=g(0,0),ms=He(0,0,0),Zo={type:li,position:a.zero(),angle:0,linearVelocity:a.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},W=function(){function i(t,e){this.style={},this.appData={},e=Ft(e,Zo),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==Yt?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=Xt.identity(),this.m_xf.p.setVec2(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new ui,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new Uo,this.c_position=new Ho,this.m_force=a.zero(),this.m_torque=0,this.m_linearVelocity=a.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1,typeof e.style=="object"&&e.style!==null&&(this.style=e.style)}return i.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},i._deserialize=function(t,e,r){var s=new i(e,t);if(t.fixtures)for(var o=t.fixtures.length-1;o>=0;o--){var n=r(mr,t.fixtures[o],s);s._addFixture(n)}return s},i.prototype.isWorldLocked=function(){return!!(this.m_world&&this.m_world.isLocked())},i.prototype.getWorld=function(){return this.m_world},i.prototype.getNext=function(){return this.m_next},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getUserData=function(){return this.m_userData},i.prototype.getFixtureList=function(){return this.m_fixtureList},i.prototype.getJointList=function(){return this.m_jointList},i.prototype.getContactList=function(){return this.m_contactList},i.prototype.isStatic=function(){return this.m_type==li},i.prototype.isDynamic=function(){return this.m_type==Yt},i.prototype.isKinematic=function(){return this.m_type==hs},i.prototype.setStatic=function(){return this.setType(li),this},i.prototype.setDynamic=function(){return this.setType(Yt),this},i.prototype.setKinematic=function(){return this.setType(hs),this},i.prototype.getType=function(){return this.m_type},i.prototype.setType=function(t){if(this.isWorldLocked()!=!0&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==li&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var r=e;e=e.next,this.m_world.destroyContact(r.contact)}this.m_contactList=null;for(var s=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)for(var n=0;n<o.m_proxyCount;++n)s.touchProxy(o.m_proxies[n].proxyId)}},i.prototype.isBullet=function(){return this.m_bulletFlag},i.prototype.setBullet=function(t){this.m_bulletFlag=!!t},i.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},i.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,this.m_autoSleepFlag==!1&&this.setAwake(!0)},i.prototype.isAwake=function(){return this.m_awakeFlag},i.prototype.setAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},i.prototype.isActive=function(){return this.m_activeFlag},i.prototype.setActive=function(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag){for(var e=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)r.createProxies(e,this.m_xf);this.m_world.m_newFixture=!0}else{for(var e=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)r.destroyProxies(e);for(var s=this.m_contactList;s;){var o=s;s=s.next,this.m_world.destroyContact(o.contact)}this.m_contactList=null}},i.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},i.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},i.prototype.getTransform=function(){return this.m_xf},i.prototype.setTransform=function(t,e){if(this.isWorldLocked()!=!0){typeof e=="number"?this.m_xf.setNum(t,e):this.m_xf.setTransform(t),this.m_sweep.setTransform(this.m_xf);for(var r=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.synchronize(r,this.m_xf,this.m_xf);this.setAwake(!0)}},i.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},i.prototype.synchronizeFixtures=function(){this.m_sweep.getTransform(ms,0);for(var t=this.m_world.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,ms,this.m_xf)},i.prototype.advance=function(t){this.m_sweep.advance(t),x(this.m_sweep.c,this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},i.prototype.getPosition=function(){return this.m_xf.p},i.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},i.prototype.getAngle=function(){return this.m_sweep.a},i.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},i.prototype.getWorldCenter=function(){return this.m_sweep.c},i.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},i.prototype.getLinearVelocity=function(){return this.m_linearVelocity},i.prototype.getLinearVelocityFromWorldPoint=function(t){var e=a.sub(t,this.m_sweep.c);return a.add(this.m_linearVelocity,a.crossNumVec2(this.m_angularVelocity,e))},i.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},i.prototype.setLinearVelocity=function(t){this.m_type!=li&&(a.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},i.prototype.getAngularVelocity=function(){return this.m_angularVelocity},i.prototype.setAngularVelocity=function(t){this.m_type!=li&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},i.prototype.getLinearDamping=function(){return this.m_linearDamping},i.prototype.setLinearDamping=function(t){this.m_linearDamping=t},i.prototype.getAngularDamping=function(){return this.m_angularDamping},i.prototype.setAngularDamping=function(t){this.m_angularDamping=t},i.prototype.getGravityScale=function(){return this.m_gravityScale},i.prototype.setGravityScale=function(t){this.m_gravityScale=t},i.prototype.getMass=function(){return this.m_mass},i.prototype.getInertia=function(){return this.m_I+this.m_mass*a.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},i.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),x(t.center,this.m_sweep.localCenter)},i.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,z(this.m_sweep.localCenter),this.isStatic()||this.isKinematic()){x(this.m_sweep.c0,this.m_xf.p),x(this.m_sweep.c,this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}z(Pe);for(var t=this.m_fixtureList;t;t=t.m_next)if(t.m_density!=0){var e={mass:0,center:g(0,0),I:0};t.getMassData(e),this.m_mass+=e.mass,jt(Pe,e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,F(Pe,this.m_invMass,Pe)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&this.m_fixedRotationFlag==!1?(this.m_I-=this.m_mass*C(Pe,Pe),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),x(ki,this.m_sweep.c),this.m_sweep.setLocalCenter(Pe,this.m_xf),q(Ni,this.m_sweep.c,ki),St(Di,this.m_angularVelocity,Ni),Rt(this.m_linearVelocity,Di)},i.prototype.setMassData=function(t){this.isWorldLocked()!=!0&&this.m_type==Yt&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&this.m_fixedRotationFlag==!1&&(this.m_I=t.I-this.m_mass*C(t.center,t.center),this.m_invI=1/this.m_I),x(ki,this.m_sweep.c),this.m_sweep.setLocalCenter(t.center,this.m_xf),q(Ni,this.m_sweep.c,ki),St(Di,this.m_angularVelocity,Ni),Rt(this.m_linearVelocity,Di))},i.prototype.applyForce=function(t,e,r){r===void 0&&(r=!0),this.m_type==Yt&&(r&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=a.crossVec2Vec2(a.sub(e,this.m_sweep.c),t)))},i.prototype.applyForceToCenter=function(t,e){e===void 0&&(e=!0),this.m_type==Yt&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},i.prototype.applyTorque=function(t,e){e===void 0&&(e=!0),this.m_type==Yt&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},i.prototype.applyLinearImpulse=function(t,e,r){r===void 0&&(r=!0),this.m_type==Yt&&(r&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*a.crossVec2Vec2(a.sub(e,this.m_sweep.c),t)))},i.prototype.applyAngularImpulse=function(t,e){e===void 0&&(e=!0),this.m_type==Yt&&(e&&this.m_awakeFlag==!1&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},i.prototype.shouldCollide=function(t){if(this.m_type!=Yt&&t.m_type!=Yt)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&e.joint.m_collideConnected==!1)return!1;return!0},i.prototype._addFixture=function(t){if(this.isWorldLocked()==!0)return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},i.prototype.createFixture=function(t,e){if(this.isWorldLocked()==!0)return null;var r=new mr(this,t,e);return this._addFixture(r),r},i.prototype.destroyFixture=function(t){if(this.isWorldLocked()!=!0){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;e!=null;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var r=this.m_contactList;r;){var s=r.contact;r=r.next;var o=s.getFixtureA(),n=s.getFixtureB();(t==o||t==n)&&this.m_world.destroyContact(s)}if(this.m_activeFlag){var h=this.m_world.m_broadPhase;t.destroyProxies(h)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},i.prototype.getWorldPoint=function(t){return Xt.mulVec2(this.m_xf,t)},i.prototype.getWorldVector=function(t){return B.mulVec2(this.m_xf.q,t)},i.prototype.getLocalPoint=function(t){return Xt.mulTVec2(this.m_xf,t)},i.prototype.getLocalVector=function(t){return B.mulTVec2(this.m_xf.q,t)},i.STATIC="static",i.KINEMATIC="kinematic",i.DYNAMIC="dynamic",i}(),cs=function(){function i(){this.other=null,this.joint=null,this.prev=null,this.next=null}return i}(),yt=function(){function i(t,e,r){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new cs,this.m_edgeB=new cs,this.m_islandFlag=!1,this.style={},this.appData={},e="bodyA"in t?t.bodyA:e,r="bodyB"in t?t.bodyB:r,this.m_bodyA=e,this.m_bodyB=r,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData,typeof t.style=="object"&&t.style!==null&&(this.style=t.style)}return i.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},i.prototype.getType=function(){return this.m_type},i.prototype.getBodyA=function(){return this.m_bodyA},i.prototype.getBodyB=function(){return this.m_bodyB},i.prototype.getNext=function(){return this.m_next},i.prototype.getUserData=function(){return this.m_userData},i.prototype.setUserData=function(t){this.m_userData=t},i.prototype.getCollideConnected=function(){return this.m_collideConnected},i.prototype.shiftOrigin=function(t){},i.prototype._resetAnchors=function(t){return this._reset(t)},i}(),G={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0},Xo=function(){return Date.now()},Ko=function(i){return Date.now()-i};const ls={now:Xo,diff:Ko};var Go=Math.max,Ri=g(0,0),Ei=g(0,0),It=g(0,0),Oi=g(0,0),pr=g(0,0),Qo=g(0,0),tn=g(0,0);G.gjkCalls=0;G.gjkIters=0;G.gjkMaxIters=0;var qr=function(){function i(){this.proxyA=new We,this.proxyB=new We,this.transformA=Xt.identity(),this.transformB=Xt.identity(),this.useRadii=!1}return i.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),this.useRadii=!1},i}(),kr=function(){function i(){this.pointA=g(0,0),this.pointB=g(0,0),this.distance=0,this.iterations=0}return i.prototype.recycle=function(){z(this.pointA),z(this.pointB),this.distance=0,this.iterations=0},i}(),Nr=function(){function i(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}return i.prototype.recycle=function(){this.metric=0,this.indexA.length=0,this.indexB.length=0,this.count=0},i}(),Ze=function(i,t,e){++G.gjkCalls;var r=e.proxyA,s=e.proxyB,o=e.transformA,n=e.transformB;Wt.recycle(),Wt.readCache(t,r,o,s,n);for(var h=Wt.m_v,m=S.maxDistanceIterations,u=[],l=[],p=0,_=0;_<m;){p=Wt.m_count;for(var c=0;c<p;++c)u[c]=h[c].indexA,l[c]=h[c].indexB;if(Wt.solve(),Wt.m_count===3)break;var y=Wt.getSearchDirection();if($e(y)<Vt*Vt)break;var v=h[Wt.m_count];v.indexA=r.getSupport(_i(Ri,o.q,F(Ri,-1,y))),T(v.wA,o,r.getVertex(v.indexA)),v.indexB=s.getSupport(_i(Ri,n.q,y)),T(v.wB,n,s.getVertex(v.indexB)),q(v.w,v.wB,v.wA),++_,++G.gjkIters;for(var f=!1,c=0;c<p;++c)if(v.indexA===u[c]&&v.indexB===l[c]){f=!0;break}if(f)break;++Wt.m_count}if(G.gjkMaxIters=Go(G.gjkMaxIters,_),Wt.getWitnessPoints(i.pointA,i.pointB),i.distance=oo(i.pointA,i.pointB),i.iterations=_,Wt.writeCache(t),e.useRadii){var d=r.m_radius,A=s.m_radius;if(i.distance>d+A&&i.distance>Vt)i.distance-=d+A,q(Ei,i.pointB,i.pointA),Zt(Ei),jt(i.pointA,d,Ei),Mi(i.pointB,A,Ei);else{var b=q(Ri,i.pointA,i.pointB);x(i.pointA,b),x(i.pointB,b),i.distance=0}}},We=function(){function i(){this.m_vertices=[],this.m_count=0,this.m_radius=0}return i.prototype.recycle=function(){this.m_vertices.length=0,this.m_count=0,this.m_radius=0},i.prototype.getVertexCount=function(){return this.m_count},i.prototype.getVertex=function(t){return this.m_vertices[t]},i.prototype.getSupport=function(t){for(var e=-1,r=-1/0,s=0;s<this.m_count;++s){var o=C(this.m_vertices[s],t);o>r&&(e=s,r=o)}return e},i.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},i.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},i.prototype.setVertices=function(t,e,r){this.m_vertices=t,this.m_count=e,this.m_radius=r},i}(),vr=function(){function i(){this.wA=g(0,0),this.indexA=0,this.wB=g(0,0),this.indexB=0,this.w=g(0,0),this.a=0}return i.prototype.recycle=function(){this.indexA=0,this.indexB=0,z(this.wA),z(this.wB),z(this.w),this.a=0},i.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,x(this.wA,t.wA),x(this.wB,t.wB),x(this.w,t.w),this.a=t.a},i}(),Ji=g(0,0),fi=g(0,0),en=function(){function i(){this.m_v1=new vr,this.m_v2=new vr,this.m_v3=new vr,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}return i.prototype.recycle=function(){this.m_v1.recycle(),this.m_v2.recycle(),this.m_v3.recycle(),this.m_count=0},i.prototype.toString=function(){return this.m_count===3?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():this.m_count===2?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():this.m_count===1?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},i.prototype.readCache=function(t,e,r,s,o){this.m_count=t.count;for(var n=0;n<this.m_count;++n){var h=this.m_v[n];h.indexA=t.indexA[n],h.indexB=t.indexB[n];var m=e.getVertex(h.indexA),u=s.getVertex(h.indexB);T(h.wA,r,m),T(h.wB,o,u),q(h.w,h.wB,h.wA),h.a=0}if(this.m_count>1){var l=t.metric,p=this.getMetric();(p<.5*l||2*l<p||p<Vt)&&(this.m_count=0)}if(this.m_count===0){var h=this.m_v[0];h.indexA=0,h.indexB=0;var m=e.getVertex(0),u=s.getVertex(0);T(h.wA,r,m),T(h.wB,o,u),q(h.w,h.wB,h.wA),h.a=1,this.m_count=1}},i.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},i.prototype.getSearchDirection=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 1:return ut(Ji,-t.w.x,-t.w.y);case 2:{q(It,e.w,t.w);var r=-D(It,t.w);return r>0?ut(Ji,-It.y,It.x):ut(Ji,It.y,-It.x)}default:return z(Ji)}},i.prototype.getClosestPoint=function(){var t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 0:return z(fi);case 1:return x(fi,t.w);case 2:return K(fi,t.a,t.w,e.a,e.w);case 3:return z(fi);default:return z(fi)}},i.prototype.getWitnessPoints=function(t,e){var r=this.m_v1,s=this.m_v2,o=this.m_v3;switch(this.m_count){case 0:break;case 1:x(t,r.wA),x(e,r.wB);break;case 2:K(t,r.a,r.wA,s.a,s.wA),K(e,r.a,r.wB,s.a,s.wB);break;case 3:re(t,r.a,r.wA,s.a,s.wA,o.a,o.wA),x(e,t);break}},i.prototype.getMetric=function(){switch(this.m_count){case 0:return 0;case 1:return 0;case 2:return oo(this.m_v1.w,this.m_v2.w);case 3:return D(q(Qo,this.m_v2.w,this.m_v1.w),q(tn,this.m_v3.w,this.m_v1.w));default:return 0}},i.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break}},i.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w;q(It,e,t);var r=-C(t,It);if(r<=0){this.m_v1.a=1,this.m_count=1;return}var s=C(e,It);if(s<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}var o=1/(s+r);this.m_v1.a=s*o,this.m_v2.a=r*o,this.m_count=2},i.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,r=this.m_v3.w;q(It,e,t);var s=C(t,It),o=C(e,It),n=o,h=-s;q(Oi,r,t);var m=C(t,Oi),u=C(r,Oi),l=u,p=-m;q(pr,r,e);var _=C(e,pr),c=C(r,pr),y=c,v=-_,f=D(It,Oi),d=f*D(e,r),A=f*D(r,t),b=f*D(t,e);if(h<=0&&p<=0){this.m_v1.a=1,this.m_count=1;return}if(n>0&&h>0&&b<=0){var w=1/(n+h);this.m_v1.a=n*w,this.m_v2.a=h*w,this.m_count=2;return}if(l>0&&p>0&&A<=0){var V=1/(l+p);this.m_v1.a=l*V,this.m_v3.a=p*V,this.m_count=2,this.m_v2.set(this.m_v3);return}if(n<=0&&v<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}if(l<=0&&y<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.set(this.m_v3);return}if(y>0&&v>0&&d<=0){var I=1/(y+v);this.m_v2.a=y*I,this.m_v3.a=v*I,this.m_count=2,this.m_v1.set(this.m_v3);return}var M=1/(d+A+b);this.m_v1.a=d*M,this.m_v2.a=A*M,this.m_v3.a=b*M,this.m_count=3},i}(),Wt=new en,Se=new qr,_s=new Nr,yr=new kr,co=function(i,t,e,r,s,o){return Se.recycle(),Se.proxyA.set(i,t),Se.proxyB.set(e,r),hr(Se.transformA,s),hr(Se.transformB,o),Se.useRadii=!0,yr.recycle(),_s.recycle(),Ze(yr,_s,Se),yr.distance<10*Vt};Ze.testOverlap=co;Ze.Input=qr;Ze.Output=kr;Ze.Proxy=We;Ze.Cache=Nr;(function(){function i(){this.proxyA=new We,this.proxyB=new We,this.transformA=Xt.identity(),this.transformB=Xt.identity(),this.translationB=a.zero()}return i.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),z(this.translationB)},i})();var rn=Math.abs,$i=Math.max,lo=function(){function i(){this.proxyA=new We,this.proxyB=new We,this.sweepA=new ui,this.sweepB=new ui}return i.prototype.recycle=function(){this.proxyA.recycle(),this.proxyB.recycle(),this.sweepA.recycle(),this.sweepB.recycle(),this.tMax=-1},i}(),Et;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_unknown=0]="e_unknown",i[i.e_failed=1]="e_failed",i[i.e_overlapped=2]="e_overlapped",i[i.e_touching=3]="e_touching",i[i.e_separated=4]="e_separated"})(Et||(Et={}));var _o=function(){function i(){this.state=Et.e_unset,this.t=-1}return i.prototype.recycle=function(){this.state=Et.e_unset,this.t=-1},i}();G.toiTime=0;G.toiMaxTime=0;G.toiCalls=0;G.toiIters=0;G.toiMaxIters=0;G.toiRootIters=0;G.toiMaxRootIters=0;var Ge=new qr,fr=new kr,dr=new Nr,Bt=He(0,0,0),bt=He(0,0,0),di=g(0,0),Gt=g(0,0),qt=g(0,0),gt=g(0,0),Yi=g(0,0),Wi=g(0,0),Ui=g(0,0),Hi=g(0,0),Dr=function(i,t){var e=ls.now();++G.toiCalls,i.state=Et.e_unknown,i.t=t.tMax;var r=t.proxyA,s=t.proxyB,o=t.sweepA,n=t.sweepB;o.normalize(),n.normalize();var h=t.tMax,m=r.m_radius+s.m_radius,u=$i(S.linearSlop,m-3*S.linearSlop),l=.25*S.linearSlop,p=0,_=S.maxTOIIterations,c=0;for(dr.recycle(),Ge.proxyA.setVertices(r.m_vertices,r.m_count,r.m_radius),Ge.proxyB.setVertices(s.m_vertices,s.m_count,s.m_radius),Ge.useRadii=!1;;){if(o.getTransform(Bt,p),n.getTransform(bt,p),hr(Ge.transformA,Bt),hr(Ge.transformB,bt),Ze(fr,dr,Ge),fr.distance<=0){i.state=Et.e_overlapped,i.t=0;break}if(fr.distance<u+l){i.state=Et.e_touching,i.t=p;break}xi.initialize(dr,r,o,s,n,p);for(var y=!1,v=h,f=0;;){var d=xi.findMinSeparation(v);if(d>u+l){i.state=Et.e_separated,i.t=h,y=!0;break}if(d>u-l){p=v;break}var A=xi.evaluate(p);if(A<u-l){i.state=Et.e_failed,i.t=p,y=!0;break}if(A<=u+l){i.state=Et.e_touching,i.t=p,y=!0;break}for(var b=0,w=p,V=v;;){var I=void 0;b&1?I=w+(u-A)*(V-w)/(d-A):I=.5*(w+V),++b,++G.toiRootIters;var M=xi.evaluate(I);if(rn(M-u)<l){v=I;break}if(M>u?(w=I,A=M):(V=I,d=M),b===50)break}if(G.toiMaxRootIters=$i(G.toiMaxRootIters,b),++f,f===S.maxPolygonVertices)break}if(++c,++G.toiIters,y)break;if(c===_){i.state=Et.e_failed,i.t=p;break}}G.toiMaxIters=$i(G.toiMaxIters,c);var P=ls.diff(e);G.toiMaxTime=$i(G.toiMaxTime,P),G.toiTime+=P,xi.recycle()},se;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_points=1]="e_points",i[i.e_faceA=2]="e_faceA",i[i.e_faceB=3]="e_faceB"})(se||(se={}));var sn=function(){function i(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=se.e_unset,this.m_localPoint=g(0,0),this.m_axis=g(0,0),this.indexA=-1,this.indexB=-1}return i.prototype.recycle=function(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=se.e_unset,z(this.m_localPoint),z(this.m_axis),this.indexA=-1,this.indexB=-1},i.prototype.initialize=function(t,e,r,s,o,n){var h=t.count;if(this.m_proxyA=e,this.m_proxyB=s,this.m_sweepA=r,this.m_sweepB=o,this.m_sweepA.getTransform(Bt,n),this.m_sweepB.getTransform(bt,n),h===1){this.m_type=se.e_points;var m=this.m_proxyA.getVertex(t.indexA[0]),u=this.m_proxyB.getVertex(t.indexB[0]);T(Gt,Bt,m),T(qt,bt,u),q(this.m_axis,qt,Gt);var l=Oo(this.m_axis);return l}else if(t.indexA[0]===t.indexA[1]){this.m_type=se.e_faceB;var p=s.getVertex(t.indexB[0]),_=s.getVertex(t.indexB[1]);Je(this.m_axis,q(di,_,p),1),Zt(this.m_axis),Ot(gt,bt.q,this.m_axis),K(this.m_localPoint,.5,p,.5,_),T(qt,bt,this.m_localPoint);var c=e.getVertex(t.indexA[0]),y=Xt.mulVec2(Bt,c),l=C(y,gt)-C(qt,gt);return l<0&&(Si(this.m_axis),l=-l),l}else{this.m_type=se.e_faceA;var v=this.m_proxyA.getVertex(t.indexA[0]),f=this.m_proxyA.getVertex(t.indexA[1]);Je(this.m_axis,q(di,f,v),1),Zt(this.m_axis),Ot(gt,Bt.q,this.m_axis),K(this.m_localPoint,.5,v,.5,f),T(Gt,Bt,this.m_localPoint);var d=this.m_proxyB.getVertex(t.indexB[0]);T(qt,bt,d);var l=C(qt,gt)-C(Gt,gt);return l<0&&(Si(this.m_axis),l=-l),l}},i.prototype.compute=function(t,e){switch(this.m_sweepA.getTransform(Bt,e),this.m_sweepB.getTransform(bt,e),this.m_type){case se.e_points:{t&&(_i(Yi,Bt.q,this.m_axis),_i(Wi,bt.q,F(di,-1,this.m_axis)),this.indexA=this.m_proxyA.getSupport(Yi),this.indexB=this.m_proxyB.getSupport(Wi)),x(Ui,this.m_proxyA.getVertex(this.indexA)),x(Hi,this.m_proxyB.getVertex(this.indexB)),T(Gt,Bt,Ui),T(qt,bt,Hi);var r=C(qt,this.m_axis)-C(Gt,this.m_axis);return r}case se.e_faceA:{Ot(gt,Bt.q,this.m_axis),T(Gt,Bt,this.m_localPoint),t&&(_i(Wi,bt.q,F(di,-1,gt)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(Wi)),x(Hi,this.m_proxyB.getVertex(this.indexB)),T(qt,bt,Hi);var r=C(qt,gt)-C(Gt,gt);return r}case se.e_faceB:{Ot(gt,bt.q,this.m_axis),T(qt,bt,this.m_localPoint),t&&(_i(Yi,Bt.q,F(di,-1,gt)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(Yi)),x(Ui,this.m_proxyA.getVertex(this.indexA)),T(Gt,Bt,Ui);var r=C(Gt,gt)-C(qt,gt);return r}default:return t&&(this.indexA=-1,this.indexB=-1),0}},i.prototype.findMinSeparation=function(t){return this.compute(!0,t)},i.prototype.evaluate=function(t){return this.compute(!1,t)},i}(),xi=new sn;Dr.Input=lo;Dr.Output=_o;var us=Math.abs,ps=Math.sqrt,ji=Math.min,Rr=function(){function i(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return i.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=t==0?0:1/t,this.dtRatio=t*this.inv_dt0},i}(),Qe=new Rr,ne=g(0,0),vt=g(0,0),Zi=g(0,0),ti=new lo,xr=new _o,vs=new ui,ys=new ui,fs=new ui,on=function(){function i(t){this.contact=t,this.normals=[],this.tangents=[]}return i.prototype.recycle=function(){this.normals.length=0,this.tangents.length=0},Object.defineProperty(i.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var r=0;r<t.v_points.length;++r)e.push(t.v_points[r].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var r=0;r<t.v_points.length;++r)e.push(t.v_points[r].tangentImpulse);return e},enumerable:!1,configurable:!0}),i}(),uo=function(){function i(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return i.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},i.prototype.addBody=function(t){this.m_bodies.push(t)},i.prototype.addContact=function(t){this.m_contacts.push(t)},i.prototype.addJoint=function(t){this.m_joints.push(t)},i.prototype.solveWorld=function(t){for(var e=this.m_world,r=e.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1;for(var s=e.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var o=e.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;for(var n=this.m_stack,h=e.m_bodyList;h;h=h.m_next)if(!h.m_islandFlag&&!(h.isAwake()==!1||h.isActive()==!1)&&!h.isStatic()){for(this.clear(),n.push(h),h.m_islandFlag=!0;n.length>0;){var r=n.pop();if(this.addBody(r),r.m_awakeFlag=!0,!r.isStatic()){for(var m=r.m_contactList;m;m=m.next){var u=m.contact;if(!u.m_islandFlag&&!(u.isEnabled()==!1||u.isTouching()==!1)){var l=u.m_fixtureA.m_isSensor,p=u.m_fixtureB.m_isSensor;if(!(l||p)){this.addContact(u),u.m_islandFlag=!0;var _=m.other;_.m_islandFlag||(n.push(_),_.m_islandFlag=!0)}}}for(var c=r.m_jointList;c;c=c.next)if(c.joint.m_islandFlag!=!0){var _=c.other;_.isActive()!=!1&&(this.addJoint(c.joint),c.joint.m_islandFlag=!0,!_.m_islandFlag&&(n.push(_),_.m_islandFlag=!0))}}}this.solveIsland(t);for(var y=0;y<this.m_bodies.length;++y){var r=this.m_bodies[y];r.isStatic()&&(r.m_islandFlag=!1)}}},i.prototype.solveIsland=function(t){for(var e=this.m_world,r=e.m_gravity,s=e.m_allowSleep,o=t.dt,n=0;n<this.m_bodies.length;++n){var h=this.m_bodies[n];x(ne,h.m_sweep.c);var m=h.m_sweep.a;x(vt,h.m_linearVelocity);var u=h.m_angularVelocity;x(h.m_sweep.c0,h.m_sweep.c),h.m_sweep.a0=h.m_sweep.a,h.isDynamic()&&(jt(vt,o*h.m_gravityScale,r),jt(vt,o*h.m_invMass,h.m_force),u+=o*h.m_invI*h.m_torque,F(vt,1/(1+o*h.m_linearDamping),vt),u*=1/(1+o*h.m_angularDamping)),x(h.c_position.c,ne),h.c_position.a=m,x(h.c_velocity.v,vt),h.c_velocity.w=u}for(var n=0;n<this.m_contacts.length;++n){var l=this.m_contacts[n];l.initConstraint(t)}for(var n=0;n<this.m_contacts.length;++n){var l=this.m_contacts[n];l.initVelocityConstraint(t)}if(t.warmStarting)for(var n=0;n<this.m_contacts.length;++n){var l=this.m_contacts[n];l.warmStartConstraint(t)}for(var n=0;n<this.m_joints.length;++n){var p=this.m_joints[n];p.initVelocityConstraints(t)}for(var n=0;n<t.velocityIterations;++n){for(var _=0;_<this.m_joints.length;++_){var p=this.m_joints[_];p.solveVelocityConstraints(t)}for(var _=0;_<this.m_contacts.length;++_){var l=this.m_contacts[_];l.solveVelocityConstraint(t)}}for(var n=0;n<this.m_contacts.length;++n){var l=this.m_contacts[n];l.storeConstraintImpulses(t)}for(var n=0;n<this.m_bodies.length;++n){var h=this.m_bodies[n];x(ne,h.c_position.c);var m=h.c_position.a;x(vt,h.c_velocity.v);var u=h.c_velocity.w;F(Zi,o,vt);var c=$e(Zi);if(c>S.maxTranslationSquared){var y=S.maxTranslation/ps(c);ts(vt,y)}var v=o*u;if(v*v>S.maxRotationSquared){var y=S.maxRotation/us(v);u*=y}jt(ne,o,vt),m+=o*u,x(h.c_position.c,ne),h.c_position.a=m,x(h.c_velocity.v,vt),h.c_velocity.w=u}for(var f=!1,n=0;n<t.positionIterations;++n){for(var d=0,_=0;_<this.m_contacts.length;++_){var l=this.m_contacts[_],A=l.solvePositionConstraint(t);d=ji(d,A)}for(var b=d>=-3*S.linearSlop,w=!0,_=0;_<this.m_joints.length;++_){var p=this.m_joints[_],V=p.solvePositionConstraints(t);w=w&&V}if(b&&w){f=!0;break}}for(var n=0;n<this.m_bodies.length;++n){var h=this.m_bodies[n];x(h.m_sweep.c,h.c_position.c),h.m_sweep.a=h.c_position.a,x(h.m_linearVelocity,h.c_velocity.v),h.m_angularVelocity=h.c_velocity.w,h.synchronizeTransform()}if(this.postSolveIsland(),s){for(var I=1/0,M=S.linearSleepToleranceSqr,P=S.angularSleepToleranceSqr,n=0;n<this.m_bodies.length;++n){var h=this.m_bodies[n];h.isStatic()||(h.m_autoSleepFlag==!1||h.m_angularVelocity*h.m_angularVelocity>P||$e(h.m_linearVelocity)>M?(h.m_sleepTime=0,I=0):(h.m_sleepTime+=o,I=ji(I,h.m_sleepTime)))}if(I>=S.timeToSleep&&f)for(var n=0;n<this.m_bodies.length;++n){var h=this.m_bodies[n];h.setAwake(!1)}}},i.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var r=e.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1,r.m_sweep.alpha0=0;for(var s=e.m_contactList;s;s=s.m_next)s.m_toiFlag=!1,s.m_islandFlag=!1,s.m_toiCount=0,s.m_toi=1}for(;;){for(var o=null,n=1,h=e.m_contactList;h;h=h.m_next)if(h.isEnabled()!=!1&&!(h.m_toiCount>S.maxSubSteps)){var m=1;if(h.m_toiFlag)m=h.m_toi;else{var u=h.getFixtureA(),l=h.getFixtureB();if(u.isSensor()||l.isSensor())continue;var p=u.getBody(),_=l.getBody(),c=p.isAwake()&&!p.isStatic(),y=_.isAwake()&&!_.isStatic();if(c==!1&&y==!1)continue;var v=p.isBullet()||!p.isDynamic(),f=_.isBullet()||!_.isDynamic();if(v==!1&&f==!1)continue;var d=p.m_sweep.alpha0;p.m_sweep.alpha0<_.m_sweep.alpha0?(d=_.m_sweep.alpha0,p.m_sweep.advance(d)):_.m_sweep.alpha0<p.m_sweep.alpha0&&(d=p.m_sweep.alpha0,_.m_sweep.advance(d));var A=h.getChildIndexA(),b=h.getChildIndexB();p.m_sweep,_.m_sweep,ti.proxyA.set(u.getShape(),A),ti.proxyB.set(l.getShape(),b),ti.sweepA.set(p.m_sweep),ti.sweepB.set(_.m_sweep),ti.tMax=1,Dr(xr,ti);var w=xr.t;xr.state==Et.e_touching?m=ji(d+(1-d)*w,1):m=1,h.m_toi=m,h.m_toiFlag=!0}m<n&&(o=h,n=m)}if(o==null||1-10*Vt<n){e.m_stepComplete=!0;break}var V=o.getFixtureA(),I=o.getFixtureB(),M=V.getBody(),P=I.getBody();if(ys.set(M.m_sweep),fs.set(P.m_sweep),M.advance(n),P.advance(n),o.update(e),o.m_toiFlag=!1,++o.m_toiCount,o.isEnabled()==!1||o.isTouching()==!1){o.setEnabled(!1),M.m_sweep.set(ys),P.m_sweep.set(fs),M.synchronizeTransform(),P.synchronizeTransform();continue}M.setAwake(!0),P.setAwake(!0),this.clear(),this.addBody(M),this.addBody(P),this.addContact(o),M.m_islandFlag=!0,P.m_islandFlag=!0,o.m_islandFlag=!0;for(var R=[M,P],E=0;E<R.length;++E){var O=R[E];if(O.isDynamic())for(var Y=O.m_contactList;Y;Y=Y.next){var U=Y.contact;if(!U.m_islandFlag){var j=Y.other;if(!(j.isDynamic()&&!O.isBullet()&&!j.isBullet())){var Ct=U.m_fixtureA.m_isSensor,lt=U.m_fixtureB.m_isSensor;if(!(Ct||lt)){if(vs.set(j.m_sweep),j.m_islandFlag==!1&&j.advance(n),U.update(e),U.isEnabled()==!1||U.isTouching()==!1){j.m_sweep.set(vs),j.synchronizeTransform();continue}U.m_islandFlag=!0,this.addContact(U),!j.m_islandFlag&&(j.m_islandFlag=!0,j.isStatic()||j.setAwake(!0),this.addBody(j))}}}}}Qe.reset((1-n)*t.dt),Qe.dtRatio=1,Qe.positionIterations=20,Qe.velocityIterations=t.velocityIterations,Qe.warmStarting=!1,this.solveIslandTOI(Qe,M,P);for(var E=0;E<this.m_bodies.length;++E){var O=this.m_bodies[E];if(O.m_islandFlag=!1,!!O.isDynamic()){O.synchronizeFixtures();for(var Y=O.m_contactList;Y;Y=Y.next)Y.contact.m_toiFlag=!1,Y.contact.m_islandFlag=!1}}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}},i.prototype.solveIslandTOI=function(t,e,r){for(var l=0;l<this.m_bodies.length;++l){var s=this.m_bodies[l];x(s.c_position.c,s.m_sweep.c),s.c_position.a=s.m_sweep.a,x(s.c_velocity.v,s.m_linearVelocity),s.c_velocity.w=s.m_angularVelocity}for(var l=0;l<this.m_contacts.length;++l){var o=this.m_contacts[l];o.initConstraint(t)}for(var l=0;l<t.positionIterations;++l){for(var n=0,h=0;h<this.m_contacts.length;++h){var o=this.m_contacts[h],m=o.solvePositionConstraintTOI(t,e,r);n=ji(n,m)}var u=n>=-1.5*S.linearSlop;if(u)break}var l;x(e.m_sweep.c0,e.c_position.c),e.m_sweep.a0=e.c_position.a,x(r.m_sweep.c0,r.c_position.c),r.m_sweep.a0=r.c_position.a;for(var l=0;l<this.m_contacts.length;++l){var o=this.m_contacts[l];o.initVelocityConstraint(t)}for(var l=0;l<t.velocityIterations;++l)for(var h=0;h<this.m_contacts.length;++h){var o=this.m_contacts[h];o.solveVelocityConstraint(t)}for(var p=t.dt,l=0;l<this.m_bodies.length;++l){var s=this.m_bodies[l];x(ne,s.c_position.c);var _=s.c_position.a;x(vt,s.c_velocity.v);var c=s.c_velocity.w;F(Zi,p,vt);var y=$e(Zi);if(y>S.maxTranslationSquared){var v=S.maxTranslation/ps(y);ts(vt,v)}var f=p*c;if(f*f>S.maxRotationSquared){var v=S.maxRotation/us(f);c*=v}jt(ne,p,vt),_+=p*c,x(s.c_position.c,ne),s.c_position.a=_,x(s.c_velocity.v,vt),s.c_velocity.w=c,x(s.m_sweep.c,ne),s.m_sweep.a=_,x(s.m_linearVelocity,vt),s.m_angularVelocity=c,s.synchronizeTransform()}this.postSolveIsland()},i.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},i}();uo.TimeStep=Rr;var Kt=function(){function i(t,e,r,s){typeof t=="object"&&t!==null?(this.ex=a.clone(t),this.ey=a.clone(e)):typeof t=="number"?(this.ex=a.neo(t,r),this.ey=a.neo(e,s)):(this.ex=a.zero(),this.ey=a.zero())}return i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:a.isValid(t.ex)&&a.isValid(t.ey)},i.assert=function(t){},i.prototype.set=function(t,e,r,s){typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof s=="number"?(this.ex.setNum(t,r),this.ey.setNum(e,s)):typeof t=="object"&&typeof e=="object"?(this.ex.setVec2(t),this.ey.setVec2(e)):typeof t=="object"&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},i.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},i.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},i.prototype.getInverse=function(){var t=this.ex.x,e=this.ey.x,r=this.ex.y,s=this.ey.y,o=t*s-e*r;o!==0&&(o=1/o);var n=new i;return n.ex.x=o*s,n.ey.x=-o*e,n.ex.y=-o*r,n.ey.y=o*t,n},i.prototype.solve=function(t){var e=this.ex.x,r=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-r*s;n!==0&&(n=1/n);var h=a.zero();return h.x=n*(o*t.x-r*t.y),h.y=n*(e*t.y-s*t.x),h},i.mul=function(t,e){if(e&&"x"in e&&"y"in e){var r=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return a.neo(r,s)}else if(e&&"ex"in e&&"ey"in e){var o=t.ex.x*e.ex.x+t.ey.x*e.ex.y,n=t.ex.x*e.ey.x+t.ey.x*e.ey.y,h=t.ex.y*e.ex.x+t.ey.y*e.ex.y,m=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new i(o,n,h,m)}},i.mulVec2=function(t,e){var r=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return a.neo(r,s)},i.mulMat22=function(t,e){var r=t.ex.x*e.ex.x+t.ey.x*e.ex.y,s=t.ex.x*e.ey.x+t.ey.x*e.ey.y,o=t.ex.y*e.ex.x+t.ey.y*e.ex.y,n=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new i(r,s,o,n)},i.mulT=function(t,e){if(e&&"x"in e&&"y"in e)return a.neo(a.dot(e,t.ex),a.dot(e,t.ey));if(e&&"ex"in e&&"ey"in e){var r=a.neo(a.dot(t.ex,e.ex),a.dot(t.ey,e.ex)),s=a.neo(a.dot(t.ex,e.ey),a.dot(t.ey,e.ey));return new i(r,s)}},i.mulTVec2=function(t,e){return a.neo(a.dot(e,t.ex),a.dot(e,t.ey))},i.mulTMat22=function(t,e){var r=a.neo(a.dot(t.ex,e.ex),a.dot(t.ey,e.ex)),s=a.neo(a.dot(t.ex,e.ey),a.dot(t.ey,e.ey));return new i(r,s)},i.abs=function(t){return new i(a.abs(t.ex),a.abs(t.ey))},i.add=function(t,e){return new i(a.add(t.ex,e.ex),a.add(t.ey,e.ey))},i}(),nn=Math.sqrt,Ar=g(0,0),gr=g(0,0),Ai=g(0,0),ae=g(0,0),he=g(0,0),Br=g(0,0),Xi=g(0,0),ye=g(0,0),Q;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_circles=0]="e_circles",i[i.e_faceA=1]="e_faceA",i[i.e_faceB=2]="e_faceB"})(Q||(Q={}));var J;(function(i){i[i.e_unset=-1]="e_unset",i[i.e_vertex=0]="e_vertex",i[i.e_face=1]="e_face"})(J||(J={}));var Ee;(function(i){i[i.nullState=0]="nullState",i[i.addState=1]="addState",i[i.persistState=2]="persistState",i[i.removeState=3]="removeState"})(Ee||(Ee={}));var zt=function(){function i(){this.v=g(0,0),this.id=new vo}return i.prototype.set=function(t){x(this.v,t.v),this.id.set(t.id)},i.prototype.recycle=function(){z(this.v),this.id.recycle()},i}(),po=function(){function i(){this.localNormal=g(0,0),this.localPoint=g(0,0),this.points=[new ds,new ds],this.pointCount=0}return i.prototype.set=function(t){this.type=t.type,x(this.localNormal,t.localNormal),x(this.localPoint,t.localPoint),this.pointCount=t.pointCount,this.points[0].set(t.points[0]),this.points[1].set(t.points[1])},i.prototype.recycle=function(){this.type=Q.e_unset,z(this.localNormal),z(this.localPoint),this.pointCount=0,this.points[0].recycle(),this.points[1].recycle()},i.prototype.getWorldManifold=function(t,e,r,s,o){if(this.pointCount==0)return t;t=t||new yo,t.pointCount=this.pointCount;var n=t.normal,h=t.points,m=t.separations;switch(this.type){case Q.e_circles:{ut(n,1,0);var u=this.points[0];T(Ar,e,this.localPoint),T(gr,s,u.localPoint),q(Br,gr,Ar);var l=$e(Br);if(l>Vt*Vt){var p=nn(l);F(n,1/p,Br)}K(ae,1,Ar,r,n),K(he,1,gr,-o,n),K(h[0],.5,ae,.5,he),m[0]=C(q(Ai,he,ae),n);break}case Q.e_faceA:{Ot(n,e.q,this.localNormal),T(Xi,e,this.localPoint);for(var _=0;_<this.pointCount;++_){var u=this.points[_];T(ye,s,u.localPoint),K(ae,1,ye,r-C(q(Ai,ye,Xi),n),n),K(he,1,ye,-o,n),K(h[_],.5,ae,.5,he),m[_]=C(q(Ai,he,ae),n)}break}case Q.e_faceB:{Ot(n,s.q,this.localNormal),T(Xi,s,this.localPoint);for(var _=0;_<this.pointCount;++_){var u=this.points[_];T(ye,e,u.localPoint),K(he,1,ye,o-C(q(Ai,ye,Xi),n),n),K(ae,1,ye,-r,n),K(h[_],.5,ae,.5,he),m[_]=C(q(Ai,ae,he),n)}Si(n);break}}return t},i.clipSegmentToLine=zi,i.ClipVertex=zt,i.getPointStates=an,i.PointState=Ee,i}(),ds=function(){function i(){this.localPoint=g(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.id=new vo}return i.prototype.set=function(t){x(this.localPoint,t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.set(t.id)},i.prototype.recycle=function(){z(this.localPoint),this.normalImpulse=0,this.tangentImpulse=0,this.id.recycle()},i}(),vo=function(){function i(){this.key=-1,this.indexA=-1,this.indexB=-1,this.typeA=J.e_unset,this.typeB=J.e_unset}return i.prototype.setFeatures=function(t,e,r,s){this.indexA=t,this.indexB=r,this.typeA=e,this.typeB=s,this.key=this.indexA+this.indexB*4+this.typeA*16+this.typeB*64},i.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB,this.key=this.indexA+this.indexB*4+this.typeA*16+this.typeB*64},i.prototype.swapFeatures=function(){var t=this.indexA,e=this.indexB,r=this.typeA,s=this.typeB;this.indexA=e,this.indexB=t,this.typeA=s,this.typeB=r,this.key=this.indexA+this.indexB*4+this.typeA*16+this.typeB*64},i.prototype.recycle=function(){this.indexA=0,this.indexB=0,this.typeA=J.e_unset,this.typeB=J.e_unset,this.key=-1},i}(),yo=function(){function i(){this.normal=g(0,0),this.points=[g(0,0),g(0,0)],this.separations=[0,0],this.pointCount=0}return i.prototype.recycle=function(){z(this.normal),z(this.points[0]),z(this.points[1]),this.separations[0]=0,this.separations[1]=0,this.pointCount=0},i}();function an(i,t,e,r){for(var s=0;s<e.pointCount;++s){var o=e.points[s].id;i[s]=Ee.removeState;for(var n=0;n<r.pointCount;++n)if(r.points[n].id.key===o.key){i[s]=Ee.persistState;break}}for(var s=0;s<r.pointCount;++s){var o=r.points[s].id;t[s]=Ee.addState;for(var n=0;n<e.pointCount;++n)if(e.points[n].id.key===o.key){t[s]=Ee.persistState;break}}}function zi(i,t,e,r,s){var o=0,n=C(e,t[0].v)-r,h=C(e,t[1].v)-r;if(n<=0&&i[o++].set(t[0]),h<=0&&i[o++].set(t[1]),n*h<0){var m=n/(n-h);K(i[o].v,1-m,t[0].v,m,t[1].v),i[o].id.setFeatures(s,J.e_vertex,t[0].id.indexB,J.e_face),++o}return o}var hn=Math.sqrt,mn=Math.max,cn=Math.min,xs=new Ii({create:function(){return new oe},release:function(i){i.recycle()}}),ei=new po,Ki=new yo,As=function(){function i(t){this.prev=null,this.next=null,this.other=null,this.contact=t}return i.prototype.recycle=function(){this.prev=null,this.next=null,this.other=null},i}();function gs(i,t){return hn(i*t)}function Bs(i,t){return i>t?i:t}var ze=[],bs=function(){function i(){this.rA=g(0,0),this.rB=g(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return i.prototype.recycle=function(){z(this.rA),z(this.rB),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},i}(),me=g(0,0),et=g(0,0),ce=g(0,0),it=g(0,0),fe=g(0,0),Fe=He(0,0,0),Le=He(0,0,0),Gi=g(0,0),Qi=g(0,0),ii=g(0,0),tr=g(0,0),br=g(0,0),wr=g(0,0),rt=g(0,0),H=g(0,0),gi=g(0,0),kt=g(0,0),ri=g(0,0),si=g(0,0),Pt=g(0,0),le=g(0,0),X=g(0,0),Nt=g(0,0),st=g(0,0),ot=g(0,0),Qt=g(0,0),oe=function(){function i(){this.m_nodeA=new As(this),this.m_nodeB=new As(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold=new po,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new on(this),this.v_points=[new bs,new bs],this.v_normal=g(0,0),this.v_normalMass=new Kt,this.v_K=new Kt,this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0,this.p_localPoints=[g(0,0),g(0,0)],this.p_localNormal=g(0,0),this.p_localPoint=g(0,0),this.p_localCenterA=g(0,0),this.p_localCenterB=g(0,0),this.p_type=Q.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}return i.prototype.initialize=function(t,e,r,s,o){this.m_fixtureA=t,this.m_fixtureB=r,this.m_indexA=e,this.m_indexB=s,this.m_evaluateFcn=o,this.m_friction=gs(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Bs(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},i.prototype.recycle=function(){this.m_nodeA.recycle(),this.m_nodeB.recycle(),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold.recycle(),this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse.recycle();for(var t=0,e=this.v_points;t<e.length;t++){var r=e[t];r.recycle()}z(this.v_normal),this.v_normalMass.setZero(),this.v_K.setZero(),this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0;for(var s=0,o=this.p_localPoints;s<o.length;s++){var n=o[s];z(n)}z(this.p_localNormal),z(this.p_localPoint),z(this.p_localCenterA),z(this.p_localCenterB),this.p_type=Q.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0},i.prototype.initConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,o=r.m_body;if(!(s===null||o===null)){var n=e.m_shape,h=r.m_shape;if(!(n===null||h===null)){var m=this.m_manifold,u=m.pointCount;this.v_invMassA=s.m_invMass,this.v_invMassB=o.m_invMass,this.v_invIA=s.m_invI,this.v_invIB=o.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=u,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=s.m_invMass,this.p_invMassB=o.m_invMass,this.p_invIA=s.m_invI,this.p_invIB=o.m_invI,x(this.p_localCenterA,s.m_sweep.localCenter),x(this.p_localCenterB,o.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=h.m_radius,this.p_type=m.type,x(this.p_localNormal,m.localNormal),x(this.p_localPoint,m.localPoint),this.p_pointCount=u;for(var l=0;l<S.maxManifoldPoints;++l)this.v_points[l].recycle(),z(this.p_localPoints[l]);for(var l=0;l<u;++l){var p=m.points[l],_=this.v_points[l];t.warmStarting&&(_.normalImpulse=t.dtRatio*p.normalImpulse,_.tangentImpulse=t.dtRatio*p.tangentImpulse),x(this.p_localPoints[l],p.localPoint)}}}}},i.prototype.getManifold=function(){return this.m_manifold},i.prototype.getWorldManifold=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,o=r.m_body;if(!(s===null||o===null)){var n=e.m_shape,h=r.m_shape;if(!(n===null||h===null))return this.m_manifold.getWorldManifold(t,s.getTransform(),n.m_radius,o.getTransform(),h.m_radius)}}},i.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},i.prototype.isEnabled=function(){return this.m_enabledFlag},i.prototype.isTouching=function(){return this.m_touchingFlag},i.prototype.getNext=function(){return this.m_next},i.prototype.getFixtureA=function(){return this.m_fixtureA},i.prototype.getFixtureB=function(){return this.m_fixtureB},i.prototype.getChildIndexA=function(){return this.m_indexA},i.prototype.getChildIndexB=function(){return this.m_indexB},i.prototype.flagForFiltering=function(){this.m_filterFlag=!0},i.prototype.setFriction=function(t){this.m_friction=t},i.prototype.getFriction=function(){return this.m_friction},i.prototype.resetFriction=function(){var t=this.m_fixtureA,e=this.m_fixtureB;t===null||e===null||(this.m_friction=gs(t.m_friction,e.m_friction))},i.prototype.setRestitution=function(t){this.m_restitution=t},i.prototype.getRestitution=function(){return this.m_restitution},i.prototype.resetRestitution=function(){var t=this.m_fixtureA,e=this.m_fixtureB;t===null||e===null||(this.m_restitution=Bs(t.m_restitution,e.m_restitution))},i.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},i.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},i.prototype.evaluate=function(t,e,r){var s=this.m_fixtureA,o=this.m_fixtureB;s===null||o===null||this.m_evaluateFcn(t,e,s,this.m_indexA,r,o,this.m_indexB)},i.prototype.update=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,o=r.m_body;if(!(s===null||o===null)){var n=e.m_shape,h=r.m_shape;if(!(n===null||h===null)){this.m_enabledFlag=!0;var m=!1,u=this.m_touchingFlag,l=e.m_isSensor,p=r.m_isSensor,_=l||p,c=s.m_xf,y=o.m_xf;if(_)m=co(n,this.m_indexA,h,this.m_indexB,c,y),this.m_manifold.pointCount=0;else{ei.recycle(),ei.set(this.m_manifold),this.m_manifold.recycle(),this.evaluate(this.m_manifold,c,y),m=this.m_manifold.pointCount>0;for(var v=0;v<this.m_manifold.pointCount;++v){var f=this.m_manifold.points[v];f.normalImpulse=0,f.tangentImpulse=0;for(var d=0;d<ei.pointCount;++d){var A=ei.points[d];if(A.id.key===f.id.key){f.normalImpulse=A.normalImpulse,f.tangentImpulse=A.tangentImpulse;break}}}m!==u&&(s.setAwake(!0),o.setAwake(!0))}this.m_touchingFlag=m;var b=typeof t=="object"&&t!==null;!u&&m&&b&&t.beginContact(this),u&&!m&&b&&t.endContact(this),!_&&m&&b&&ei&&t.preSolve(this,ei)}}}},i.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,null,null)},i.prototype.solvePositionConstraintTOI=function(t,e,r){return this._solvePositionConstraint(t,e,r)},i.prototype._solvePositionConstraint=function(t,e,r){var s=e!==null&&r!==null,o=0,n=this.m_fixtureA,h=this.m_fixtureB;if(n===null||h===null)return o;var m=n.m_body,u=h.m_body;if(m===null||u===null)return o;m.c_velocity,u.c_velocity;var l=m.c_position,p=u.c_position,_=this.p_localCenterA,c=this.p_localCenterB,y=0,v=0;(!s||m===e||m===r)&&(y=this.p_invMassA,v=this.p_invIA);var f=0,d=0;(!s||u===e||u===r)&&(f=this.p_invMassB,d=this.p_invIB),x(me,l.c);var A=l.a;x(ce,p.c);for(var b=p.a,w=0;w<this.p_pointCount;++w){qi(Fe,_,me,A),qi(Le,c,ce,b);var V=void 0;switch(this.p_type){case Q.e_circles:{T(Gi,Fe,this.p_localPoint),T(Qi,Le,this.p_localPoints[0]),q(H,Qi,Gi),Zt(H),K(gi,.5,Gi,.5,Qi),V=C(Qi,H)-C(Gi,H)-this.p_radiusA-this.p_radiusB;break}case Q.e_faceA:{Ot(H,Fe.q,this.p_localNormal),T(tr,Fe,this.p_localPoint),T(ii,Le,this.p_localPoints[w]),V=C(ii,H)-C(tr,H)-this.p_radiusA-this.p_radiusB,x(gi,ii);break}case Q.e_faceB:{Ot(H,Le.q,this.p_localNormal),T(tr,Le,this.p_localPoint),T(ii,Fe,this.p_localPoints[w]),V=C(ii,H)-C(tr,H)-this.p_radiusA-this.p_radiusB,x(gi,ii),Si(H);break}default:return o}q(br,gi,me),q(wr,gi,ce),o=cn(o,V);var I=s?S.toiBaugarte:S.baumgarte,M=S.linearSlop,P=S.maxLinearCorrection,R=pt(I*(V+M),-P,0),E=D(br,H),O=D(wr,H),Y=y+f+v*E*E+d*O*O,U=Y>0?-R/Y:0;F(rt,U,H),Mi(me,y,rt),A-=v*D(br,rt),jt(ce,f,rt),b+=d*D(wr,rt)}return x(l.c,me),l.a=A,x(p.c,ce),p.a=b,o},i.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,o=r.m_body;if(!(s===null||o===null)){var n=s.c_velocity,h=o.c_velocity,m=s.c_position,u=o.c_position,l=this.p_radiusA,p=this.p_radiusB,_=this.m_manifold,c=this.v_invMassA,y=this.v_invMassB,v=this.v_invIA,f=this.v_invIB,d=this.p_localCenterA,A=this.p_localCenterB;x(me,m.c);var b=m.a;x(et,n.v);var w=n.w;x(ce,u.c);var V=u.a;x(it,h.v);var I=h.w;qi(Fe,d,me,b),qi(Le,A,ce,V),Ki.recycle(),_.getWorldManifold(Ki,Fe,l,Le,p),x(this.v_normal,Ki.normal);for(var M=0;M<this.v_pointCount;++M){var P=this.v_points[M],R=Ki.points[M];q(P.rA,R,me),q(P.rB,R,ce);var E=D(P.rA,this.v_normal),O=D(P.rB,this.v_normal),Y=c+y+v*E*E+f*O*O;P.normalMass=Y>0?1/Y:0,Je(fe,this.v_normal,1);var U=D(P.rA,fe),j=D(P.rB,fe),Ct=c+y+v*U*U+f*j*j;P.tangentMass=Ct>0?1/Ct:0,P.velocityBias=0;var lt=0;lt+=C(this.v_normal,it),lt+=C(this.v_normal,St(Qt,I,P.rB)),lt-=C(this.v_normal,et),lt-=C(this.v_normal,St(Qt,w,P.rA)),lt<-S.velocityThreshold&&(P.velocityBias=-this.v_restitution*lt)}if(this.v_pointCount==2&&t.blockSolve){var Jt=this.v_points[0],At=this.v_points[1],tt=D(Jt.rA,this.v_normal),vi=D(Jt.rB,this.v_normal),Lt=D(At.rA,this.v_normal),ve=D(At.rB,this.v_normal),Ce=c+y+v*tt*tt+f*vi*vi,yi=c+y+v*Lt*Lt+f*ve*ve,Xe=c+y+v*tt*Lt+f*vi*ve,_r=1e3;if(Ce*Ce<_r*(Ce*yi-Xe*Xe)){this.v_K.ex.setNum(Ce,Xe),this.v_K.ey.setNum(Xe,yi);var Or=this.v_K.ex.x,Jr=this.v_K.ey.x,$r=this.v_K.ex.y,Yr=this.v_K.ey.y,Me=Or*Yr-Jr*$r;Me!==0&&(Me=1/Me),this.v_normalMass.ex.x=Me*Yr,this.v_normalMass.ey.x=-Me*Jr,this.v_normalMass.ex.y=-Me*$r,this.v_normalMass.ey.y=Me*Or}else this.v_pointCount=1}x(m.c,me),m.a=b,x(n.v,et),n.w=w,x(u.c,ce),u.a=V,x(h.v,it),h.w=I}}},i.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,o=r.m_body;if(!(s===null||o===null)){var n=s.c_velocity,h=o.c_velocity;s.c_position,o.c_position;var m=this.v_invMassA,u=this.v_invIA,l=this.v_invMassB,p=this.v_invIB;x(et,n.v);var _=n.w;x(it,h.v);var c=h.w;x(H,this.v_normal),Je(fe,H,1);for(var y=0;y<this.v_pointCount;++y){var v=this.v_points[y];K(rt,v.normalImpulse,H,v.tangentImpulse,fe),_-=u*D(v.rA,rt),Mi(et,m,rt),c+=p*D(v.rB,rt),jt(it,l,rt)}x(n.v,et),n.w=_,x(h.v,it),h.w=c}}},i.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,r=0;r<this.v_pointCount;++r)e.points[r].normalImpulse=this.v_points[r].normalImpulse,e.points[r].tangentImpulse=this.v_points[r].tangentImpulse},i.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA,r=this.m_fixtureB;if(!(e===null||r===null)){var s=e.m_body,o=r.m_body;if(!(s===null||o===null)){var n=s.c_velocity;s.c_position;var h=o.c_velocity;o.c_position;var m=this.v_invMassA,u=this.v_invIA,l=this.v_invMassB,p=this.v_invIB;x(et,n.v);var _=n.w;x(it,h.v);var c=h.w;x(H,this.v_normal),Je(fe,H,1);for(var y=this.v_friction,v=0;v<this.v_pointCount;++v){var f=this.v_points[v];z(kt),Rt(kt,it),Rt(kt,St(Qt,c,f.rB)),ue(kt,et),ue(kt,St(Qt,_,f.rA));var d=C(kt,fe)-this.v_tangentSpeed,A=f.tangentMass*-d,b=y*f.normalImpulse,w=pt(f.tangentImpulse+A,-b,b);A=w-f.tangentImpulse,f.tangentImpulse=w,F(rt,A,fe),Mi(et,m,rt),_-=u*D(f.rA,rt),jt(it,l,rt),c+=p*D(f.rB,rt)}if(this.v_pointCount==1||t.blockSolve==!1)for(var V=0;V<this.v_pointCount;++V){var f=this.v_points[V];z(kt),Rt(kt,it),Rt(kt,St(Qt,c,f.rB)),ue(kt,et),ue(kt,St(Qt,_,f.rA));var I=C(kt,H),A=-f.normalMass*(I-f.velocityBias),w=mn(f.normalImpulse+A,0);A=w-f.normalImpulse,f.normalImpulse=w,F(rt,A,H),Mi(et,m,rt),_-=u*D(f.rA,rt),jt(it,l,rt),c+=p*D(f.rB,rt)}else{var M=this.v_points[0],P=this.v_points[1];ut(le,M.normalImpulse,P.normalImpulse),z(ri),Rt(ri,it),Rt(ri,St(Qt,c,M.rB)),ue(ri,et),ue(ri,St(Qt,_,M.rA)),z(si),Rt(si,it),Rt(si,St(Qt,c,P.rB)),ue(si,et),ue(si,St(Qt,_,P.rA));var R=C(ri,H),E=C(si,H);for(ut(Pt,R-M.velocityBias,E-P.velocityBias),Pt.x-=this.v_K.ex.x*le.x+this.v_K.ey.x*le.y,Pt.y-=this.v_K.ex.y*le.x+this.v_K.ey.y*le.y;;){if(z(X),X.x=-(this.v_normalMass.ex.x*Pt.x+this.v_normalMass.ey.x*Pt.y),X.y=-(this.v_normalMass.ex.y*Pt.x+this.v_normalMass.ey.y*Pt.y),X.x>=0&&X.y>=0){q(Nt,X,le),F(st,Nt.x,H),F(ot,Nt.y,H),re(et,-m,st,-m,ot,1,et),_-=u*(D(M.rA,st)+D(P.rA,ot)),re(it,l,st,l,ot,1,it),c+=p*(D(M.rB,st)+D(P.rB,ot)),M.normalImpulse=X.x,P.normalImpulse=X.y;break}if(X.x=-M.normalMass*Pt.x,X.y=0,R=0,E=this.v_K.ex.y*X.x+Pt.y,X.x>=0&&E>=0){q(Nt,X,le),F(st,Nt.x,H),F(ot,Nt.y,H),re(et,-m,st,-m,ot,1,et),_-=u*(D(M.rA,st)+D(P.rA,ot)),re(it,l,st,l,ot,1,it),c+=p*(D(M.rB,st)+D(P.rB,ot)),M.normalImpulse=X.x,P.normalImpulse=X.y;break}if(X.x=0,X.y=-P.normalMass*Pt.y,R=this.v_K.ey.x*X.y+Pt.x,E=0,X.y>=0&&R>=0){q(Nt,X,le),F(st,Nt.x,H),F(ot,Nt.y,H),re(et,-m,st,-m,ot,1,et),_-=u*(D(M.rA,st)+D(P.rA,ot)),re(it,l,st,l,ot,1,it),c+=p*(D(M.rB,st)+D(P.rB,ot)),M.normalImpulse=X.x,P.normalImpulse=X.y;break}if(X.x=0,X.y=0,R=Pt.x,E=Pt.y,R>=0&&E>=0){q(Nt,X,le),F(st,Nt.x,H),F(ot,Nt.y,H),re(et,-m,st,-m,ot,1,et),_-=u*(D(M.rA,st)+D(P.rA,ot)),re(it,l,st,l,ot,1,it),c+=p*(D(M.rB,st)+D(P.rB,ot)),M.normalImpulse=X.x,P.normalImpulse=X.y;break}break}}x(n.v,et),n.w=_,x(h.v,it),h.w=c}}},i.addType=function(t,e,r){ze[t]=ze[t]||{},ze[t][e]=r},i.create=function(t,e,r,s){var o=t.m_shape.m_type,n=r.m_shape.m_type,h=xs.allocate(),m;if(m=ze[o]&&ze[o][n])h.initialize(t,e,r,s,m);else if(m=ze[n]&&ze[n][o])h.initialize(r,s,t,e,m);else return null;t=h.m_fixtureA,r=h.m_fixtureB,e=h.getChildIndexA(),s=h.getChildIndexB();var u=t.m_body,l=r.m_body;return h.m_nodeA.contact=h,h.m_nodeA.other=l,h.m_nodeA.prev=null,h.m_nodeA.next=u.m_contactList,u.m_contactList!=null&&(u.m_contactList.prev=h.m_nodeA),u.m_contactList=h.m_nodeA,h.m_nodeB.contact=h,h.m_nodeB.other=u,h.m_nodeB.prev=null,h.m_nodeB.next=l.m_contactList,l.m_contactList!=null&&(l.m_contactList.prev=h.m_nodeB),l.m_contactList=h.m_nodeB,t.isSensor()==!1&&r.isSensor()==!1&&(u.setAwake(!0),l.setAwake(!0)),h},i.destroy=function(t,e){var r=t.m_fixtureA,s=t.m_fixtureB;if(!(r===null||s===null)){var o=r.m_body,n=s.m_body;o===null||n===null||(t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!r.m_isSensor&&!s.m_isSensor&&(o.setAwake(!0),n.setAwake(!0)),xs.release(t))}},i}(),ln={gravity:a.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},Li=function(){function i(t){if(!(this instanceof i))return new i(t);this.s_step=new Rr,t?a.isValid(t)&&(t={gravity:t}):t={},t=Ft(t,ln),this.m_solver=new uo(this),this.m_broadPhase=new Do,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=a.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0,this.m_step_callback=[]}return i.prototype._serialize=function(){for(var t=[],e=[],r=this.getBodyList();r;r=r.getNext())t.push(r);for(var s=this.getJointList();s;s=s.getNext())typeof s._serialize=="function"&&e.push(s);return{gravity:this.m_gravity,bodies:t,joints:e}},i._deserialize=function(t,e,r){if(!t)return new i;var s=new i(t.gravity);if(t.bodies)for(var o=t.bodies.length-1;o>=0;o-=1)s._addBody(r(W,t.bodies[o],s));if(t.joints)for(var o=t.joints.length-1;o>=0;o--)s.createJoint(r(yt,t.joints[o],s));return s},i.prototype.getBodyList=function(){return this.m_bodyList},i.prototype.getJointList=function(){return this.m_jointList},i.prototype.getContactList=function(){return this.m_contactList},i.prototype.getBodyCount=function(){return this.m_bodyCount},i.prototype.getJointCount=function(){return this.m_jointCount},i.prototype.getContactCount=function(){return this.m_contactCount},i.prototype.setGravity=function(t){this.m_gravity.set(t)},i.prototype.getGravity=function(){return this.m_gravity},i.prototype.isLocked=function(){return this.m_locked},i.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,this.m_allowSleep==!1))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},i.prototype.getAllowSleeping=function(){return this.m_allowSleep},i.prototype.setWarmStarting=function(t){this.m_warmStarting=t},i.prototype.getWarmStarting=function(){return this.m_warmStarting},i.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},i.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},i.prototype.setSubStepping=function(t){this.m_subStepping=t},i.prototype.getSubStepping=function(){return this.m_subStepping},i.prototype.setAutoClearForces=function(t){this.m_clearForces=t},i.prototype.getAutoClearForces=function(){return this.m_clearForces},i.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},i.prototype.queryAABB=function(t,e){var r=this.m_broadPhase;this.m_broadPhase.query(t,function(s){var o=r.getUserData(s);return e(o.fixture)})},i.prototype.rayCast=function(t,e,r){var s=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},function(o,n){var h=s.getUserData(n),m=h.fixture,u=h.childIndex,l={},p=m.rayCast(l,o,u);if(p){var _=l.fraction,c=a.add(a.mulNumVec2(1-_,o.p1),a.mulNumVec2(_,o.p2));return r(m,c,l.normal,_)}return o.maxFraction})},i.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},i.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},i.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},i.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},i.prototype.shiftOrigin=function(t){if(!this.isLocked()){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var r=this.m_jointList;r;r=r.m_next)r.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},i.prototype._addBody=function(t){this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},i.prototype.createBody=function(t,e){if(this.isLocked())return null;var r={};t&&(a.isValid(t)?r={position:t,angle:e}:typeof t=="object"&&(r=t));var s=new W(this,r);return this._addBody(s),s},i.prototype.createDynamicBody=function(t,e){var r={};return t&&(a.isValid(t)?r={position:t,angle:e}:typeof t=="object"&&(r=t)),r.type="dynamic",this.createBody(r)},i.prototype.createKinematicBody=function(t,e){var r={};return t&&(a.isValid(t)?r={position:t,angle:e}:typeof t=="object"&&(r=t)),r.type="kinematic",this.createBody(r)},i.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var r=e;e=e.next,this.publish("remove-joint",r.joint),this.destroyJoint(r.joint),t.m_jointList=e}t.m_jointList=null;for(var s=t.m_contactList;s;){var o=s;s=s.next,this.destroyContact(o.contact),t.m_contactList=s}t.m_contactList=null;for(var n=t.m_fixtureList;n;){var h=n;n=n.m_next,this.publish("remove-fixture",h),h.destroyProxies(this.m_broadPhase),t.m_fixtureList=n}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},i.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,t.m_collideConnected==!1)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},i.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,r=t.m_bodyB;if(e.setAwake(!0),r.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==r.m_jointList&&(r.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,t.m_collideConnected==!1)for(var s=r.getContactList();s;)s.other==e&&s.contact.flagForFiltering(),s=s.next;this.publish("remove-joint",t)}},i.prototype.step=function(t,e,r){if(this.publish("pre-step",t),(e|0)!==e&&(e=0),e=e||this.m_velocityIterations,r=r||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=r,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var s=this.m_bodyList;s;s=s.getNext())s.m_islandFlag!=!1&&(s.isStatic()||s.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1;for(var o;o=this.m_step_callback.shift();)o(this);this.publish("post-step",t)},i.prototype.queueUpdate=function(t){this.isLocked()?this.m_step_callback.push(t):t(this)},i.prototype.findNewContacts=function(){var t=this;this.m_broadPhase.updatePairs(function(e,r){return t.createContact(e,r)})},i.prototype.createContact=function(t,e){var r=t.fixture,s=e.fixture,o=t.childIndex,n=e.childIndex,h=r.getBody(),m=s.getBody();if(h!=m){for(var u=m.getContactList();u;){if(u.other==h){var l=u.contact.getFixtureA(),p=u.contact.getFixtureB(),_=u.contact.getChildIndexA(),c=u.contact.getChildIndexB();if(l==r&&p==s&&_==o&&c==n||l==s&&p==r&&_==n&&c==o)return}u=u.next}if(m.shouldCollide(h)!=!1&&s.shouldCollide(r)!=!1){var y=oe.create(r,o,s,n);y!=null&&(y.m_prev=null,this.m_contactList!=null&&(y.m_next=this.m_contactList,this.m_contactList.m_prev=y),this.m_contactList=y,++this.m_contactCount)}}},i.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var r=t.getFixtureA(),s=t.getFixtureB(),o=t.getChildIndexA(),n=t.getChildIndexB(),h=r.getBody(),m=s.getBody();if(t.m_filterFlag){if(m.shouldCollide(h)==!1){this.destroyContact(t);continue}if(s.shouldCollide(r)==!1){this.destroyContact(t);continue}t.m_filterFlag=!1}var u=h.isAwake()&&!h.isStatic(),l=m.isAwake()&&!m.isStatic();if(!(u==!1&&l==!1)){var p=r.m_proxies[o].proxyId,_=s.m_proxies[n].proxyId,c=this.m_broadPhase.testOverlap(p,_);if(c==!1){this.destroyContact(t);continue}t.update(this)}}},i.prototype.destroyContact=function(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),oe.destroy(t,this),--this.m_contactCount},i.prototype.on=function(t,e){return typeof t!="string"||typeof e!="function"?this:(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),this)},i.prototype.off=function(t,e){if(typeof t!="string"||typeof e!="function")return this;var r=this._listeners&&this._listeners[t];if(!r||!r.length)return this;var s=r.indexOf(e);return s>=0&&r.splice(s,1),this},i.prototype.publish=function(t,e,r,s){var o=this._listeners&&this._listeners[t];if(!o||!o.length)return 0;for(var n=0;n<o.length;n++)o[n].call(this,e,r,s);return o.length},i.prototype.beginContact=function(t){this.publish("begin-contact",t)},i.prototype.endContact=function(t){this.publish("end-contact",t)},i.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},i.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},i}(),$=function(){function i(t,e,r){if(!(this instanceof i))return new i(t,e,r);typeof t>"u"?(this.x=0,this.y=0,this.z=0):typeof t=="object"?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=r)}return i.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},i._deserialize=function(t){var e=Object.create(i.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e},i.neo=function(t,e,r){var s=Object.create(i.prototype);return s.x=t,s.y=e,s.z=r,s},i.zero=function(){var t=Object.create(i.prototype);return t.x=0,t.y=0,t.z=0,t},i.clone=function(t){return i.neo(t.x,t.y,t.z)},i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)},i.assert=function(t){},i.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},i.prototype.set=function(t,e,r){return this.x=t,this.y=e,this.z=r,this},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.areEqual=function(t,e){return t===e||typeof t=="object"&&t!==null&&typeof e=="object"&&e!==null&&t.x===e.x&&t.y===e.y&&t.z===e.z},i.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},i.cross=function(t,e){return new i(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},i.add=function(t,e){return new i(t.x+e.x,t.y+e.y,t.z+e.z)},i.sub=function(t,e){return new i(t.x-e.x,t.y-e.y,t.z-e.z)},i.mul=function(t,e){return new i(e*t.x,e*t.y,e*t.z)},i.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},i.neg=function(t){return new i(-t.x,-t.y,-t.z)},i}(),ws=g(0,0),Vs=g(0,0),pe=function(i){dt(t,i);function t(e,r){var s=this;return s instanceof t?(s=i.call(this)||this,s.m_type=t.TYPE,s.m_radius=S.polygonRadius,s.m_vertex1=e?a.clone(e):a.zero(),s.m_vertex2=r?a.clone(r):a.zero(),s.m_vertex0=a.zero(),s.m_vertex3=a.zero(),s.m_hasVertex0=!1,s.m_hasVertex3=!1,s):new t(e,r)}return t.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},t._deserialize=function(e){var r=new t(e.vertex1,e.vertex2);return r.m_hasVertex0&&r.setPrevVertex(e.vertex0),r.m_hasVertex3&&r.setNextVertex(e.vertex3),r},t.prototype._reset=function(){},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getType=function(){return this.m_type},t.prototype.setNext=function(e){return this.setNextVertex(e)},t.prototype.setNextVertex=function(e){return e?(this.m_vertex3.setVec2(e),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},t.prototype.getNextVertex=function(){return this.m_vertex3},t.prototype.setPrev=function(e){return this.setPrevVertex(e)},t.prototype.setPrevVertex=function(e){return e?(this.m_vertex0.setVec2(e),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},t.prototype.getPrevVertex=function(){return this.m_vertex0},t.prototype._set=function(e,r){return this.m_vertex1.setVec2(e),this.m_vertex2.setVec2(r),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_vertex1.setVec2(this.m_vertex1),e.m_vertex2.setVec2(this.m_vertex2),e.m_vertex0.setVec2(this.m_vertex0),e.m_vertex3.setVec2(this.m_vertex3),e.m_hasVertex0=this.m_hasVertex0,e.m_hasVertex3=this.m_hasVertex3,e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,r){return!1},t.prototype.rayCast=function(e,r,s,o){var n=B.mulTVec2(s.q,a.sub(r.p1,s.p)),h=B.mulTVec2(s.q,a.sub(r.p2,s.p)),m=a.sub(h,n),u=this.m_vertex1,l=this.m_vertex2,p=a.sub(l,u),_=a.neo(p.y,-p.x);_.normalize();var c=a.dot(_,a.sub(u,n)),y=a.dot(_,m);if(y==0)return!1;var v=c/y;if(v<0||r.maxFraction<v)return!1;var f=a.add(n,a.mulNumVec2(v,m)),d=a.sub(l,u),A=a.dot(d,d);if(A==0)return!1;var b=a.dot(a.sub(f,u),d)/A;return b<0||1<b?!1:(e.fraction=v,c>0?e.normal=B.mulVec2(s.q,_).neg():e.normal=B.mulVec2(s.q,_),!0)},t.prototype.computeAABB=function(e,r,s){T(ws,r,this.m_vertex1),T(Vs,r,this.m_vertex2),_t.combinePoints(e,ws,Vs),_t.extend(e,this.m_radius)},t.prototype.computeMass=function(e,r){e.mass=0,K(e.center,.5,this.m_vertex1,.5,this.m_vertex2),e.I=0},t.prototype.computeDistanceProxy=function(e){e.m_vertices[0]=this.m_vertex1,e.m_vertices[1]=this.m_vertex2,e.m_vertices.length=2,e.m_count=2,e.m_radius=this.m_radius},t.TYPE="edge",t}(je),Cs=g(0,0),Ms=g(0,0),Fi=function(i){dt(t,i);function t(e,r){var s=this;return s instanceof t?(s=i.call(this)||this,s.m_type=t.TYPE,s.m_radius=S.polygonRadius,s.m_vertices=[],s.m_count=0,s.m_prevVertex=null,s.m_nextVertex=null,s.m_hasPrevVertex=!1,s.m_hasNextVertex=!1,s.m_isLoop=!!r,e&&e.length&&(r?s._createLoop(e):s._createChain(e)),s):new t(e,r)}return t.prototype._serialize=function(){var e={type:this.m_type,vertices:this.m_isLoop?this.m_vertices.slice(0,this.m_vertices.length-1):this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(e.prevVertex=this.m_prevVertex),this.m_nextVertex&&(e.nextVertex=this.m_nextVertex),e},t._deserialize=function(e,r,s){var o=[];if(e.vertices)for(var n=0;n<e.vertices.length;n++)o.push(s(a,e.vertices[n]));var h=new t(o,e.isLoop);return e.prevVertex&&h.setPrevVertex(e.prevVertex),e.nextVertex&&h.setNextVertex(e.nextVertex),h},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype._createLoop=function(e){if(!(e.length<3)){for(var r=1;r<e.length;++r)e[r-1],e[r];this.m_vertices=[],this.m_count=e.length+1;for(var r=0;r<e.length;++r)this.m_vertices[r]=a.clone(e[r]);return this.m_vertices[e.length]=a.clone(e[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},t.prototype._createChain=function(e){for(var r=1;r<e.length;++r)e[r-1],e[r];this.m_vertices=[],this.m_count=e.length;for(var r=0;r<e.length;++r)this.m_vertices[r]=a.clone(e[r]);return this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this},t.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices.slice(0,this.m_vertices.length-1)):this._createChain(this.m_vertices)},t.prototype.setPrevVertex=function(e){this.m_prevVertex=e,this.m_hasPrevVertex=!0},t.prototype.getPrevVertex=function(){return this.m_prevVertex},t.prototype.setNextVertex=function(e){this.m_nextVertex=e,this.m_hasNextVertex=!0},t.prototype.getNextVertex=function(){return this.m_nextVertex},t.prototype._clone=function(){var e=new t;return e._createChain(this.m_vertices),e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_prevVertex=this.m_prevVertex,e.m_nextVertex=this.m_nextVertex,e.m_hasPrevVertex=this.m_hasPrevVertex,e.m_hasNextVertex=this.m_hasNextVertex,e},t.prototype.getChildCount=function(){return this.m_count-1},t.prototype.getChildEdge=function(e,r){e.m_type=pe.TYPE,e.m_radius=this.m_radius,e.m_vertex1=this.m_vertices[r],e.m_vertex2=this.m_vertices[r+1],r>0?(e.m_vertex0=this.m_vertices[r-1],e.m_hasVertex0=!0):(e.m_vertex0=this.m_prevVertex,e.m_hasVertex0=this.m_hasPrevVertex),r<this.m_count-2?(e.m_vertex3=this.m_vertices[r+2],e.m_hasVertex3=!0):(e.m_vertex3=this.m_nextVertex,e.m_hasVertex3=this.m_hasNextVertex)},t.prototype.getVertex=function(e){return e<this.m_count?this.m_vertices[e]:this.m_vertices[0]},t.prototype.isLoop=function(){return this.m_isLoop},t.prototype.testPoint=function(e,r){return!1},t.prototype.rayCast=function(e,r,s,o){var n=new pe(this.getVertex(o),this.getVertex(o+1));return n.rayCast(e,r,s,0)},t.prototype.computeAABB=function(e,r,s){T(Cs,r,this.getVertex(s)),T(Ms,r,this.getVertex(s+1)),_t.combinePoints(e,Cs,Ms)},t.prototype.computeMass=function(e,r){e.mass=0,z(e.center),e.I=0},t.prototype.computeDistanceProxy=function(e,r){e.m_vertices[0]=this.getVertex(r),e.m_vertices[1]=this.getVertex(r+1),e.m_count=2,e.m_radius=this.m_radius},t.TYPE="chain",t}(je),Is=Math.max,Vr=Math.min,Re=g(0,0),Ps=g(0,0),Bi=g(0,0),oi=g(0,0),Te=g(0,0),de=g(0,0),we=function(i){dt(t,i);function t(e){var r=this;return r instanceof t?(r=i.call(this)||this,r.m_type=t.TYPE,r.m_radius=S.polygonRadius,r.m_centroid=a.zero(),r.m_vertices=[],r.m_normals=[],r.m_count=0,e&&e.length&&r._set(e),r):new t(e)}return t.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},t._deserialize=function(e,r,s){var o=[];if(e.vertices)for(var n=0;n<e.vertices.length;n++)o.push(s(a,e.vertices[n]));var h=new t(o);return h},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype._clone=function(){var e=new t;e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_count=this.m_count,e.m_centroid.setVec2(this.m_centroid);for(var r=0;r<this.m_count;r++)e.m_vertices.push(this.m_vertices[r].clone());for(var r=0;r<this.m_normals.length;r++)e.m_normals.push(this.m_normals[r].clone());return e},t.prototype.getChildCount=function(){return 1},t.prototype._reset=function(){this._set(this.m_vertices)},t.prototype._set=function(e){if(e.length<3){this._setAsBox(1,1);return}for(var r=Vr(e.length,S.maxPolygonVertices),s=[],o=0;o<r;++o){for(var n=e[o],h=!0,m=0;m<s.length;++m)if(a.distanceSquared(n,s[m])<.25*S.linearSlopSquared){h=!1;break}h&&s.push(a.clone(n))}if(r=s.length,r<3){this._setAsBox(1,1);return}for(var u=0,l=s[0].x,o=1;o<r;++o){var p=s[o].x;(p>l||p===l&&s[o].y<s[u].y)&&(u=o,l=p)}for(var _=[],c=0,y=u;;){_[c]=y;for(var v=0,m=1;m<r;++m){if(v===y){v=m;continue}var f=a.sub(s[v],s[_[c]]),n=a.sub(s[m],s[_[c]]),d=a.crossVec2Vec2(f,n);d<0&&(v=m),d===0&&n.lengthSquared()>f.lengthSquared()&&(v=m)}if(++c,y=v,v===u)break}if(c<3){this._setAsBox(1,1);return}this.m_count=c,this.m_vertices=[];for(var o=0;o<c;++o)this.m_vertices[o]=s[_[o]];for(var o=0;o<c;++o){var A=o,b=o+1<c?o+1:0,w=a.sub(this.m_vertices[b],this.m_vertices[A]);this.m_normals[o]=a.crossVec2Num(w,1),this.m_normals[o].normalize()}this.m_centroid=_n(this.m_vertices,c)},t.prototype._setAsBox=function(e,r,s,o){if(this.m_vertices[0]=a.neo(e,-r),this.m_vertices[1]=a.neo(e,r),this.m_vertices[2]=a.neo(-e,r),this.m_vertices[3]=a.neo(-e,-r),this.m_normals[0]=a.neo(1,0),this.m_normals[1]=a.neo(0,1),this.m_normals[2]=a.neo(-1,0),this.m_normals[3]=a.neo(0,-1),this.m_count=4,s&&a.isValid(s)){o=o||0,x(this.m_centroid,s);var n=Xt.identity();n.p.setVec2(s),n.q.setAngle(o);for(var h=0;h<this.m_count;++h)this.m_vertices[h]=Xt.mulVec2(n,this.m_vertices[h]),this.m_normals[h]=B.mulVec2(n.q,this.m_normals[h])}},t.prototype.testPoint=function(e,r){for(var s=Tr(Re,e,r),o=0;o<this.m_count;++o){var n=C(this.m_normals[o],s)-C(this.m_normals[o],this.m_vertices[o]);if(n>0)return!1}return!0},t.prototype.rayCast=function(e,r,s,o){for(var n=B.mulTVec2(s.q,a.sub(r.p1,s.p)),h=B.mulTVec2(s.q,a.sub(r.p2,s.p)),m=a.sub(h,n),u=0,l=r.maxFraction,p=-1,_=0;_<this.m_count;++_){var c=a.dot(this.m_normals[_],a.sub(this.m_vertices[_],n)),y=a.dot(this.m_normals[_],m);if(y==0){if(c<0)return!1}else y<0&&c<u*y?(u=c/y,p=_):y>0&&c<l*y&&(l=c/y);if(l<u)return!1}return p>=0?(e.fraction=u,e.normal=B.mulVec2(s.q,this.m_normals[p]),!0):!1},t.prototype.computeAABB=function(e,r,s){for(var o=1/0,n=1/0,h=-1/0,m=-1/0,u=0;u<this.m_count;++u){var l=T(Re,r,this.m_vertices[u]);o=Vr(o,l.x),h=Is(h,l.x),n=Vr(n,l.y),m=Is(m,l.y)}ut(e.lowerBound,o-this.m_radius,n-this.m_radius),ut(e.upperBound,h+this.m_radius,m+this.m_radius)},t.prototype.computeMass=function(e,r){z(Te);var s=0,o=0;z(de);for(var n=0;n<this.m_count;++n)Rt(de,this.m_vertices[n]);F(de,1/this.m_count,de);for(var h=1/3,n=0;n<this.m_count;++n){q(Bi,this.m_vertices[n],de),n+1<this.m_count?q(oi,this.m_vertices[n+1],de):q(oi,this.m_vertices[0],de);var m=D(Bi,oi),u=.5*m;s+=u,K(Re,u*h,Bi,u*h,oi),Rt(Te,Re);var l=Bi.x,p=Bi.y,_=oi.x,c=oi.y,y=l*l+_*l+_*_,v=p*p+c*p+c*c;o+=.25*h*m*(y+v)}e.mass=r*s,F(Te,1/s,Te),Eo(e.center,Te,de),e.I=r*o,e.I+=e.mass*(C(e.center,e.center)-C(Te,Te))},t.prototype.validate=function(){for(var e=0;e<this.m_count;++e){var r=e,s=e<this.m_count-1?r+1:0,o=this.m_vertices[r];q(Ps,this.m_vertices[s],o);for(var n=0;n<this.m_count;++n)if(!(n==r||n==s)){var h=D(Ps,q(Re,this.m_vertices[n],o));if(h<0)return!1}}return!0},t.prototype.computeDistanceProxy=function(e){for(var r=0;r<this.m_count;++r)e.m_vertices[r]=this.m_vertices[r];e.m_vertices.length=this.m_count,e.m_count=this.m_count,e.m_radius=this.m_radius},t.TYPE="polygon",t}(je);function _n(i,t){for(var e=a.zero(),r=0,s=a.zero(),o,n=1/3,o=0;o<t;++o){var h=s,m=i[o],u=o+1<t?i[o+1]:i[0],l=a.sub(m,h),p=a.sub(u,h),_=a.crossVec2Vec2(l,p),c=.5*_;r+=c,re(Re,1,h,1,m,1,u),jt(e,c*n,Re)}return e.mul(1/r),e}var un=Math.sqrt,pn=Math.PI,Ss=g(0,0),Ve=function(i){dt(t,i);function t(e,r){var s=this;return s instanceof t?(s=i.call(this)||this,s.m_type=t.TYPE,s.m_p=a.zero(),s.m_radius=1,typeof e=="object"&&a.isValid(e)?(s.m_p.setVec2(e),typeof r=="number"&&(s.m_radius=r)):typeof e=="number"&&(s.m_radius=e),s):new t(e,r)}return t.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},t._deserialize=function(e){return new t(e.p,e.radius)},t.prototype._reset=function(){},t.prototype.getType=function(){return this.m_type},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getCenter=function(){return this.m_p},t.prototype._clone=function(){var e=new t;return e.m_type=this.m_type,e.m_radius=this.m_radius,e.m_p=this.m_p.clone(),e},t.prototype.getChildCount=function(){return 1},t.prototype.testPoint=function(e,r){var s=T(Ss,e,this.m_p);return Ye(r,s)<=this.m_radius*this.m_radius},t.prototype.rayCast=function(e,r,s,o){var n=a.add(s.p,B.mulVec2(s.q,this.m_p)),h=a.sub(r.p1,n),m=a.dot(h,h)-this.m_radius*this.m_radius,u=a.sub(r.p2,r.p1),l=a.dot(h,u),p=a.dot(u,u),_=l*l-p*m;if(_<0||p<Vt)return!1;var c=-(l+un(_));return 0<=c&&c<=r.maxFraction*p?(c/=p,e.fraction=c,e.normal=a.add(h,a.mulNumVec2(c,u)),e.normal.normalize(),!0):!1},t.prototype.computeAABB=function(e,r,s){var o=T(Ss,r,this.m_p);ut(e.lowerBound,o.x-this.m_radius,o.y-this.m_radius),ut(e.upperBound,o.x+this.m_radius,o.y+this.m_radius)},t.prototype.computeMass=function(e,r){e.mass=r*pn*this.m_radius*this.m_radius,x(e.center,this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+$e(this.m_p))},t.prototype.computeDistanceProxy=function(e){e.m_vertices[0]=this.m_p,e.m_vertices.length=1,e.m_count=1,e.m_radius=this.m_radius},t.TYPE="circle",t}(je),vn=Math.abs,yn=Math.PI,fn={frequencyHz:0,dampingRatio:0},zs=function(i){dt(t,i);function t(e,r,s,o,n){var h=this;if(!(h instanceof t))return new t(e,r,s,o,n);if(s&&o&&"m_type"in o&&"x"in s&&"y"in s){var m=s;s=o,o=m}return e=Ft(e,fn),h=i.call(this,e,r,s)||this,r=h.m_bodyA,s=h.m_bodyB,h.m_type=t.TYPE,h.m_localAnchorA=a.clone(o?r.getLocalPoint(o):e.localAnchorA||a.zero()),h.m_localAnchorB=a.clone(n?s.getLocalPoint(n):e.localAnchorB||a.zero()),h.m_length=Number.isFinite(e.length)?e.length:a.distance(r.getWorldPoint(h.m_localAnchorA),s.getWorldPoint(h.m_localAnchorB)),h.m_frequencyHz=e.frequencyHz,h.m_dampingRatio=e.dampingRatio,h.m_impulse=0,h.m_gamma=0,h.m_bias=0,h}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r);var o=new t(e);return o},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.length>0?this.m_length=+e.length:e.length<0||(e.anchorA||e.anchorA||e.anchorA||e.anchorA)&&(this.m_length=a.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB))),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setLength=function(e){this.m_length=e},t.prototype.getLength=function(){return this.m_length},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,u=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,p=B.neo(s),_=B.neo(m);this.m_rA=B.mulVec2(p,a.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=B.mulVec2(_,a.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=a.sub(a.add(h,this.m_rB),a.add(r,this.m_rA));var c=this.m_u.length();c>S.linearSlop?this.m_u.mul(1/c):this.m_u.setNum(0,0);var y=a.crossVec2Vec2(this.m_rA,this.m_u),v=a.crossVec2Vec2(this.m_rB,this.m_u),f=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*v*v;if(this.m_mass=f!=0?1/f:0,this.m_frequencyHz>0){var d=c-this.m_length,A=2*yn*this.m_frequencyHz,b=2*this.m_mass*this.m_dampingRatio*A,w=this.m_mass*A*A,V=e.dt;this.m_gamma=V*(b+V*w),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=d*V*w*this.m_gamma,f+=this.m_gamma,this.m_mass=f!=0?1/f:0}else this.m_gamma=0,this.m_bias=0;if(e.warmStarting){this.m_impulse*=e.dtRatio;var I=a.mulNumVec2(this.m_impulse,this.m_u);o.subMul(this.m_invMassA,I),n-=this.m_invIA*a.crossVec2Vec2(this.m_rA,I),u.addMul(this.m_invMassB,I),l+=this.m_invIB*a.crossVec2Vec2(this.m_rB,I)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(u),this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,h=a.add(r,a.crossNumVec2(s,this.m_rA)),m=a.add(o,a.crossNumVec2(n,this.m_rB)),u=a.dot(this.m_u,m)-a.dot(this.m_u,h),l=-this.m_mass*(u+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=l;var p=a.mulNumVec2(l,this.m_u);r.subMul(this.m_invMassA,p),s-=this.m_invIA*a.crossVec2Vec2(this.m_rA,p),o.addMul(this.m_invMassB,p),n+=this.m_invIB*a.crossVec2Vec2(this.m_rB,p),this.m_bodyA.c_velocity.v.setVec2(r),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(o),this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){if(this.m_frequencyHz>0)return!0;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,h=B.neo(s),m=B.neo(n),u=B.mulSub(h,this.m_localAnchorA,this.m_localCenterA),l=B.mulSub(m,this.m_localAnchorB,this.m_localCenterB),p=a.sub(a.add(o,l),a.add(r,u)),_=p.normalize(),c=pt(_-this.m_length,-S.maxLinearCorrection,S.maxLinearCorrection),y=-this.m_mass*c,v=a.mulNumVec2(y,p);return r.subMul(this.m_invMassA,v),s-=this.m_invIA*a.crossVec2Vec2(u,v),o.addMul(this.m_invMassB,v),n+=this.m_invIB*a.crossVec2Vec2(l,v),this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=n,vn(c)<S.linearSlop},t.TYPE="distance-joint",t}(yt),dn={maxForce:0,maxTorque:0},Fs=function(i){dt(t,i);function t(e,r,s,o){var n=this;return n instanceof t?(e=Ft(e,dn),n=i.call(this,e,r,s)||this,r=n.m_bodyA,s=n.m_bodyB,n.m_type=t.TYPE,n.m_localAnchorA=a.clone(o?r.getLocalPoint(o):e.localAnchorA||a.zero()),n.m_localAnchorB=a.clone(o?s.getLocalPoint(o):e.localAnchorB||a.zero()),n.m_linearImpulse=a.zero(),n.m_angularImpulse=0,n.m_maxForce=e.maxForce,n.m_maxTorque=e.maxTorque,n):new t(e,r,s,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r);var o=new t(e);return o},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.maxTorque)&&(this.m_maxTorque=e.maxTorque)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,u=B.neo(r),l=B.neo(n);this.m_rA=B.mulVec2(u,a.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=B.mulVec2(l,a.sub(this.m_localAnchorB,this.m_localCenterB));var p=this.m_invMassA,_=this.m_invMassB,c=this.m_invIA,y=this.m_invIB,v=new Kt;if(v.ex.x=p+_+c*this.m_rA.y*this.m_rA.y+y*this.m_rB.y*this.m_rB.y,v.ex.y=-c*this.m_rA.x*this.m_rA.y-y*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=p+_+c*this.m_rA.x*this.m_rA.x+y*this.m_rB.x*this.m_rB.x,this.m_linearMass=v.getInverse(),this.m_angularMass=c+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var f=a.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);s.subMul(p,f),o-=c*(a.crossVec2Vec2(this.m_rA,f)+this.m_angularImpulse),h.addMul(_,f),m+=y*(a.crossVec2Vec2(this.m_rB,f)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=m},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,h=this.m_invMassA,m=this.m_invMassB,u=this.m_invIA,l=this.m_invIB,p=e.dt;{var _=n-s,c=-this.m_angularMass*_,y=this.m_angularImpulse,v=p*this.m_maxTorque;this.m_angularImpulse=pt(this.m_angularImpulse+c,-v,v),c=this.m_angularImpulse-y,s-=u*c,n+=l*c}{var _=a.sub(a.add(o,a.crossNumVec2(n,this.m_rB)),a.add(r,a.crossNumVec2(s,this.m_rA))),c=a.neg(Kt.mulVec2(this.m_linearMass,_)),y=this.m_linearImpulse;this.m_linearImpulse.add(c);var v=p*this.m_maxForce;this.m_linearImpulse.lengthSquared()>v*v&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(v)),c=a.sub(this.m_linearImpulse,y),r.subMul(h,c),s-=u*a.crossVec2Vec2(this.m_rA,c),o.addMul(m,c),n+=l*a.crossVec2Vec2(this.m_rB,c)}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="friction-joint",t}(yt),be=function(){function i(t,e,r){typeof t=="object"&&t!==null?(this.ex=$.clone(t),this.ey=$.clone(e),this.ez=$.clone(r)):(this.ex=$.zero(),this.ey=$.zero(),this.ez=$.zero())}return i.prototype.toString=function(){return JSON.stringify(this)},i.isValid=function(t){return t===null||typeof t>"u"?!1:$.isValid(t.ex)&&$.isValid(t.ey)&&$.isValid(t.ez)},i.assert=function(t){},i.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},i.prototype.solve33=function(t){var e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,r=this.ey.z*this.ez.x-this.ey.x*this.ez.z,s=this.ey.x*this.ez.y-this.ey.y*this.ez.x,o=this.ex.x*e+this.ex.y*r+this.ex.z*s;o!==0&&(o=1/o);var n=new $;return e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,r=this.ey.z*this.ez.x-this.ey.x*this.ez.z,s=this.ey.x*this.ez.y-this.ey.y*this.ez.x,n.x=o*(t.x*e+t.y*r+t.z*s),e=t.y*this.ez.z-t.z*this.ez.y,r=t.z*this.ez.x-t.x*this.ez.z,s=t.x*this.ez.y-t.y*this.ez.x,n.y=o*(this.ex.x*e+this.ex.y*r+this.ex.z*s),e=this.ey.y*t.z-this.ey.z*t.y,r=this.ey.z*t.x-this.ey.x*t.z,s=this.ey.x*t.y-this.ey.y*t.x,n.z=o*(this.ex.x*e+this.ex.y*r+this.ex.z*s),n},i.prototype.solve22=function(t){var e=this.ex.x,r=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-r*s;n!==0&&(n=1/n);var h=a.zero();return h.x=n*(o*t.x-r*t.y),h.y=n*(e*t.y-s*t.x),h},i.prototype.getInverse22=function(t){var e=this.ex.x,r=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-r*s;n!==0&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*r,t.ex.z=0,t.ex.y=-n*s,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},i.prototype.getSymInverse33=function(t){var e=$.dot(this.ex,$.cross(this.ey,this.ez));e!==0&&(e=1/e);var r=this.ex.x,s=this.ey.x,o=this.ez.x,n=this.ey.y,h=this.ez.y,m=this.ez.z;t.ex.x=e*(n*m-h*h),t.ex.y=e*(o*h-s*m),t.ex.z=e*(s*h-o*n),t.ey.x=t.ex.y,t.ey.y=e*(r*m-o*o),t.ey.z=e*(o*s-r*h),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(r*n-s*s)},i.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var r=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,o=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new $(r,s,o)}else if(e&&"y"in e&&"x"in e){var r=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return a.neo(r,s)}},i.mulVec3=function(t,e){var r=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,o=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new $(r,s,o)},i.mulVec2=function(t,e){var r=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return a.neo(r,s)},i.add=function(t,e){return new i($.add(t.ex,e.ex),$.add(t.ey,e.ey),$.add(t.ez,e.ez))},i}(),Ls=Math.abs,ct;(function(i){i[i.inactiveLimit=0]="inactiveLimit",i[i.atLowerLimit=1]="atLowerLimit",i[i.atUpperLimit=2]="atUpperLimit",i[i.equalLimits=3]="equalLimits"})(ct||(ct={}));var ni={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1},Be=function(i){dt(t,i);function t(e,r,s,o){var n=this,h,m,u,l,p,_;return n instanceof t?(e=e??{},n=i.call(this,e,r,s)||this,r=n.m_bodyA,s=n.m_bodyB,n.m_mass=new be,n.m_limitState=ct.inactiveLimit,n.m_type=t.TYPE,a.isValid(o)?n.m_localAnchorA=r.getLocalPoint(o):a.isValid(e.localAnchorA)?n.m_localAnchorA=a.clone(e.localAnchorA):n.m_localAnchorA=a.zero(),a.isValid(o)?n.m_localAnchorB=s.getLocalPoint(o):a.isValid(e.localAnchorB)?n.m_localAnchorB=a.clone(e.localAnchorB):n.m_localAnchorB=a.zero(),Number.isFinite(e.referenceAngle)?n.m_referenceAngle=e.referenceAngle:n.m_referenceAngle=s.getAngle()-r.getAngle(),n.m_impulse=new $,n.m_motorImpulse=0,n.m_lowerAngle=(h=e.lowerAngle)!==null&&h!==void 0?h:ni.lowerAngle,n.m_upperAngle=(m=e.upperAngle)!==null&&m!==void 0?m:ni.upperAngle,n.m_maxMotorTorque=(u=e.maxMotorTorque)!==null&&u!==void 0?u:ni.maxMotorTorque,n.m_motorSpeed=(l=e.motorSpeed)!==null&&l!==void 0?l:ni.motorSpeed,n.m_enableLimit=(p=e.enableLimit)!==null&&p!==void 0?p:ni.enableLimit,n.m_enableMotor=(_=e.enableMotor)!==null&&_!==void 0?_:ni.enableMotor,n):new t(e,r,s,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r);var o=new t(e);return o},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.referenceAngle)&&(this.m_referenceAngle=e.referenceAngle),e.enableLimit!==void 0&&(this.m_enableLimit=e.enableLimit),Number.isFinite(e.lowerAngle)&&(this.m_lowerAngle=e.lowerAngle),Number.isFinite(e.upperAngle)&&(this.m_upperAngle=e.upperAngle),Number.isFinite(e.maxMotorTorque)&&(this.m_maxMotorTorque=e.maxMotorTorque),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed),e.enableMotor!==void 0&&(this.m_enableMotor=e.enableMotor)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointAngle=function(){var e=this.m_bodyA,r=this.m_bodyB;return r.m_sweep.a-e.m_sweep.a-this.m_referenceAngle},t.prototype.getJointSpeed=function(){var e=this.m_bodyA,r=this.m_bodyB;return r.m_angularVelocity-e.m_angularVelocity},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){e!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e)},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerAngle},t.prototype.getUpperLimit=function(){return this.m_upperAngle},t.prototype.setLimits=function(e,r){(e!=this.m_lowerAngle||r!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=e,this.m_upperAngle=r)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,u=B.neo(r),l=B.neo(n);this.m_rA=B.mulVec2(u,a.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=B.mulVec2(l,a.sub(this.m_localAnchorB,this.m_localCenterB));var p=this.m_invMassA,_=this.m_invMassB,c=this.m_invIA,y=this.m_invIB,v=c+y===0;if(this.m_mass.ex.x=p+_+this.m_rA.y*this.m_rA.y*c+this.m_rB.y*this.m_rB.y*y,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*c-this.m_rB.y*this.m_rB.x*y,this.m_mass.ez.x=-this.m_rA.y*c-this.m_rB.y*y,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=p+_+this.m_rA.x*this.m_rA.x*c+this.m_rB.x*this.m_rB.x*y,this.m_mass.ez.y=this.m_rA.x*c+this.m_rB.x*y,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=c+y,this.m_motorMass=c+y,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(this.m_enableMotor==!1||v)&&(this.m_motorImpulse=0),this.m_enableLimit&&v==!1){var f=n-r-this.m_referenceAngle;Ls(this.m_upperAngle-this.m_lowerAngle)<2*S.angularSlop?this.m_limitState=ct.equalLimits:f<=this.m_lowerAngle?(this.m_limitState!=ct.atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=ct.atLowerLimit):f>=this.m_upperAngle?(this.m_limitState!=ct.atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=ct.atUpperLimit):(this.m_limitState=ct.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=ct.inactiveLimit;if(e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var d=a.neo(this.m_impulse.x,this.m_impulse.y);s.subMul(p,d),o-=c*(a.crossVec2Vec2(this.m_rA,d)+this.m_motorImpulse+this.m_impulse.z),h.addMul(_,d),m+=y*(a.crossVec2Vec2(this.m_rB,d)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=m},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,h=this.m_invMassA,m=this.m_invMassB,u=this.m_invIA,l=this.m_invIB,p=u+l===0;if(this.m_enableMotor&&this.m_limitState!=ct.equalLimits&&p==!1){var _=n-s-this.m_motorSpeed,c=-this.m_motorMass*_,y=this.m_motorImpulse,v=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=pt(this.m_motorImpulse+c,-v,v),c=this.m_motorImpulse-y,s-=u*c,n+=l*c}if(this.m_enableLimit&&this.m_limitState!=ct.inactiveLimit&&p==!1){var f=a.zero();f.addCombine(1,o,1,a.crossNumVec2(n,this.m_rB)),f.subCombine(1,r,1,a.crossNumVec2(s,this.m_rA));var d=n-s,_=new $(f.x,f.y,d),c=$.neg(this.m_mass.solve33(_));if(this.m_limitState==ct.equalLimits)this.m_impulse.add(c);else if(this.m_limitState==ct.atLowerLimit){var A=this.m_impulse.z+c.z;if(A<0){var b=a.combine(-1,f,this.m_impulse.z,a.neo(this.m_mass.ez.x,this.m_mass.ez.y)),w=this.m_mass.solve22(b);c.x=w.x,c.y=w.y,c.z=-this.m_impulse.z,this.m_impulse.x+=w.x,this.m_impulse.y+=w.y,this.m_impulse.z=0}else this.m_impulse.add(c)}else if(this.m_limitState==ct.atUpperLimit){var A=this.m_impulse.z+c.z;if(A>0){var b=a.combine(-1,f,this.m_impulse.z,a.neo(this.m_mass.ez.x,this.m_mass.ez.y)),w=this.m_mass.solve22(b);c.x=w.x,c.y=w.y,c.z=-this.m_impulse.z,this.m_impulse.x+=w.x,this.m_impulse.y+=w.y,this.m_impulse.z=0}else this.m_impulse.add(c)}var V=a.neo(c.x,c.y);r.subMul(h,V),s-=u*(a.crossVec2Vec2(this.m_rA,V)+c.z),o.addMul(m,V),n+=l*(a.crossVec2Vec2(this.m_rB,V)+c.z)}else{var _=a.zero();_.addCombine(1,o,1,a.crossNumVec2(n,this.m_rB)),_.subCombine(1,r,1,a.crossNumVec2(s,this.m_rA));var c=this.m_mass.solve22(a.neg(_));this.m_impulse.x+=c.x,this.m_impulse.y+=c.y,r.subMul(h,c),s-=u*a.crossVec2Vec2(this.m_rA,c),o.addMul(m,c),n+=l*a.crossVec2Vec2(this.m_rB,c)}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,h=B.neo(s),m=B.neo(n),u=0,l=0,p=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=ct.inactiveLimit&&p==!1){var _=n-s-this.m_referenceAngle,c=0;if(this.m_limitState==ct.equalLimits){var y=pt(_-this.m_lowerAngle,-S.maxAngularCorrection,S.maxAngularCorrection);c=-this.m_motorMass*y,u=Ls(y)}else if(this.m_limitState==ct.atLowerLimit){var y=_-this.m_lowerAngle;u=-y,y=pt(y+S.angularSlop,-S.maxAngularCorrection,0),c=-this.m_motorMass*y}else if(this.m_limitState==ct.atUpperLimit){var y=_-this.m_upperAngle;u=y,y=pt(y-S.angularSlop,0,S.maxAngularCorrection),c=-this.m_motorMass*y}s-=this.m_invIA*c,n+=this.m_invIB*c}{h.setAngle(s),m.setAngle(n);var v=B.mulVec2(h,a.sub(this.m_localAnchorA,this.m_localCenterA)),f=B.mulVec2(m,a.sub(this.m_localAnchorB,this.m_localCenterB)),y=a.zero();y.addCombine(1,o,1,f),y.subCombine(1,r,1,v),l=y.length();var d=this.m_invMassA,A=this.m_invMassB,b=this.m_invIA,w=this.m_invIB,V=new Kt;V.ex.x=d+A+b*v.y*v.y+w*f.y*f.y,V.ex.y=-b*v.x*v.y-w*f.x*f.y,V.ey.x=V.ex.y,V.ey.y=d+A+b*v.x*v.x+w*f.x*f.x;var I=a.neg(V.solve(y));r.subMul(d,I),s-=b*a.crossVec2Vec2(v,I),o.addMul(A,I),n+=w*a.crossVec2Vec2(f,I)}return this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=n,l<=S.linearSlop&&u<=S.angularSlop},t.TYPE="revolute-joint",t}(yt),bi=Math.abs,Ts=Math.max,xn=Math.min,wt;(function(i){i[i.inactiveLimit=0]="inactiveLimit",i[i.atLowerLimit=1]="atLowerLimit",i[i.atUpperLimit=2]="atUpperLimit",i[i.equalLimits=3]="equalLimits"})(wt||(wt={}));var An={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},qs=function(i){dt(t,i);function t(e,r,s,o,n){var h=this;return h instanceof t?(e=Ft(e,An),h=i.call(this,e,r,s)||this,r=h.m_bodyA,s=h.m_bodyB,h.m_type=t.TYPE,h.m_localAnchorA=a.clone(o?r.getLocalPoint(o):e.localAnchorA||a.zero()),h.m_localAnchorB=a.clone(o?s.getLocalPoint(o):e.localAnchorB||a.zero()),h.m_localXAxisA=a.clone(n?r.getLocalVector(n):e.localAxisA||a.neo(1,0)),h.m_localXAxisA.normalize(),h.m_localYAxisA=a.crossNumVec2(1,h.m_localXAxisA),h.m_referenceAngle=Number.isFinite(e.referenceAngle)?e.referenceAngle:s.getAngle()-r.getAngle(),h.m_impulse=new $,h.m_motorMass=0,h.m_motorImpulse=0,h.m_lowerTranslation=e.lowerTranslation,h.m_upperTranslation=e.upperTranslation,h.m_maxMotorForce=e.maxMotorForce,h.m_motorSpeed=e.motorSpeed,h.m_enableLimit=e.enableLimit,h.m_enableMotor=e.enableMotor,h.m_limitState=wt.inactiveLimit,h.m_axis=a.zero(),h.m_perp=a.zero(),h.m_K=new be,h):new t(e,r,s,o,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r),e.localAxisA=a.clone(e.localAxisA);var o=new t(e);return o},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(a.crossNumVec2(1,e.localAxisA))),Number.isFinite(e.referenceAngle)&&(this.m_referenceAngle=e.referenceAngle),typeof e.enableLimit<"u"&&(this.m_enableLimit=!!e.enableLimit),Number.isFinite(e.lowerTranslation)&&(this.m_lowerTranslation=e.lowerTranslation),Number.isFinite(e.upperTranslation)&&(this.m_upperTranslation=e.upperTranslation),typeof e.enableMotor<"u"&&(this.m_enableMotor=!!e.enableMotor),Number.isFinite(e.maxMotorForce)&&(this.m_maxMotorForce=e.maxMotorForce),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.getJointTranslation=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),r=this.m_bodyB.getWorldPoint(this.m_localAnchorB),s=a.sub(r,e),o=this.m_bodyA.getWorldVector(this.m_localXAxisA),n=a.dot(s,o);return n},t.prototype.getJointSpeed=function(){var e=this.m_bodyA,r=this.m_bodyB,s=B.mulVec2(e.m_xf.q,a.sub(this.m_localAnchorA,e.m_sweep.localCenter)),o=B.mulVec2(r.m_xf.q,a.sub(this.m_localAnchorB,r.m_sweep.localCenter)),n=a.add(e.m_sweep.c,s),h=a.add(r.m_sweep.c,o),m=a.sub(h,n),u=B.mulVec2(e.m_xf.q,this.m_localXAxisA),l=e.m_linearVelocity,p=r.m_linearVelocity,_=e.m_angularVelocity,c=r.m_angularVelocity,y=a.dot(m,a.crossNumVec2(_,u))+a.dot(u,a.sub(a.addCrossNumVec2(p,c,o),a.addCrossNumVec2(l,_,s)));return y},t.prototype.isLimitEnabled=function(){return this.m_enableLimit},t.prototype.enableLimit=function(e){e!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=e,this.m_impulse.z=0)},t.prototype.getLowerLimit=function(){return this.m_lowerTranslation},t.prototype.getUpperLimit=function(){return this.m_upperTranslation},t.prototype.setLimits=function(e,r){(e!=this.m_lowerTranslation||r!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=r,this.m_impulse.z=0)},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.setMaxMotorForce=function(e){e!=this.m_maxMotorForce&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=e)},t.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.getMotorForce=function(e){return e*this.m_motorImpulse},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.y},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,u=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,p=B.neo(s),_=B.neo(m),c=B.mulVec2(p,a.sub(this.m_localAnchorA,this.m_localCenterA)),y=B.mulVec2(_,a.sub(this.m_localAnchorB,this.m_localCenterB)),v=a.zero();v.addCombine(1,h,1,y),v.subCombine(1,r,1,c);var f=this.m_invMassA,d=this.m_invMassB,A=this.m_invIA,b=this.m_invIB;this.m_axis=B.mulVec2(p,this.m_localXAxisA),this.m_a1=a.crossVec2Vec2(a.add(v,c),this.m_axis),this.m_a2=a.crossVec2Vec2(y,this.m_axis),this.m_motorMass=f+d+A*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass);{this.m_perp=B.mulVec2(p,this.m_localYAxisA),this.m_s1=a.crossVec2Vec2(a.add(v,c),this.m_perp),this.m_s2=a.crossVec2Vec2(y,this.m_perp),a.crossVec2Vec2(c,this.m_perp);var w=f+d+A*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,V=A*this.m_s1+b*this.m_s2,I=A*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,M=A+b;M==0&&(M=1);var P=A*this.m_a1+b*this.m_a2,R=f+d+A*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;this.m_K.ex.set(w,V,I),this.m_K.ey.set(V,M,P),this.m_K.ez.set(I,P,R)}if(this.m_enableLimit){var E=a.dot(this.m_axis,v);bi(this.m_upperTranslation-this.m_lowerTranslation)<2*S.linearSlop?this.m_limitState=wt.equalLimits:E<=this.m_lowerTranslation?this.m_limitState!=wt.atLowerLimit&&(this.m_limitState=wt.atLowerLimit,this.m_impulse.z=0):E>=this.m_upperTranslation?this.m_limitState!=wt.atUpperLimit&&(this.m_limitState=wt.atUpperLimit,this.m_impulse.z=0):(this.m_limitState=wt.inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=wt.inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor==!1&&(this.m_motorImpulse=0),e.warmStarting){this.m_impulse.mul(e.dtRatio),this.m_motorImpulse*=e.dtRatio;var O=a.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),Y=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,U=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;o.subMul(f,O),n-=A*Y,u.addMul(d,O),l+=b*U}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(u),this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,h=this.m_invMassA,m=this.m_invMassB,u=this.m_invIA,l=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!=wt.equalLimits){var p=a.dot(this.m_axis,a.sub(o,r))+this.m_a2*n-this.m_a1*s,_=this.m_motorMass*(this.m_motorSpeed-p),c=this.m_motorImpulse,y=e.dt*this.m_maxMotorForce;this.m_motorImpulse=pt(this.m_motorImpulse+_,-y,y),_=this.m_motorImpulse-c;var v=a.mulNumVec2(_,this.m_axis),f=_*this.m_a1,d=_*this.m_a2;r.subMul(h,v),s-=u*f,o.addMul(m,v),n+=l*d}var A=a.zero();if(A.x+=a.dot(this.m_perp,o)+this.m_s2*n,A.x-=a.dot(this.m_perp,r)+this.m_s1*s,A.y=n-s,this.m_enableLimit&&this.m_limitState!=wt.inactiveLimit){var b=0;b+=a.dot(this.m_axis,o)+this.m_a2*n,b-=a.dot(this.m_axis,r)+this.m_a1*s;var p=new $(A.x,A.y,b),w=$.clone(this.m_impulse),V=this.m_K.solve33($.neg(p));this.m_impulse.add(V),this.m_limitState==wt.atLowerLimit?this.m_impulse.z=Ts(this.m_impulse.z,0):this.m_limitState==wt.atUpperLimit&&(this.m_impulse.z=xn(this.m_impulse.z,0));var I=a.combine(-1,A,-(this.m_impulse.z-w.z),a.neo(this.m_K.ez.x,this.m_K.ez.y)),M=a.add(this.m_K.solve22(I),a.neo(w.x,w.y));this.m_impulse.x=M.x,this.m_impulse.y=M.y,V=$.sub(this.m_impulse,w);var v=a.combine(V.x,this.m_perp,V.z,this.m_axis),f=V.x*this.m_s1+V.y+V.z*this.m_a1,d=V.x*this.m_s2+V.y+V.z*this.m_a2;r.subMul(h,v),s-=u*f,o.addMul(m,v),n+=l*d}else{var V=this.m_K.solve22(a.neg(A));this.m_impulse.x+=V.x,this.m_impulse.y+=V.y;var v=a.mulNumVec2(V.x,this.m_perp),f=V.x*this.m_s1+V.y,d=V.x*this.m_s2+V.y;r.subMul(h,v),s-=u*f,o.addMul(m,v),n+=l*d}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,h=B.neo(s),m=B.neo(n),u=this.m_invMassA,l=this.m_invMassB,p=this.m_invIA,_=this.m_invIB,c=B.mulVec2(h,a.sub(this.m_localAnchorA,this.m_localCenterA)),y=B.mulVec2(m,a.sub(this.m_localAnchorB,this.m_localCenterB)),v=a.sub(a.add(o,y),a.add(r,c)),f=B.mulVec2(h,this.m_localXAxisA),d=a.crossVec2Vec2(a.add(v,c),f),A=a.crossVec2Vec2(y,f),b=B.mulVec2(h,this.m_localYAxisA),w=a.crossVec2Vec2(a.add(v,c),b),V=a.crossVec2Vec2(y,b),I=new $,M=a.zero();M.x=a.dot(b,v),M.y=n-s-this.m_referenceAngle;var P=bi(M.x),R=bi(M.y),E=S.linearSlop,O=S.maxLinearCorrection,Y=!1,U=0;if(this.m_enableLimit){var j=a.dot(f,v);bi(this.m_upperTranslation-this.m_lowerTranslation)<2*E?(U=pt(j,-O,O),P=Ts(P,bi(j)),Y=!0):j<=this.m_lowerTranslation?(U=pt(j-this.m_lowerTranslation+E,-O,0),P=Math.max(P,this.m_lowerTranslation-j),Y=!0):j>=this.m_upperTranslation&&(U=pt(j-this.m_upperTranslation-E,0,O),P=Math.max(P,j-this.m_upperTranslation),Y=!0)}if(Y){var Ct=u+l+p*w*w+_*V*V,lt=p*w+_*V,Jt=p*w*d+_*V*A,At=p+_;At==0&&(At=1);var tt=p*d+_*A,vi=u+l+p*d*d+_*A*A,Lt=new be;Lt.ex.set(Ct,lt,Jt),Lt.ey.set(lt,At,tt),Lt.ez.set(Jt,tt,vi);var ve=new $;ve.x=M.x,ve.y=M.y,ve.z=U,I=Lt.solve33($.neg(ve))}else{var Ct=u+l+p*w*w+_*V*V,lt=p*w+_*V,At=p+_;At==0&&(At=1);var Lt=new Kt;Lt.ex.setNum(Ct,lt),Lt.ey.setNum(lt,At);var Ce=Lt.solve(a.neg(M));I.x=Ce.x,I.y=Ce.y,I.z=0}var yi=a.combine(I.x,b,I.z,f),Xe=I.x*w+I.y+I.z*d,_r=I.x*V+I.y+I.z*A;return r.subMul(u,yi),s-=p*Xe,o.addMul(l,yi),n+=_*_r,this.m_bodyA.c_position.c=r,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=n,P<=S.linearSlop&&R<=S.angularSlop},t.TYPE="prismatic-joint",t}(yt),gn={ratio:1},ks=function(i){dt(t,i);function t(e,r,s,o,n,h){var m=this;if(!(m instanceof t))return new t(e,r,s,o,n,h);e=Ft(e,gn),m=i.call(this,e,r,s)||this,r=m.m_bodyA,s=m.m_bodyB,m.m_type=t.TYPE,m.m_joint1=o||e.joint1,m.m_joint2=n||e.joint2,m.m_ratio=Number.isFinite(h)?h:e.ratio,m.m_type1=m.m_joint1.getType(),m.m_type2=m.m_joint2.getType();var u,l;m.m_bodyC=m.m_joint1.getBodyA(),m.m_bodyA=m.m_joint1.getBodyB();var p=m.m_bodyA.m_xf,_=m.m_bodyA.m_sweep.a,c=m.m_bodyC.m_xf,y=m.m_bodyC.m_sweep.a;if(m.m_type1===Be.TYPE){var v=m.m_joint1;m.m_localAnchorC=v.m_localAnchorA,m.m_localAnchorA=v.m_localAnchorB,m.m_referenceAngleA=v.m_referenceAngle,m.m_localAxisC=a.zero(),u=_-y-m.m_referenceAngleA}else{var f=m.m_joint1;m.m_localAnchorC=f.m_localAnchorA,m.m_localAnchorA=f.m_localAnchorB,m.m_referenceAngleA=f.m_referenceAngle,m.m_localAxisC=f.m_localXAxisA;var d=m.m_localAnchorC,A=B.mulTVec2(c.q,a.add(B.mulVec2(p.q,m.m_localAnchorA),a.sub(p.p,c.p)));u=a.dot(A,m.m_localAxisC)-a.dot(d,m.m_localAxisC)}m.m_bodyD=m.m_joint2.getBodyA(),m.m_bodyB=m.m_joint2.getBodyB();var b=m.m_bodyB.m_xf,w=m.m_bodyB.m_sweep.a,V=m.m_bodyD.m_xf,I=m.m_bodyD.m_sweep.a;if(m.m_type2===Be.TYPE){var v=m.m_joint2;m.m_localAnchorD=v.m_localAnchorA,m.m_localAnchorB=v.m_localAnchorB,m.m_referenceAngleB=v.m_referenceAngle,m.m_localAxisD=a.zero(),l=w-I-m.m_referenceAngleB}else{var f=m.m_joint2;m.m_localAnchorD=f.m_localAnchorA,m.m_localAnchorB=f.m_localAnchorB,m.m_referenceAngleB=f.m_referenceAngle,m.m_localAxisD=f.m_localXAxisA;var M=m.m_localAnchorD,P=B.mulTVec2(V.q,a.add(B.mulVec2(b.q,m.m_localAnchorB),a.sub(b.p,V.p)));l=a.dot(P,m.m_localAxisD)-a.dot(M,m.m_localAxisD)}return m.m_constant=u+m.m_ratio*l,m.m_impulse=0,m}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r),e.joint1=s(yt,e.joint1,r),e.joint2=s(yt,e.joint2,r);var o=new t(e);return o},t.prototype._reset=function(e){Number.isFinite(e.ratio)&&(this.m_ratio=e.ratio)},t.prototype.getJoint1=function(){return this.m_joint1},t.prototype.getJoint2=function(){return this.m_joint2},t.prototype.setRatio=function(e){this.m_ratio=e},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.mulNumVec2(this.m_impulse,this.m_JvAC).mul(e)},t.prototype.getReactionTorque=function(e){var r=this.m_impulse*this.m_JwA;return e*r},t.prototype.initVelocityConstraints=function(e){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var r=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,u=this.m_bodyC.c_position.a,l=this.m_bodyC.c_velocity.v,p=this.m_bodyC.c_velocity.w,_=this.m_bodyD.c_position.a,c=this.m_bodyD.c_velocity.v,y=this.m_bodyD.c_velocity.w,v=B.neo(r),f=B.neo(n),d=B.neo(u),A=B.neo(_);if(this.m_mass=0,this.m_type1==Be.TYPE)this.m_JvAC=a.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var b=B.mulVec2(d,this.m_localAxisC),w=B.mulSub(d,this.m_localAnchorC,this.m_lcC),V=B.mulSub(v,this.m_localAnchorA,this.m_lcA);this.m_JvAC=b,this.m_JwC=a.crossVec2Vec2(w,b),this.m_JwA=a.crossVec2Vec2(V,b),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==Be.TYPE)this.m_JvBD=a.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var b=B.mulVec2(A,this.m_localAxisD),I=B.mulSub(A,this.m_localAnchorD,this.m_lcD),M=B.mulSub(f,this.m_localAnchorB,this.m_lcB);this.m_JvBD=a.mulNumVec2(this.m_ratio,b),this.m_JwD=this.m_ratio*a.crossVec2Vec2(I,b),this.m_JwB=this.m_ratio*a.crossVec2Vec2(M,b),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.warmStarting?(s.addMul(this.m_mA*this.m_impulse,this.m_JvAC),o+=this.m_iA*this.m_impulse*this.m_JwA,h.addMul(this.m_mB*this.m_impulse,this.m_JvBD),m+=this.m_iB*this.m_impulse*this.m_JwB,l.subMul(this.m_mC*this.m_impulse,this.m_JvAC),p-=this.m_iC*this.m_impulse*this.m_JwC,c.subMul(this.m_mD*this.m_impulse,this.m_JvBD),y-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(h),this.m_bodyB.c_velocity.w=m,this.m_bodyC.c_velocity.v.setVec2(l),this.m_bodyC.c_velocity.w=p,this.m_bodyD.c_velocity.v.setVec2(c),this.m_bodyD.c_velocity.w=y},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,h=this.m_bodyC.c_velocity.v,m=this.m_bodyC.c_velocity.w,u=this.m_bodyD.c_velocity.v,l=this.m_bodyD.c_velocity.w,p=a.dot(this.m_JvAC,r)-a.dot(this.m_JvAC,h)+a.dot(this.m_JvBD,o)-a.dot(this.m_JvBD,u);p+=this.m_JwA*s-this.m_JwC*m+(this.m_JwB*n-this.m_JwD*l);var _=-this.m_mass*p;this.m_impulse+=_,r.addMul(this.m_mA*_,this.m_JvAC),s+=this.m_iA*_*this.m_JwA,o.addMul(this.m_mB*_,this.m_JvBD),n+=this.m_iB*_*this.m_JwB,h.subMul(this.m_mC*_,this.m_JvAC),m-=this.m_iC*_*this.m_JwC,u.subMul(this.m_mD*_,this.m_JvBD),l-=this.m_iD*_*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(r),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(o),this.m_bodyB.c_velocity.w=n,this.m_bodyC.c_velocity.v.setVec2(h),this.m_bodyC.c_velocity.w=m,this.m_bodyD.c_velocity.v.setVec2(u),this.m_bodyD.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,h=this.m_bodyC.c_position.c,m=this.m_bodyC.c_position.a,u=this.m_bodyD.c_position.c,l=this.m_bodyD.c_position.a,p=B.neo(s),_=B.neo(n),c=B.neo(m),y=B.neo(l),v=0,f,d,A,b,w,V,I,M,P=0;if(this.m_type1==Be.TYPE)A=a.zero(),w=1,I=1,P+=this.m_iA+this.m_iC,f=s-m-this.m_referenceAngleA;else{var R=B.mulVec2(c,this.m_localAxisC),E=B.mulSub(c,this.m_localAnchorC,this.m_lcC),O=B.mulSub(p,this.m_localAnchorA,this.m_lcA);A=R,I=a.crossVec2Vec2(E,R),w=a.crossVec2Vec2(O,R),P+=this.m_mC+this.m_mA+this.m_iC*I*I+this.m_iA*w*w;var Y=a.sub(this.m_localAnchorC,this.m_lcC),U=B.mulTVec2(c,a.add(O,a.sub(r,h)));f=a.dot(a.sub(U,Y),this.m_localAxisC)}if(this.m_type2==Be.TYPE)b=a.zero(),V=this.m_ratio,M=this.m_ratio,P+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),d=n-l-this.m_referenceAngleB;else{var R=B.mulVec2(y,this.m_localAxisD),j=B.mulSub(y,this.m_localAnchorD,this.m_lcD),Ct=B.mulSub(_,this.m_localAnchorB,this.m_lcB);b=a.mulNumVec2(this.m_ratio,R),M=this.m_ratio*a.crossVec2Vec2(j,R),V=this.m_ratio*a.crossVec2Vec2(Ct,R),P+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*M*M+this.m_iB*V*V;var lt=a.sub(this.m_localAnchorD,this.m_lcD),Jt=B.mulTVec2(y,a.add(Ct,a.sub(o,u)));d=a.dot(Jt,this.m_localAxisD)-a.dot(lt,this.m_localAxisD)}var At=f+this.m_ratio*d-this.m_constant,tt=0;return P>0&&(tt=-At/P),r.addMul(this.m_mA*tt,A),s+=this.m_iA*tt*w,o.addMul(this.m_mB*tt,b),n+=this.m_iB*tt*V,h.subMul(this.m_mC*tt,A),m-=this.m_iC*tt*I,u.subMul(this.m_mD*tt,b),l-=this.m_iD*tt*M,this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=n,this.m_bodyC.c_position.c.setVec2(h),this.m_bodyC.c_position.a=m,this.m_bodyD.c_position.c.setVec2(u),this.m_bodyD.c_position.a=l,v<S.linearSlop},t.TYPE="gear-joint",t}(yt),Bn={maxForce:1,maxTorque:1,correctionFactor:.3},Ns=function(i){dt(t,i);function t(e,r,s){var o=this;return o instanceof t?(e=Ft(e,Bn),o=i.call(this,e,r,s)||this,r=o.m_bodyA,s=o.m_bodyB,o.m_type=t.TYPE,o.m_linearOffset=a.isValid(e.linearOffset)?a.clone(e.linearOffset):r.getLocalPoint(s.getPosition()),o.m_angularOffset=Number.isFinite(e.angularOffset)?e.angularOffset:s.getAngle()-r.getAngle(),o.m_linearImpulse=a.zero(),o.m_angularImpulse=0,o.m_maxForce=e.maxForce,o.m_maxTorque=e.maxTorque,o.m_correctionFactor=e.correctionFactor,o):new t(e,r,s)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r);var o=new t(e);return o},t.prototype._reset=function(e){Number.isFinite(e.angularOffset)&&(this.m_angularOffset=e.angularOffset),Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.maxTorque)&&(this.m_maxTorque=e.maxTorque),Number.isFinite(e.correctionFactor)&&(this.m_correctionFactor=e.correctionFactor),a.isValid(e.linearOffset)&&this.m_linearOffset.set(e.linearOffset)},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setMaxTorque=function(e){this.m_maxTorque=e},t.prototype.getMaxTorque=function(){return this.m_maxTorque},t.prototype.setCorrectionFactor=function(e){this.m_correctionFactor=e},t.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},t.prototype.setLinearOffset=function(e){(e.x!=this.m_linearOffset.x||e.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset.set(e))},t.prototype.getLinearOffset=function(){return this.m_linearOffset},t.prototype.setAngularOffset=function(e){e!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=e)},t.prototype.getAngularOffset=function(){return this.m_angularOffset},t.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},t.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},t.prototype.getReactionForce=function(e){return a.mulNumVec2(e,this.m_linearImpulse)},t.prototype.getReactionTorque=function(e){return e*this.m_angularImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,u=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,p=B.neo(s),_=B.neo(m);this.m_rA=B.mulVec2(p,a.sub(this.m_linearOffset,this.m_localCenterA)),this.m_rB=B.mulVec2(_,a.neg(this.m_localCenterB));var c=this.m_invMassA,y=this.m_invMassB,v=this.m_invIA,f=this.m_invIB,d=new Kt;if(d.ex.x=c+y+v*this.m_rA.y*this.m_rA.y+f*this.m_rB.y*this.m_rB.y,d.ex.y=-v*this.m_rA.x*this.m_rA.y-f*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=c+y+v*this.m_rA.x*this.m_rA.x+f*this.m_rB.x*this.m_rB.x,this.m_linearMass=d.getInverse(),this.m_angularMass=v+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=a.zero(),this.m_linearError.addCombine(1,h,1,this.m_rB),this.m_linearError.subCombine(1,r,1,this.m_rA),this.m_angularError=m-s-this.m_angularOffset,e.warmStarting){this.m_linearImpulse.mul(e.dtRatio),this.m_angularImpulse*=e.dtRatio;var A=a.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);o.subMul(c,A),n-=v*(a.crossVec2Vec2(this.m_rA,A)+this.m_angularImpulse),u.addMul(y,A),l+=f*(a.crossVec2Vec2(this.m_rB,A)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=u,this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,h=this.m_invMassA,m=this.m_invMassB,u=this.m_invIA,l=this.m_invIB,p=e.dt,_=e.inv_dt;{var c=n-s+_*this.m_correctionFactor*this.m_angularError,y=-this.m_angularMass*c,v=this.m_angularImpulse,f=p*this.m_maxTorque;this.m_angularImpulse=pt(this.m_angularImpulse+y,-f,f),y=this.m_angularImpulse-v,s-=u*y,n+=l*y}{var c=a.zero();c.addCombine(1,o,1,a.crossNumVec2(n,this.m_rB)),c.subCombine(1,r,1,a.crossNumVec2(s,this.m_rA)),c.addMul(_*this.m_correctionFactor,this.m_linearError);var y=a.neg(Kt.mulVec2(this.m_linearMass,c)),v=a.clone(this.m_linearImpulse);this.m_linearImpulse.add(y);var f=p*this.m_maxForce;this.m_linearImpulse.clamp(f),y=a.sub(this.m_linearImpulse,v),r.subMul(h,y),s-=u*a.crossVec2Vec2(this.m_rA,y),o.addMul(m,y),n+=l*a.crossVec2Vec2(this.m_rB,y)}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="motor-joint",t}(yt),bn=Math.PI,wn={maxForce:0,frequencyHz:5,dampingRatio:.7},Ds=function(i){dt(t,i);function t(e,r,s,o){var n=this;return n instanceof t?(e=Ft(e,wn),n=i.call(this,e,r,s)||this,r=n.m_bodyA,s=n.m_bodyB,n.m_type=t.TYPE,a.isValid(o)?n.m_targetA=a.clone(o):a.isValid(e.target)?n.m_targetA=a.clone(e.target):n.m_targetA=a.zero(),n.m_localAnchorB=Xt.mulTVec2(s.getTransform(),n.m_targetA),n.m_maxForce=e.maxForce,n.m_impulse=a.zero(),n.m_frequencyHz=e.frequencyHz,n.m_dampingRatio=e.dampingRatio,n.m_beta=0,n.m_gamma=0,n.m_rB=a.zero(),n.m_localCenterB=a.zero(),n.m_invMassB=0,n.m_invIB=0,n.m_mass=new Kt,n.m_C=a.zero(),n):new t(e,r,s,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r),e.target=a.clone(e.target);var o=new t(e);return e._localAnchorB&&(o.m_localAnchorB=e._localAnchorB),o},t.prototype._reset=function(e){Number.isFinite(e.maxForce)&&(this.m_maxForce=e.maxForce),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.setTarget=function(e){a.areEqual(e,this.m_targetA)||(this.m_bodyB.setAwake(!0),this.m_targetA.set(e))},t.prototype.getTarget=function(){return this.m_targetA},t.prototype.setMaxForce=function(e){this.m_maxForce=e},t.prototype.getMaxForce=function(){return this.m_maxForce},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return a.clone(this.m_targetA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.mulNumVec2(e,this.m_impulse)},t.prototype.getReactionTorque=function(e){return e*0},t.prototype.shiftOrigin=function(e){this.m_targetA.sub(e)},t.prototype.initVelocityConstraints=function(e){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyB.c_position,s=this.m_bodyB.c_velocity,o=r.c,n=r.a,h=s.v,m=s.w,u=B.neo(n),l=this.m_bodyB.getMass(),p=2*bn*this.m_frequencyHz,_=2*l*this.m_dampingRatio*p,c=l*(p*p),y=e.dt;this.m_gamma=y*(_+y*c),this.m_gamma!=0&&(this.m_gamma=1/this.m_gamma),this.m_beta=y*c*this.m_gamma,this.m_rB=B.mulVec2(u,a.sub(this.m_localAnchorB,this.m_localCenterB));var v=new Kt;v.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,v.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=v.getInverse(),this.m_C.setVec2(o),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),m*=.98,e.warmStarting?(this.m_impulse.mul(e.dtRatio),h.addMul(this.m_invMassB,this.m_impulse),m+=this.m_invIB*a.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),s.v.setVec2(h),s.w=m},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyB.c_velocity,s=a.clone(r.v),o=r.w,n=a.crossNumVec2(o,this.m_rB);n.add(s),n.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),n.neg();var h=Kt.mulVec2(this.m_mass,n),m=a.clone(this.m_impulse);this.m_impulse.add(h);var u=e.dt*this.m_maxForce;this.m_impulse.clamp(u),h=a.sub(this.m_impulse,m),s.addMul(this.m_invMassB,h),o+=this.m_invIB*a.crossVec2Vec2(this.m_rB,h),r.v.setVec2(s),r.w=o},t.prototype.solvePositionConstraints=function(e){return!0},t.TYPE="mouse-joint",t}(yt),Vn=Math.abs,Cn={collideConnected:!0},Rs=function(i){dt(t,i);function t(e,r,s,o,n,h,m,u){var l=this;return l instanceof t?(e=Ft(e,Cn),l=i.call(this,e,r,s)||this,r=l.m_bodyA,s=l.m_bodyB,l.m_type=t.TYPE,l.m_groundAnchorA=a.clone(o||e.groundAnchorA||a.neo(-1,1)),l.m_groundAnchorB=a.clone(n||e.groundAnchorB||a.neo(1,1)),l.m_localAnchorA=a.clone(h?r.getLocalPoint(h):e.localAnchorA||a.neo(-1,0)),l.m_localAnchorB=a.clone(m?s.getLocalPoint(m):e.localAnchorB||a.neo(1,0)),l.m_lengthA=Number.isFinite(e.lengthA)?e.lengthA:a.distance(h,o),l.m_lengthB=Number.isFinite(e.lengthB)?e.lengthB:a.distance(m,n),l.m_ratio=Number.isFinite(u)?u:e.ratio,l.m_constant=l.m_lengthA+l.m_ratio*l.m_lengthB,l.m_impulse=0,l):new t(e,r,s,o,n,h,m,u)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r);var o=new t(e);return o},t.prototype._reset=function(e){a.isValid(e.groundAnchorA)&&this.m_groundAnchorA.set(e.groundAnchorA),a.isValid(e.groundAnchorB)&&this.m_groundAnchorB.set(e.groundAnchorB),a.isValid(e.localAnchorA)?this.m_localAnchorA.set(e.localAnchorA):a.isValid(e.anchorA)&&this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(e.anchorA)),a.isValid(e.localAnchorB)?this.m_localAnchorB.set(e.localAnchorB):a.isValid(e.anchorB)&&this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(e.anchorB)),Number.isFinite(e.lengthA)&&(this.m_lengthA=e.lengthA),Number.isFinite(e.lengthB)&&(this.m_lengthB=e.lengthB),Number.isFinite(e.ratio)&&(this.m_ratio=e.ratio)},t.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},t.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},t.prototype.getLengthA=function(){return this.m_lengthA},t.prototype.getLengthB=function(){return this.m_lengthB},t.prototype.getRatio=function(){return this.m_ratio},t.prototype.getCurrentLengthA=function(){var e=this.m_bodyA.getWorldPoint(this.m_localAnchorA),r=this.m_groundAnchorA;return a.distance(e,r)},t.prototype.getCurrentLengthB=function(){var e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),r=this.m_groundAnchorB;return a.distance(e,r)},t.prototype.shiftOrigin=function(e){this.m_groundAnchorA.sub(e),this.m_groundAnchorB.sub(e)},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.mulNumVec2(this.m_impulse,this.m_uB).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,u=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,p=B.neo(s),_=B.neo(m);this.m_rA=B.mulVec2(p,a.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=B.mulVec2(_,a.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=a.sub(a.add(r,this.m_rA),this.m_groundAnchorA),this.m_uB=a.sub(a.add(h,this.m_rB),this.m_groundAnchorB);var c=this.m_uA.length(),y=this.m_uB.length();c>10*S.linearSlop?this.m_uA.mul(1/c):this.m_uA.setZero(),y>10*S.linearSlop?this.m_uB.mul(1/y):this.m_uB.setZero();var v=a.crossVec2Vec2(this.m_rA,this.m_uA),f=a.crossVec2Vec2(this.m_rB,this.m_uB),d=this.m_invMassA+this.m_invIA*v*v,A=this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=d+this.m_ratio*this.m_ratio*A,this.m_mass>0&&(this.m_mass=1/this.m_mass),e.warmStarting){this.m_impulse*=e.dtRatio;var b=a.mulNumVec2(-this.m_impulse,this.m_uA),w=a.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);o.addMul(this.m_invMassA,b),n+=this.m_invIA*a.crossVec2Vec2(this.m_rA,b),u.addMul(this.m_invMassB,w),l+=this.m_invIB*a.crossVec2Vec2(this.m_rB,w)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=o,this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v=u,this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,h=a.add(r,a.crossNumVec2(s,this.m_rA)),m=a.add(o,a.crossNumVec2(n,this.m_rB)),u=-a.dot(this.m_uA,h)-this.m_ratio*a.dot(this.m_uB,m),l=-this.m_mass*u;this.m_impulse+=l;var p=a.mulNumVec2(-l,this.m_uA),_=a.mulNumVec2(-this.m_ratio*l,this.m_uB);r.addMul(this.m_invMassA,p),s+=this.m_invIA*a.crossVec2Vec2(this.m_rA,p),o.addMul(this.m_invMassB,_),n+=this.m_invIB*a.crossVec2Vec2(this.m_rB,_),this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,h=B.neo(s),m=B.neo(n),u=B.mulVec2(h,a.sub(this.m_localAnchorA,this.m_localCenterA)),l=B.mulVec2(m,a.sub(this.m_localAnchorB,this.m_localCenterB)),p=a.sub(a.add(r,this.m_rA),this.m_groundAnchorA),_=a.sub(a.add(o,this.m_rB),this.m_groundAnchorB),c=p.length(),y=_.length();c>10*S.linearSlop?p.mul(1/c):p.setZero(),y>10*S.linearSlop?_.mul(1/y):_.setZero();var v=a.crossVec2Vec2(u,p),f=a.crossVec2Vec2(l,_),d=this.m_invMassA+this.m_invIA*v*v,A=this.m_invMassB+this.m_invIB*f*f,b=d+this.m_ratio*this.m_ratio*A;b>0&&(b=1/b);var w=this.m_constant-c-this.m_ratio*y,V=Vn(w),I=-b*w,M=a.mulNumVec2(-I,p),P=a.mulNumVec2(-this.m_ratio*I,_);return r.addMul(this.m_invMassA,M),s+=this.m_invIA*a.crossVec2Vec2(u,M),o.addMul(this.m_invMassB,P),n+=this.m_invIB*a.crossVec2Vec2(l,P),this.m_bodyA.c_position.c=r,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=n,V<S.linearSlop},t.TYPE="pulley-joint",t}(yt),Mn=Math.min,Pi;(function(i){i[i.inactiveLimit=0]="inactiveLimit",i[i.atLowerLimit=1]="atLowerLimit",i[i.atUpperLimit=2]="atUpperLimit",i[i.equalLimits=3]="equalLimits"})(Pi||(Pi={}));var In={maxLength:0},Es=function(i){dt(t,i);function t(e,r,s,o){var n=this;return n instanceof t?(e=Ft(e,In),n=i.call(this,e,r,s)||this,r=n.m_bodyA,s=n.m_bodyB,n.m_type=t.TYPE,n.m_localAnchorA=a.clone(o?r.getLocalPoint(o):e.localAnchorA||a.neo(-1,0)),n.m_localAnchorB=a.clone(o?s.getLocalPoint(o):e.localAnchorB||a.neo(1,0)),n.m_maxLength=e.maxLength,n.m_mass=0,n.m_impulse=0,n.m_length=0,n.m_state=Pi.inactiveLimit,n):new t(e,r,s,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r);var o=new t(e);return o},t.prototype._reset=function(e){Number.isFinite(e.maxLength)&&(this.m_maxLength=e.maxLength)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.setMaxLength=function(e){this.m_maxLength=e},t.prototype.getMaxLength=function(){return this.m_maxLength},t.prototype.getLimitState=function(){return this.m_state},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.mulNumVec2(this.m_impulse,this.m_u).mul(e)},t.prototype.getReactionTorque=function(e){return 0},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,u=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,p=B.neo(s),_=B.neo(m);this.m_rA=B.mulSub(p,this.m_localAnchorA,this.m_localCenterA),this.m_rB=B.mulSub(_,this.m_localAnchorB,this.m_localCenterB),this.m_u=a.zero(),this.m_u.addCombine(1,h,1,this.m_rB),this.m_u.subCombine(1,r,1,this.m_rA),this.m_length=this.m_u.length();var c=this.m_length-this.m_maxLength;if(c>0?this.m_state=Pi.atUpperLimit:this.m_state=Pi.inactiveLimit,this.m_length>S.linearSlop)this.m_u.mul(1/this.m_length);else{this.m_u.setZero(),this.m_mass=0,this.m_impulse=0;return}var y=a.crossVec2Vec2(this.m_rA,this.m_u),v=a.crossVec2Vec2(this.m_rB,this.m_u),f=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*v*v;if(this.m_mass=f!=0?1/f:0,e.warmStarting){this.m_impulse*=e.dtRatio;var d=a.mulNumVec2(this.m_impulse,this.m_u);o.subMul(this.m_invMassA,d),n-=this.m_invIA*a.crossVec2Vec2(this.m_rA,d),u.addMul(this.m_invMassB,d),l+=this.m_invIB*a.crossVec2Vec2(this.m_rB,d)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(o),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.setVec2(u),this.m_bodyB.c_velocity.w=l},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,h=a.addCrossNumVec2(r,s,this.m_rA),m=a.addCrossNumVec2(o,n,this.m_rB),u=this.m_length-this.m_maxLength,l=a.dot(this.m_u,a.sub(m,h));u<0&&(l+=e.inv_dt*u);var p=-this.m_mass*l,_=this.m_impulse;this.m_impulse=Mn(0,this.m_impulse+p),p=this.m_impulse-_;var c=a.mulNumVec2(p,this.m_u);r.subMul(this.m_invMassA,c),s-=this.m_invIA*a.crossVec2Vec2(this.m_rA,c),o.addMul(this.m_invMassB,c),n+=this.m_invIB*a.crossVec2Vec2(this.m_rB,c),this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,h=B.neo(s),m=B.neo(n),u=B.mulSub(h,this.m_localAnchorA,this.m_localCenterA),l=B.mulSub(m,this.m_localAnchorB,this.m_localCenterB),p=a.zero();p.addCombine(1,o,1,l),p.subCombine(1,r,1,u);var _=p.normalize(),c=_-this.m_maxLength;c=pt(c,0,S.maxLinearCorrection);var y=-this.m_mass*c,v=a.mulNumVec2(y,p);return r.subMul(this.m_invMassA,v),s-=this.m_invIA*a.crossVec2Vec2(u,v),o.addMul(this.m_invMassB,v),n+=this.m_invIB*a.crossVec2Vec2(l,v),this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=n,_-this.m_maxLength<S.linearSlop},t.TYPE="rope-joint",t}(yt),Pn=Math.abs,Sn=Math.PI,zn={frequencyHz:0,dampingRatio:0},Os=function(i){dt(t,i);function t(e,r,s,o){var n=this;return n instanceof t?(e=Ft(e,zn),n=i.call(this,e,r,s)||this,r=n.m_bodyA,s=n.m_bodyB,n.m_type=t.TYPE,n.m_localAnchorA=a.clone(o?r.getLocalPoint(o):e.localAnchorA||a.zero()),n.m_localAnchorB=a.clone(o?s.getLocalPoint(o):e.localAnchorB||a.zero()),n.m_referenceAngle=Number.isFinite(e.referenceAngle)?e.referenceAngle:s.getAngle()-r.getAngle(),n.m_frequencyHz=e.frequencyHz,n.m_dampingRatio=e.dampingRatio,n.m_impulse=new $,n.m_bias=0,n.m_gamma=0,n.m_mass=new be,n):new t(e,r,s,o)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r);var o=new t(e);return o},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getReferenceAngle=function(){return this.m_referenceAngle},t.prototype.setFrequency=function(e){this.m_frequencyHz=e},t.prototype.getFrequency=function(){return this.m_frequencyHz},t.prototype.setDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.neo(this.m_impulse.x,this.m_impulse.y).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_impulse.z},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,u=B.neo(r),l=B.neo(n);this.m_rA=B.mulVec2(u,a.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=B.mulVec2(l,a.sub(this.m_localAnchorB,this.m_localCenterB));var p=this.m_invMassA,_=this.m_invMassB,c=this.m_invIA,y=this.m_invIB,v=new be;if(v.ex.x=p+_+this.m_rA.y*this.m_rA.y*c+this.m_rB.y*this.m_rB.y*y,v.ey.x=-this.m_rA.y*this.m_rA.x*c-this.m_rB.y*this.m_rB.x*y,v.ez.x=-this.m_rA.y*c-this.m_rB.y*y,v.ex.y=v.ey.x,v.ey.y=p+_+this.m_rA.x*this.m_rA.x*c+this.m_rB.x*this.m_rB.x*y,v.ez.y=this.m_rA.x*c+this.m_rB.x*y,v.ex.z=v.ez.x,v.ey.z=v.ez.y,v.ez.z=c+y,this.m_frequencyHz>0){v.getInverse22(this.m_mass);var f=c+y,d=f>0?1/f:0,A=n-r-this.m_referenceAngle,b=2*Sn*this.m_frequencyHz,w=2*d*this.m_dampingRatio*b,V=d*b*b,I=e.dt;this.m_gamma=I*(w+I*V),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=A*I*V*this.m_gamma,f+=this.m_gamma,this.m_mass.ez.z=f!=0?1/f:0}else v.ez.z==0?(v.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(v.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(e.warmStarting){this.m_impulse.mul(e.dtRatio);var M=a.neo(this.m_impulse.x,this.m_impulse.y);s.subMul(p,M),o-=c*(a.crossVec2Vec2(this.m_rA,M)+this.m_impulse.z),h.addMul(_,M),m+=y*(a.crossVec2Vec2(this.m_rB,M)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=m},t.prototype.solveVelocityConstraints=function(e){var r=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_velocity.v,n=this.m_bodyB.c_velocity.w,h=this.m_invMassA,m=this.m_invMassB,u=this.m_invIA,l=this.m_invIB;if(this.m_frequencyHz>0){var p=n-s,_=-this.m_mass.ez.z*(p+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=_,s-=u*_,n+=l*_;var c=a.zero();c.addCombine(1,o,1,a.crossNumVec2(n,this.m_rB)),c.subCombine(1,r,1,a.crossNumVec2(s,this.m_rA));var y=a.neg(be.mulVec2(this.m_mass,c));this.m_impulse.x+=y.x,this.m_impulse.y+=y.y;var v=a.clone(y);r.subMul(h,v),s-=u*a.crossVec2Vec2(this.m_rA,v),o.addMul(m,v),n+=l*a.crossVec2Vec2(this.m_rB,v)}else{var c=a.zero();c.addCombine(1,o,1,a.crossNumVec2(n,this.m_rB)),c.subCombine(1,r,1,a.crossNumVec2(s,this.m_rA));var p=n-s,f=new $(c.x,c.y,p),d=$.neg(be.mulVec3(this.m_mass,f));this.m_impulse.add(d);var v=a.neo(d.x,d.y);r.subMul(h,v),s-=u*(a.crossVec2Vec2(this.m_rA,v)+d.z),o.addMul(m,v),n+=l*(a.crossVec2Vec2(this.m_rB,v)+d.z)}this.m_bodyA.c_velocity.v=r,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=o,this.m_bodyB.c_velocity.w=n},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,h=B.neo(s),m=B.neo(n),u=this.m_invMassA,l=this.m_invMassB,p=this.m_invIA,_=this.m_invIB,c=B.mulVec2(h,a.sub(this.m_localAnchorA,this.m_localCenterA)),y=B.mulVec2(m,a.sub(this.m_localAnchorB,this.m_localCenterB)),v,f,d=new be;if(d.ex.x=u+l+c.y*c.y*p+y.y*y.y*_,d.ey.x=-c.y*c.x*p-y.y*y.x*_,d.ez.x=-c.y*p-y.y*_,d.ex.y=d.ey.x,d.ey.y=u+l+c.x*c.x*p+y.x*y.x*_,d.ez.y=c.x*p+y.x*_,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=p+_,this.m_frequencyHz>0){var A=a.zero();A.addCombine(1,o,1,y),A.subCombine(1,r,1,c),v=A.length(),f=0;var b=a.neg(d.solve22(A));r.subMul(u,b),s-=p*a.crossVec2Vec2(c,b),o.addMul(l,b),n+=_*a.crossVec2Vec2(y,b)}else{var A=a.zero();A.addCombine(1,o,1,y),A.subCombine(1,r,1,c);var w=n-s-this.m_referenceAngle;v=A.length(),f=Pn(w);var V=new $(A.x,A.y,w),I=new $;if(d.ez.z>0)I=$.neg(d.solve33(V));else{var M=a.neg(d.solve22(A));I.set(M.x,M.y,0)}var b=a.neo(I.x,I.y);r.subMul(u,b),s-=p*(a.crossVec2Vec2(c,b)+I.z),o.addMul(l,b),n+=_*(a.crossVec2Vec2(y,b)+I.z)}return this.m_bodyA.c_position.c=r,this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c=o,this.m_bodyB.c_position.a=n,v<=S.linearSlop&&f<=S.angularSlop},t.TYPE="weld-joint",t}(yt),Fn=Math.abs,Ln=Math.PI,Tn={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},Js=function(i){dt(t,i);function t(e,r,s,o,n){var h=this;return h instanceof t?(e=Ft(e,Tn),h=i.call(this,e,r,s)||this,r=h.m_bodyA,s=h.m_bodyB,h.m_ax=a.zero(),h.m_ay=a.zero(),h.m_type=t.TYPE,h.m_localAnchorA=a.clone(o?r.getLocalPoint(o):e.localAnchorA||a.zero()),h.m_localAnchorB=a.clone(o?s.getLocalPoint(o):e.localAnchorB||a.zero()),a.isValid(n)?h.m_localXAxisA=r.getLocalVector(n):a.isValid(e.localAxisA)?h.m_localXAxisA=a.clone(e.localAxisA):a.isValid(e.localAxis)?h.m_localXAxisA=a.clone(e.localAxis):h.m_localXAxisA=a.neo(1,0),h.m_localYAxisA=a.crossNumVec2(1,h.m_localXAxisA),h.m_mass=0,h.m_impulse=0,h.m_motorMass=0,h.m_motorImpulse=0,h.m_springMass=0,h.m_springImpulse=0,h.m_maxMotorTorque=e.maxMotorTorque,h.m_motorSpeed=e.motorSpeed,h.m_enableMotor=e.enableMotor,h.m_frequencyHz=e.frequencyHz,h.m_dampingRatio=e.dampingRatio,h.m_bias=0,h.m_gamma=0,h):new t(e,r,s,o,n)}return t.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},t._deserialize=function(e,r,s){e=ft({},e),e.bodyA=s(W,e.bodyA,r),e.bodyB=s(W,e.bodyB,r);var o=new t(e);return o},t.prototype._reset=function(e){e.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(e.anchorA)):e.localAnchorA&&this.m_localAnchorA.setVec2(e.localAnchorA),e.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(e.anchorB)):e.localAnchorB&&this.m_localAnchorB.setVec2(e.localAnchorB),e.localAxisA&&(this.m_localXAxisA.setVec2(e.localAxisA),this.m_localYAxisA.setVec2(a.crossNumVec2(1,e.localAxisA))),e.enableMotor!==void 0&&(this.m_enableMotor=e.enableMotor),Number.isFinite(e.maxMotorTorque)&&(this.m_maxMotorTorque=e.maxMotorTorque),Number.isFinite(e.motorSpeed)&&(this.m_motorSpeed=e.motorSpeed),Number.isFinite(e.frequencyHz)&&(this.m_frequencyHz=e.frequencyHz),Number.isFinite(e.dampingRatio)&&(this.m_dampingRatio=e.dampingRatio)},t.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},t.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},t.prototype.getLocalAxisA=function(){return this.m_localXAxisA},t.prototype.getJointTranslation=function(){var e=this.m_bodyA,r=this.m_bodyB,s=e.getWorldPoint(this.m_localAnchorA),o=r.getWorldPoint(this.m_localAnchorB),n=a.sub(o,s),h=e.getWorldVector(this.m_localXAxisA),m=a.dot(n,h);return m},t.prototype.getJointSpeed=function(){var e=this.m_bodyA.m_angularVelocity,r=this.m_bodyB.m_angularVelocity;return r-e},t.prototype.isMotorEnabled=function(){return this.m_enableMotor},t.prototype.enableMotor=function(e){e!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=e)},t.prototype.setMotorSpeed=function(e){e!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=e)},t.prototype.getMotorSpeed=function(){return this.m_motorSpeed},t.prototype.setMaxMotorTorque=function(e){e!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=e)},t.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},t.prototype.getMotorTorque=function(e){return e*this.m_motorImpulse},t.prototype.setSpringFrequencyHz=function(e){this.m_frequencyHz=e},t.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},t.prototype.setSpringDampingRatio=function(e){this.m_dampingRatio=e},t.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},t.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},t.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},t.prototype.getReactionForce=function(e){return a.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(e)},t.prototype.getReactionTorque=function(e){return e*this.m_motorImpulse},t.prototype.initVelocityConstraints=function(e){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var r=this.m_invMassA,s=this.m_invMassB,o=this.m_invIA,n=this.m_invIB,h=this.m_bodyA.c_position.c,m=this.m_bodyA.c_position.a,u=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,p=this.m_bodyB.c_position.c,_=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,y=this.m_bodyB.c_velocity.w,v=B.neo(m),f=B.neo(_),d=B.mulVec2(v,a.sub(this.m_localAnchorA,this.m_localCenterA)),A=B.mulVec2(f,a.sub(this.m_localAnchorB,this.m_localCenterB)),b=a.zero();if(b.addCombine(1,p,1,A),b.subCombine(1,h,1,d),this.m_ay=B.mulVec2(v,this.m_localYAxisA),this.m_sAy=a.crossVec2Vec2(a.add(b,d),this.m_ay),this.m_sBy=a.crossVec2Vec2(A,this.m_ay),this.m_mass=r+s+o*this.m_sAy*this.m_sAy+n*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=B.mulVec2(v,this.m_localXAxisA),this.m_sAx=a.crossVec2Vec2(a.add(b,d),this.m_ax),this.m_sBx=a.crossVec2Vec2(A,this.m_ax);var w=r+s+o*this.m_sAx*this.m_sAx+n*this.m_sBx*this.m_sBx;if(w>0){this.m_springMass=1/w;var V=a.dot(b,this.m_ax),I=2*Ln*this.m_frequencyHz,M=2*this.m_springMass*this.m_dampingRatio*I,P=this.m_springMass*I*I,R=e.dt;this.m_gamma=R*(M+R*P),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=V*R*P*this.m_gamma,this.m_springMass=w+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=o+n,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),e.warmStarting){this.m_impulse*=e.dtRatio,this.m_springImpulse*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var E=a.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),O=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,Y=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;u.subMul(this.m_invMassA,E),l-=this.m_invIA*O,c.addMul(this.m_invMassB,E),y+=this.m_invIB*Y}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(u),this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v.setVec2(c),this.m_bodyB.c_velocity.w=y},t.prototype.solveVelocityConstraints=function(e){var r=this.m_invMassA,s=this.m_invMassB,o=this.m_invIA,n=this.m_invIB,h=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,u=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w;{var p=a.dot(this.m_ax,u)-a.dot(this.m_ax,h)+this.m_sBx*l-this.m_sAx*m,_=-this.m_springMass*(p+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=_;var c=a.mulNumVec2(_,this.m_ax),y=_*this.m_sAx,v=_*this.m_sBx;h.subMul(r,c),m-=o*y,u.addMul(s,c),l+=n*v}{var p=l-m-this.m_motorSpeed,_=-this.m_motorMass*p,f=this.m_motorImpulse,d=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=pt(this.m_motorImpulse+_,-d,d),_=this.m_motorImpulse-f,m-=o*_,l+=n*_}{var p=a.dot(this.m_ay,u)-a.dot(this.m_ay,h)+this.m_sBy*l-this.m_sAy*m,_=-this.m_mass*p;this.m_impulse+=_;var c=a.mulNumVec2(_,this.m_ay),y=_*this.m_sAy,v=_*this.m_sBy;h.subMul(r,c),m-=o*y,u.addMul(s,c),l+=n*v}this.m_bodyA.c_velocity.v.setVec2(h),this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v.setVec2(u),this.m_bodyB.c_velocity.w=l},t.prototype.solvePositionConstraints=function(e){var r=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,h=B.neo(s),m=B.neo(n),u=B.mulVec2(h,a.sub(this.m_localAnchorA,this.m_localCenterA)),l=B.mulVec2(m,a.sub(this.m_localAnchorB,this.m_localCenterB)),p=a.zero();p.addCombine(1,o,1,l),p.subCombine(1,r,1,u);var _=B.mulVec2(h,this.m_localYAxisA),c=a.crossVec2Vec2(a.add(p,u),_),y=a.crossVec2Vec2(l,_),v=a.dot(p,_),f=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy,d=f!=0?-v/f:0,A=a.mulNumVec2(d,_),b=d*c,w=d*y;return r.subMul(this.m_invMassA,A),s-=this.m_invIA*b,o.addMul(this.m_invMassB,A),n+=this.m_invIB*w,this.m_bodyA.c_position.c.setVec2(r),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=n,Fn(v)<=S.linearSlop},t.TYPE="wheel-joint",t}(yt),nt,qn=0,$s={World:Li,Body:W,Joint:yt,Fixture:mr,Shape:je},Ys={Vec2:a,Vec3:$,World:Li,Body:W,Joint:yt,Fixture:mr,Shape:je},kn=(nt={},nt[W.STATIC]=W,nt[W.DYNAMIC]=W,nt[W.KINEMATIC]=W,nt[Fi.TYPE]=Fi,nt[we.TYPE]=we,nt[pe.TYPE]=pe,nt[Ve.TYPE]=Ve,nt[zs.TYPE]=zs,nt[Fs.TYPE]=Fs,nt[ks.TYPE]=ks,nt[Ns.TYPE]=Ns,nt[Ds.TYPE]=Ds,nt[qs.TYPE]=qs,nt[Rs.TYPE]=Rs,nt[Be.TYPE]=Be,nt[Es.TYPE]=Es,nt[Os.TYPE]=Os,nt[Js.TYPE]=Js,nt),Nn={rootClass:Li,preSerialize:function(i){return i},postSerialize:function(i,t){return i},preDeserialize:function(i){return i},postDeserialize:function(i,t){return i}},Er=function(){function i(t){var e=this;this.toJson=function(r){var s=e.options.preSerialize,o=e.options.postSerialize,n=[],h=[r],m={};function u(y,v){if(y.__sid=y.__sid||++qn,!m[y.__sid]){h.push(y);var f=n.length+h.length,d={refIndex:f,refType:v};m[y.__sid]=d}return m[y.__sid]}function l(y){y=s(y);var v=y._serialize();return v=o(v,y),v}function p(y,v){if(v===void 0&&(v=!1),typeof y!="object"||y===null)return y;if(typeof y._serialize=="function"){if(!v){for(var f in $s)if(y instanceof $s[f])return u(y,f)}y=l(y)}if(Array.isArray(y)){for(var d=[],A=0;A<y.length;A++)d[A]=p(y[A]);y=d}else{var d={};for(var A in y)y.hasOwnProperty(A)&&(d[A]=p(y[A]));y=d}return y}for(;h.length;){var _=h.shift(),c=p(_,!0);n.push(c)}return n},this.fromJson=function(r){var s=e.options.preDeserialize,o=e.options.postDeserialize,n=e.options.rootClass,h={};function m(p,_,c){(!p||!p._deserialize)&&(p=kn[_.type]);var y=p&&p._deserialize;if(y){_=s(_);var v=p._deserialize,f=v(_,c,u);return f=o(f,_),f}}function u(p,_,c){var y=_.refIndex&&_.refType;if(!y)return m(p,_,c);var v=_;Ys[v.refType]&&(p=Ys[v.refType]);var f=v.refIndex;if(!h[f]){var d=r[f],A=m(p,d,c);h[f]=A}return h[f]}var l=m(n,r[0],null);return l},this.options=ft(ft({},Nn),t)}return i}(),fo=new Er({rootClass:Li});Er.fromJson=fo.fromJson;Er.toJson=fo.toJson;(function(){function i(){this.width=80,this.height=60,this.x=0,this.y=-10,this.scaleY=-1,this.hz=60,this.speed=1,this.background="#222222",this.activeKeys={},this.step=function(t,e){},this.keydown=function(t,e){},this.keyup=function(t,e){}}return i.mount=function(t){throw new Error("Not implemented")},i.start=function(t){var e=i.mount();return e.start(t),e},i.prototype.color=function(t,e,r){return t=t*256|0,e=e*256|0,r=r*256|0,"rgb("+t+", "+e+", "+r+")"},i})();(function(i){dt(t,i);function t(e,r,s,o){var n=this;return n instanceof t?(n=i.call(this)||this,n._setAsBox(e,r,s,o),n):new t(e,r,s,o)}return t.TYPE="polygon",t})(we);oe.addType(Ve.TYPE,Ve.TYPE,Dn);function Dn(i,t,e,r,s,o,n){Rn(i,e.getShape(),t,o.getShape(),s)}var Ws=g(0,0),Us=g(0,0),Rn=function(i,t,e,r,s){i.pointCount=0,T(Ws,e,t.m_p),T(Us,s,r.m_p);var o=Ye(Us,Ws),n=t.m_radius,h=r.m_radius,m=n+h;o>m*m||(i.type=Q.e_circles,x(i.localPoint,t.m_p),z(i.localNormal),i.pointCount=1,x(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,J.e_vertex,0,J.e_vertex))};oe.addType(pe.TYPE,Ve.TYPE,En);oe.addType(Fi.TYPE,Ve.TYPE,On);function En(i,t,e,r,s,o,n){var h=e.getShape(),m=o.getShape();xo(i,h,t,m,s)}function On(i,t,e,r,s,o,n){var h=e.getShape(),m=new pe;h.getChildEdge(m,r);var u=m,l=o.getShape();xo(i,u,t,l,s)}var qe=g(0,0),Cr=g(0,0),Mr=g(0,0),_e=g(0,0),ke=g(0,0),ai=g(0,0),xo=function(i,t,e,r,s){i.pointCount=0,no(_e,s,e,r.m_p);var o=t.m_vertex1,n=t.m_vertex2;q(qe,n,o);var h=C(qe,n)-C(qe,_e),m=C(qe,_e)-C(qe,o),u=t.m_radius+r.m_radius;if(m<=0){x(ke,o);var l=Ye(_e,o);if(l>u*u)return;if(t.m_hasVertex0){var p=t.m_vertex0,_=o;q(Cr,_,p);var c=C(Cr,_)-C(Cr,_e);if(c>0)return}i.type=Q.e_circles,z(i.localNormal),x(i.localPoint,ke),i.pointCount=1,x(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,J.e_vertex,0,J.e_vertex);return}if(h<=0){x(ke,n);var y=Ye(_e,ke);if(y>u*u)return;if(t.m_hasVertex3){var v=t.m_vertex3,f=n;q(Mr,v,f);var d=C(Mr,_e)-C(Mr,f);if(d>0)return}i.type=Q.e_circles,z(i.localNormal),x(i.localPoint,ke),i.pointCount=1,x(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(1,J.e_vertex,0,J.e_vertex);return}var A=$e(qe);K(ke,h/A,o,m/A,n);var b=Ye(_e,ke);b>u*u||(St(ai,1,qe),C(ai,_e)-C(ai,o)<0&&Si(ai),Zt(ai),i.type=Q.e_faceA,x(i.localNormal,ai),x(i.localPoint,o),i.pointCount=1,x(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,J.e_face,0,J.e_vertex))},er=[new zt,new zt],ir=[new zt,new zt],Ne=[new zt,new zt],rr=g(0,0),Hs=g(0,0),Ir=g(0,0),Pr=He(0,0,0),De=g(0,0),hi=g(0,0),sr=g(0,0),js=g(0,0),Zs=g(0,0),xe=g(0,0),Sr=g(0,0),Xs=g(0,0);oe.addType(we.TYPE,we.TYPE,Jn);function Jn(i,t,e,r,s,o,n){Yn(i,e.getShape(),t,o.getShape(),s)}function Ks(i,t,e,r,s){var o=i.m_count,n=e.m_count,h=i.m_normals,m=i.m_vertices,u=e.m_vertices;ao(Pr,r,t);for(var l=0,p=-1/0,_=0;_<o;++_){Ot(Ir,Pr.q,h[_]),T(Hs,Pr,m[_]);for(var c=1/0,y=0;y<n;++y){var v=C(Ir,u[y])-C(Ir,Hs);v<c&&(c=v)}c>p&&(p=c,l=_)}s.maxSeparation=p,s.bestIndex=l}function $n(i,t,e,r,s,o){var n=t.m_normals,h=s.m_count,m=s.m_vertices,u=s.m_normals;$o(Xs,o.q,e.q,n[r]);for(var l=0,p=1/0,_=0;_<h;++_){var c=C(Xs,u[_]);c<p&&(p=c,l=_)}var y=l,v=y+1<h?y+1:0;T(i[0].v,o,m[y]),i[0].id.setFeatures(r,J.e_face,y,J.e_vertex),T(i[1].v,o,m[v]),i[1].id.setFeatures(r,J.e_face,v,J.e_vertex)}var mi={maxSeparation:0,bestIndex:0},Yn=function(i,t,e,r,s){i.pointCount=0;var o=t.m_radius+r.m_radius;Ks(t,e,r,s,mi);var n=mi.bestIndex,h=mi.maxSeparation;if(!(h>o)){Ks(r,s,t,e,mi);var m=mi.bestIndex,u=mi.maxSeparation;if(!(u>o)){var l,p,_,c,y,v,f=.1*S.linearSlop;u>h+f?(l=r,p=t,_=s,c=e,y=m,i.type=Q.e_faceB,v=!0):(l=t,p=r,_=e,c=s,y=n,i.type=Q.e_faceA,v=!1),er[0].recycle(),er[1].recycle(),$n(er,l,_,y,p,c);var d=l.m_count,A=l.m_vertices,b=y,w=y+1<d?y+1:0;x(De,A[b]),x(hi,A[w]),q(sr,hi,De),Zt(sr),Je(js,sr,1),K(Zs,.5,De,.5,hi),Ot(xe,_.q,sr),Je(Sr,xe,1),T(De,_,De),T(hi,_,hi);var V=C(Sr,De),I=-C(xe,De)+o,M=C(xe,hi)+o;ir[0].recycle(),ir[1].recycle(),Ne[0].recycle(),Ne[1].recycle(),ut(rr,-xe.x,-xe.y);var P=zi(ir,er,rr,I,b);if(!(P<2)){ut(rr,xe.x,xe.y);var R=zi(Ne,ir,rr,M,w);if(!(R<2)){x(i.localNormal,js),x(i.localPoint,Zs);for(var E=0,O=0;O<Ne.length;++O){var Y=C(Sr,Ne[O].v)-V;if(Y<=o){var U=i.points[E];Tr(U.localPoint,c,Ne[O].v),U.id.set(Ne[O].id),v&&U.id.swapFeatures(),++E}}i.pointCount=E}}}}};oe.addType(we.TYPE,Ve.TYPE,Wn);function Wn(i,t,e,r,s,o,n){Un(i,e.getShape(),t,o.getShape(),s)}var Ut=g(0,0),zr=g(0,0),Un=function(i,t,e,r,s){i.pointCount=0,no(Ut,s,e,r.m_p);for(var o=0,n=-1/0,h=t.m_radius+r.m_radius,m=t.m_count,u=t.m_vertices,l=t.m_normals,p=0;p<m;++p){var _=C(l[p],Ut)-C(l[p],u[p]);if(_>h)return;_>n&&(n=_,o=p)}var c=o,y=c+1<m?c+1:0,v=u[c],f=u[y];if(n<Vt){i.pointCount=1,i.type=Q.e_faceA,x(i.localNormal,l[o]),K(i.localPoint,.5,v,.5,f),x(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,J.e_vertex,0,J.e_vertex);return}var d=C(Ut,f)-C(Ut,v)-C(v,f)+C(v,v),A=C(Ut,v)-C(Ut,f)-C(f,v)+C(f,f);if(d<=0){if(Ye(Ut,v)>h*h)return;i.pointCount=1,i.type=Q.e_faceA,q(i.localNormal,Ut,v),Zt(i.localNormal),x(i.localPoint,v),x(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,J.e_vertex,0,J.e_vertex)}else if(A<=0){if(Ye(Ut,f)>h*h)return;i.pointCount=1,i.type=Q.e_faceA,q(i.localNormal,Ut,f),Zt(i.localNormal),x(i.localPoint,f),x(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,J.e_vertex,0,J.e_vertex)}else{K(zr,.5,v,.5,f);var b=C(Ut,l[c])-C(zr,l[c]);if(b>h)return;i.pointCount=1,i.type=Q.e_faceA,x(i.localNormal,l[c]),x(i.localPoint,zr),x(i.points[0].localPoint,r.m_p),i.points[0].id.setFeatures(0,J.e_vertex,0,J.e_vertex)}},Hn=Math.min;oe.addType(pe.TYPE,we.TYPE,jn);oe.addType(Fi.TYPE,we.TYPE,Zn);function jn(i,t,e,r,s,o,n){go(i,e.getShape(),t,o.getShape(),s)}var Gs=new pe;function Zn(i,t,e,r,s,o,n){var h=e.getShape();h.getChildEdge(Gs,r),go(i,Gs,t,o.getShape(),s)}var Dt;(function(i){i[i.e_unknown=-1]="e_unknown",i[i.e_edgeA=1]="e_edgeA",i[i.e_edgeB=2]="e_edgeB"})(Dt||(Dt={}));var Qs;(function(i){i[i.e_isolated=0]="e_isolated",i[i.e_concave=1]="e_concave",i[i.e_convex=2]="e_convex"})(Qs||(Qs={}));var Ao=function(){function i(){}return i}(),Xn=function(){function i(){this.vertices=[],this.normals=[],this.count=0;for(var t=0;t<S.maxPolygonVertices;t++)this.vertices.push(g(0,0)),this.normals.push(g(0,0))}return i}(),Kn=function(){function i(){this.v1=g(0,0),this.v2=g(0,0),this.normal=g(0,0),this.sideNormal1=g(0,0),this.sideNormal2=g(0,0)}return i.prototype.recycle=function(){z(this.v1),z(this.v2),z(this.normal),z(this.sideNormal1),z(this.sideNormal2)},i}(),or=[new zt,new zt],Ae=[new zt,new zt],Ht=[new zt,new zt],te=new Ao,xt=new Ao,mt=new Xn,k=new Kn,nr=g(0,0),wi=g(0,0),ci=g(0,0),Vi=g(0,0),Ci=He(0,0,0),Z=g(0,0),ee=g(0,0),L=g(0,0),ie=g(0,0),at=g(0,0),ht=g(0,0),to=g(0,0),ge=g(0,0),go=function(i,t,e,r,s){ao(Ci,e,s),T(nr,Ci,r.m_centroid);var o=t.m_vertex0,n=t.m_vertex1,h=t.m_vertex2,m=t.m_vertex3,u=t.m_hasVertex0,l=t.m_hasVertex3;q(ci,h,n),Zt(ci),ut(L,ci.y,-ci.x);var p=C(L,nr)-C(L,n),_=0,c=0,y=!1,v=!1;z(ee),z(ie),u&&(q(wi,n,o),Zt(wi),ut(ee,wi.y,-wi.x),y=D(wi,ci)>=0,_=a.dot(ee,nr)-a.dot(ee,o)),l&&(q(Vi,m,h),Zt(Vi),ut(ie,Vi.y,-Vi.x),v=a.crossVec2Vec2(ci,Vi)>0,c=a.dot(ie,nr)-a.dot(ie,h));var f;z(Z),z(at),z(ht),u&&l?y&&v?(f=_>=0||p>=0||c>=0,f?(x(Z,L),x(at,ee),x(ht,ie)):(F(Z,-1,L),F(at,-1,L),F(ht,-1,L))):y?(f=_>=0||p>=0&&c>=0,f?(x(Z,L),x(at,ee),x(ht,L)):(F(Z,-1,L),F(at,-1,ie),F(ht,-1,L))):v?(f=c>=0||_>=0&&p>=0,f?(x(Z,L),x(at,L),x(ht,ie)):(F(Z,-1,L),F(at,-1,L),F(ht,-1,ee))):(f=_>=0&&p>=0&&c>=0,f?(x(Z,L),x(at,L),x(ht,L)):(F(Z,-1,L),F(at,-1,ie),F(ht,-1,ee))):u?y?(f=_>=0||p>=0,f?(x(Z,L),x(at,ee),F(ht,-1,L)):(F(Z,-1,L),x(at,L),F(ht,-1,L))):(f=_>=0&&p>=0,f?(x(Z,L),x(at,L),F(ht,-1,L)):(F(Z,-1,L),x(at,L),F(ht,-1,ee))):l?v?(f=p>=0||c>=0,f?(x(Z,L),F(at,-1,L),x(ht,ie)):(F(Z,-1,L),F(at,-1,L),x(ht,L))):(f=p>=0&&c>=0,f?(x(Z,L),F(at,-1,L),x(ht,L)):(F(Z,-1,L),F(at,-1,ie),x(ht,L))):(f=p>=0,f?(x(Z,L),F(at,-1,L),F(ht,-1,L)):(F(Z,-1,L),x(at,L),x(ht,L))),mt.count=r.m_count;for(var d=0;d<r.m_count;++d)T(mt.vertices[d],Ci,r.m_vertices[d]),Ot(mt.normals[d],Ci.q,r.m_normals[d]);var A=r.m_radius+t.m_radius;i.pointCount=0;{te.type=Dt.e_edgeA,te.index=f?0:1,te.separation=1/0;for(var d=0;d<mt.count;++d){var b=mt.vertices[d],w=C(Z,b)-C(Z,n);w<te.separation&&(te.separation=w)}}if(te.type!=Dt.e_unknown&&!(te.separation>A)){{xt.type=Dt.e_unknown,xt.index=-1,xt.separation=-1/0,ut(to,-Z.y,Z.x);for(var d=0;d<mt.count;++d){F(ge,-1,mt.normals[d]);var V=C(ge,mt.vertices[d])-C(ge,n),I=C(ge,mt.vertices[d])-C(ge,h),w=Hn(V,I);if(w>A){xt.type=Dt.e_edgeB,xt.index=d,xt.separation=w;break}if(C(ge,to)>=0){if(C(ge,Z)-C(ht,Z)<-S.angularSlop)continue}else if(C(ge,Z)-C(at,Z)<-S.angularSlop)continue;w>xt.separation&&(xt.type=Dt.e_edgeB,xt.index=d,xt.separation=w)}}if(!(xt.type!=Dt.e_unknown&&xt.separation>A)){var M=.98,P=.001,R;if(xt.type==Dt.e_unknown?R=te:xt.separation>M*te.separation+P?R=xt:R=te,Ht[0].recycle(),Ht[1].recycle(),R.type==Dt.e_edgeA){i.type=Q.e_faceA;for(var E=0,O=C(Z,mt.normals[0]),d=1;d<mt.count;++d){var Y=C(Z,mt.normals[d]);Y<O&&(O=Y,E=d)}var U=E,j=U+1<mt.count?U+1:0;x(Ht[0].v,mt.vertices[U]),Ht[0].id.setFeatures(0,J.e_face,U,J.e_vertex),x(Ht[1].v,mt.vertices[j]),Ht[1].id.setFeatures(0,J.e_face,j,J.e_vertex),f?(k.i1=0,k.i2=1,x(k.v1,n),x(k.v2,h),x(k.normal,L)):(k.i1=1,k.i2=0,x(k.v1,h),x(k.v2,n),F(k.normal,-1,L))}else i.type=Q.e_faceB,x(Ht[0].v,n),Ht[0].id.setFeatures(0,J.e_vertex,R.index,J.e_face),x(Ht[1].v,h),Ht[1].id.setFeatures(0,J.e_vertex,R.index,J.e_face),k.i1=R.index,k.i2=k.i1+1<mt.count?k.i1+1:0,x(k.v1,mt.vertices[k.i1]),x(k.v2,mt.vertices[k.i2]),x(k.normal,mt.normals[k.i1]);ut(k.sideNormal1,k.normal.y,-k.normal.x),ut(k.sideNormal2,-k.sideNormal1.x,-k.sideNormal1.y),k.sideOffset1=C(k.sideNormal1,k.v1),k.sideOffset2=C(k.sideNormal2,k.v2),or[0].recycle(),or[1].recycle(),Ae[0].recycle(),Ae[1].recycle();var Ct=zi(or,Ht,k.sideNormal1,k.sideOffset1,k.i1);if(!(Ct<S.maxManifoldPoints)){var lt=zi(Ae,or,k.sideNormal2,k.sideOffset2,k.i2);if(!(lt<S.maxManifoldPoints)){R.type==Dt.e_edgeA?(x(i.localNormal,k.normal),x(i.localPoint,k.v1)):(x(i.localNormal,r.m_normals[k.i1]),x(i.localPoint,r.m_vertices[k.i1]));for(var Jt=0,d=0;d<S.maxManifoldPoints;++d){var At=C(k.normal,Ae[d].v)-C(k.normal,k.v1);if(At<=A){var tt=i.points[Jt];R.type==Dt.e_edgeA?(Tr(tt.localPoint,Ci,Ae[d].v),tt.id.set(Ae[d].id)):(x(tt.localPoint,Ae[d].v),tt.id.set(Ae[d].id),tt.id.swapFeatures()),++Jt}}i.pointCount=Jt}}}}};(function(){function i(t,e){this._refMap={},this._map={},this._xmap={},this._data=[],this._entered=[],this._exited=[],this._key=t,this._listener=e}return i.prototype.update=function(t){if(!Array.isArray(t))throw"Invalid data: "+t;this._entered.length=0,this._exited.length=0,this._data.length=t.length;for(var e=0;e<t.length;e++)if(!(typeof t[e]!="object"||t[e]===null)){var r=t[e],s=this._key(r);this._map[s]?delete this._map[s]:this._entered.push(r),this._data[e]=r,this._xmap[s]=r}for(var s in this._map)this._exited.push(this._map[s]),delete this._map[s];var o=this._map;this._map=this._xmap,this._xmap=o;for(var e=0;e<this._exited.length;e++){var r=this._exited[e],n=this._key(r),h=this._refMap[n];this._listener.exit(r,h),delete this._refMap[n]}for(var e=0;e<this._entered.length;e++){var r=this._entered[e],n=this._key(r),h=this._listener.enter(r);h&&(this._refMap[n]=h)}for(var e=0;e<this._data.length;e++)if(!(typeof t[e]!="object"||t[e]===null)){var r=this._data[e],n=this._key(r),h=this._refMap[n];this._listener.update(r,h)}this._entered.length=0,this._exited.length=0,this._data.length=0},i.prototype.ref=function(t){return this._refMap[this._key(t)]},i})();class Gn extends pi{constructor(){super(),this.time=0,this.timeStep=1e3/60,this.fruitDriver=Oe.create({filter:t=>t.type==="fruit",enter:t=>{const e=this.world.createBody({type:"dynamic",position:t.position,userData:t,linearVelocity:{x:0,y:20}});return e.createFixture({shape:new Ve(t.radius),density:1/t.level,restitution:.1}),e},update:(t,e)=>{const{x:r,y:s}=e.getPosition();t.position.x=r,t.position.y=s},exit:(t,e)=>{this.world.destroyBody(e)}}),this.bucketDriver=Oe.create({filter:t=>t.type==="bucket",enter:t=>{const e=this.world.createBody({type:"static",userData:t}),r=t.width/2,s=t.height/2;return e.createFixture({shape:new pe({x:-r,y:-s},{x:+r,y:-s}),userData:"top"}),e.createFixture({shape:new Fi([{x:-r,y:-s},{x:+r,y:-s},{x:+r,y:+s},{x:-r,y:+s}],!0)}),e},update:(t,e)=>{},exit:(t,e)=>{this.world.destroyBody(e)}}),this.dataset=lr.create({key:t=>t.key,drivers:[this.fruitDriver,this.bucketDriver]}),this.handleCollide=t=>{const e=t.getFixtureA(),r=e.getBody(),s=t.getFixtureB(),o=s.getBody(),n=r.getUserData(),h=o.getUserData();!n||!h||(n.type==="fruit"&&h.type==="fruit"&&n.level===h.level&&this.world.queueUpdate(()=>this.emit("collide-fruits",{fruitA:n,fruitB:h})),n.type==="fruit"&&h.type==="bucket"&&s.getUserData()==="top"?this.world.queueUpdate(()=>this.emit("collide-top",{fruit:n,bucket:h})):n.type==="bucket"&&h.type==="fruit"&&e.getUserData()==="top"&&this.world.queueUpdate(()=>this.emit("collide-top",{fruit:h,bucket:n})))},this.on("activate",this.handleActivate),this.on("frame-update",this.handleFrameUpdate)}handleActivate(){this.world||(this.world=new Li({gravity:{x:0,y:10}}),this.world.on("pre-solve",this.handleCollide))}handleFrameUpdate(t){for(this.dataset.data([...this.context.fruits,this.context.bucket]),this.time+=t.dt;this.time>=this.timeStep;)this.time-=this.timeStep,this.world.step(this.timeStep/1e3)}}class Qn extends pi{constructor(){super(),this.lastTime=0,this.event={dt:0,now:0},this.handleFrame=()=>{if(!this.activated)return;const t=performance.now(),e=t-this.lastTime;this.lastTime=t,this.event.now=t,this.event.dt=e,this.emit("frame-update",this.event),this.emit("frame-render",this.event),this.requestFrame()},this.requestFrame=()=>{this.activated&&window.requestAnimationFrame(this.handleFrame)},this.on("activate",this.handleActivate),this.on("deactivate",this.handleDeactivate)}handleActivate(){this.lastTime=performance.now(),this.requestFrame()}handleDeactivate(){}}class ta{constructor(){this.next=null,this.fruits=[],this.bucket=new wo(12,20)}}class ea extends pi{constructor(){super(),this.use(new Qn),this.use(new Co),this.use(new Gn),this.use(new Mo),this.on("activate",this.handleActivate)}handleActivate(){setTimeout(()=>this.emit("main-start"),100)}}cr.activate(new ea,new ta);
